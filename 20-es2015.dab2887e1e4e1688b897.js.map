{"version":3,"sources":["webpack:///src/app/core/services/mailbox/mailbox.service.ts","webpack:///src/app/virtual-mailbox/components/mailbox-items/mailbox-items.component.ts","webpack:///src/app/virtual-mailbox/components/mailbox-items/mailbox-items.component.html","webpack:///src/app/virtual-mailbox/virtual-mailbox.component.html","webpack:///src/app/virtual-mailbox/virtual-mailbox.component.ts","webpack:///src/app/virtual-mailbox/virtual-mailbox-routing.module.ts","webpack:///src/app/virtual-mailbox/virtual-mailbox.module.ts"],"names":["MailboxService","httpClient","errorHandlerService","since","until","this","get","environment","apiBasePath","endpoints","virtualMailbox","checkCorrespondence","pipe","pluck","catchError","error","errorCode","of","redirectErrorPage","vmb","getCorrespondence","visualizado","codigoFormulario","fecha","idDocumento","cuenta","idExterno","map","res","data","MailboxItemsComponent","mailboxService","subs","Subscription","add","filter","rs","subscribe","blob","a","document","createElement","href","URL","createObjectURL","download","item","nomDoc","click","unsubscribe","VirtualMailboxComponent","formBuilder","bsLocaleService","headerService","accountService","state$","createState","maxDateTo","Date","minDateFrom","moment","subtract","format","showResult","updateTitle","use","createForm","searchNotification","customer","name","firstSurname","secondarySurname","f","dateTo","value","dateFrom","zip","currentCustomer$","searchForm","group","required","notifications","documents","result","controls","control","formSubmit","invalid","routes","path","component","VirtualMailboxRoutingModule","forChild","VirtualMailboxModule"],"mappings":"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","file":"x","sourcesContent":["import { ErrorHandlerService } from '../errors/error-handler.service';\r\nimport { VirtualMailbox } from '../../../api/models/virtual-mailbox.model';\r\nimport { CasePayload } from '../../../api/models/case-payload.model';\r\nimport { Injectable } from '@angular/core';\r\nimport { SalesforceResponse, Case, CaseRequest, ApiError } from '../../../api/models';\r\nimport { pluck, map, catchError } from 'rxjs/operators';\r\nimport { environment } from '@environment/environment';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { of, Observable, ObservedValueOf } from 'rxjs';\r\nimport { ApiErrors } from '@api/constants';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class MailboxService {\r\n  constructor(private httpClient: HttpClient, private errorHandlerService: ErrorHandlerService) {}\r\n\r\n  checkCorrespondence(\r\n    since: string,\r\n    until: string\r\n  ): Observable<Array<VirtualMailbox>> | Observable<any> {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.virtualMailbox.checkCorrespondence}?since=${since}&until=${until}`;\r\n    return this.httpClient.get<Array<VirtualMailbox>>(url).pipe(\r\n      pluck('data'),\r\n      catchError((error: ApiError) => {\r\n        if (error.errorCode) {\r\n          return of([]);\r\n        }\r\n        return this.errorHandlerService.redirectErrorPage(error);\r\n      })\r\n    );\r\n    // return of([\r\n    //   {\r\n    //     visualizado: '0',\r\n    //     visible: '1',\r\n    //     vip: '0',\r\n    //     nomDoc: 'NOTIFICACION LEVANTAMIENTO DE EMBARGO',\r\n    //     nDocum: '000000002',\r\n    //     importe: null,\r\n    //     idioma: '01',\r\n    //     idExterno: '97730095J',\r\n    //     idDocumento:\r\n    //       'ORACLE-20/05/2020-1508-2020-05-21-12-47-03-53-000000002-97730095J -TERCIOSPDF',\r\n    //     fecha: '2020-05-20',\r\n    //     descripcionCategoria: 'AVISOS',\r\n    //     cuenta: '15080001240000070920',\r\n    //     codigoFormulario: 'EMB0CCC1A01',\r\n    //     categoria: '00001',\r\n    //   },\r\n    // ]);\r\n  }\r\n\r\n  getCorrespondence(vmb: VirtualMailbox) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.virtualMailbox.getCorrespondence}?visualized=${vmb.visualizado}&formcode=${vmb.codigoFormulario}&date=${vmb.fecha}&documentid=${vmb.idDocumento}&account=${vmb.cuenta}&externalid=${vmb.idExterno}`;\r\n    return this.httpClient.get<SalesforceResponse<any>>(url).pipe(map((res) => res?.data?.[0]));\r\n  }\r\n}\r\n// operators\r\nexport function filterNotification(virtualMailbox: Array<VirtualMailbox>) {\r\n  return virtualMailbox.filter((vmb) => vmb.descripcionCategoria === 'AVISOS');\r\n}\r\n\r\nexport function filterDocument(virtualMailbox: Array<VirtualMailbox>) {\r\n  return virtualMailbox.filter((vmb) => vmb.descripcionCategoria !== 'AVISOS');\r\n}\r\n","import { VirtualMailbox } from '@api/models/virtual-mailbox.model';\r\nimport { MailboxService } from '../../../core/services/mailbox/mailbox.service';\r\nimport { Component, OnInit, Input, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { zip, filter, map, switchMap } from 'rxjs/operators';\r\nimport { b64toBlob } from '@core/utils/file.utils';\r\n\r\n@Component({\r\n  selector: 'app-mailbox-items',\r\n  templateUrl: './mailbox-items.component.html',\r\n  styleUrls: ['./mailbox-items.component.scss'],\r\n})\r\nexport class MailboxItemsComponent implements OnInit, OnDestroy {\r\n  @Input() type: string;\r\n  @Input() item: VirtualMailbox;\r\n  private subs = new Subscription();\r\n\r\n  constructor(private mailboxService: MailboxService) {}\r\n\r\n  ngOnInit(): void {}\r\n\r\n  download(virtualMailbox: VirtualMailbox) {\r\n    this.subs.add(\r\n      this.mailboxService\r\n        .getCorrespondence(virtualMailbox)\r\n        .pipe(\r\n          filter((rs) => !!rs),\r\n          b64toBlob()\r\n        )\r\n        .subscribe((blob) => {\r\n          //Download\r\n          const a = document.createElement('a');\r\n          a.href = URL.createObjectURL(blob);\r\n          a.download = this.item.nomDoc;\r\n          a.click();\r\n\r\n          //Open in new window\r\n          // const blobUrl = URL.createObjectURL(blob);\r\n          // window.open(blobUrl);\r\n        })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subs.unsubscribe();\r\n  }\r\n}\r\n","<div class=\"tabs-block--desktop__body__row\">\r\n  <div class=\"tabs-block--desktop__body__row__title\">\r\n    <p class=\"date\">{{ item.fecha | date: 'dd/MM/yyyy' }}</p>\r\n    <p class=\"name\">{{ item.nomDoc | translate }}</p>\r\n    <span class=\"ico-download\" (click)=\"download(item)\"></span>\r\n  </div>\r\n</div>\r\n","<div class=\"max-size virtual-mailbox\" *ngIf=\"state$ | async as state\">\r\n  <div class=\"main\">\r\n    <div class=\"main-col\">\r\n      <div class=\"main__header\">\r\n        <div class=\"main__header__desktop\">\r\n          <div class=\"main__header__title\">\r\n            <div class=\"main__header__title__col\">\r\n              <h1>{{ 'virtual_mb_title' | translate }}</h1>\r\n              <p>{{ getUsername(state?.customer) }}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"main__body\">\r\n        <form [formGroup]=\"searchForm\" (submit)=\"searchNotification()\">\r\n          <div class=\"group-input input-text\" [title]=\"'virtual_mb_range_max_60' | translate\">\r\n            <label for=\"dateFrom\">{{ 'virtual_mb_date_from' | translate }}</label>\r\n            <span class=\"ico-calendary icon-input yellow\"></span>\r\n            <input\r\n              id=\"dateFrom\"\r\n              type=\"text\"\r\n              bsDatepicker\r\n              formControlName=\"dateFrom\"\r\n              [minDate]=\"minDateFrom\"\r\n              [maxDate]=\"maxDateFrom\"\r\n              [bsConfig]=\"{ dateInputFormat: 'DD/MM/YYYY' }\"\r\n              [placeholder]=\"'dd/mm/aaaa' | translate\"\r\n              [ngClass]=\"{ error: hasError(searchForm.get('since')) }\"\r\n              [dateCustomClasses]=\"dateCustomClasses\"\r\n            />\r\n          </div>\r\n          <div class=\"group-input input-text\" [title]=\"'virtual_mb_range_max_60' | translate\">\r\n            <label for=\"dateTo\">{{ 'virtual_mb_date_to' | translate }}</label>\r\n            <span class=\"ico-calendary icon-input yellow\"></span>\r\n            <input\r\n              id=\"dateTo\"\r\n              type=\"text\"\r\n              bsDatepicker\r\n              formControlName=\"dateTo\"\r\n              [minDate]=\"minDateTo\"\r\n              [maxDate]=\"maxDateTo\"\r\n              [bsConfig]=\"{ dateInputFormat: 'DD/MM/YYYY' }\"\r\n              [placeholder]=\"'dd/mm/aaaa' | translate\"\r\n              [ngClass]=\"{ error: hasError(searchForm.get('dateTo')) }\"\r\n              [dateCustomClasses]=\"dateCustomClasses\"\r\n            />\r\n          </div>\r\n          <div class=\"group-button\">\r\n            <button type=\"submit\" class=\"btn--primary-small\">\r\n              {{ 'virtual_mb_btn_search' | translate }}\r\n            </button>\r\n          </div>\r\n          <div class=\"main__button\">\r\n            <button type=\"submit\" class=\"btn--primary\">\r\n              {{ 'virtual_mb_btn_search' | translate }}\r\n            </button>\r\n          </div>\r\n        </form>\r\n        <div class=\"tabs-block--desktop\">\r\n          <tabset #staticTabs>\r\n            <tab [heading]=\"'virtual_mb_tab_mailing' | translate\">\r\n              <div *ngIf=\"notifications.length && showResult\">\r\n                <app-mailbox-items\r\n                  type=\"notification\"\r\n                  [item]=\"notification\"\r\n                  *ngFor=\"let notification of notifications\"\r\n                >\r\n                </app-mailbox-items>\r\n              </div>\r\n              <div class=\"tabs-block--desktop__no-data\" *ngIf=\"!notifications.length && showResult\">\r\n                <p>\r\n                  {{\r\n                    'virtual_mb_mailing_not_found_range_date'\r\n                      | translate: { since: since, until: until }\r\n                  }}\r\n                </p>\r\n              </div>\r\n            </tab>\r\n            <!-- <tab [heading]=\"'virtual_mb_tab_documentation' | translate\"\r\n              <div *ngIf=\"documents.length && showResult\">\r\n                <app-mailbox-items\r\n                  type=\"document\"\r\n                  [item]=\"document\"\r\n                  *ngFor=\"let document of documents\"\r\n                ></app-mailbox-items>\r\n              </div>\r\n              <div *ngIf=\"!documents.length && showResult\">\r\n                No se ha encontrado documentos para el rango de fechas del {{ since }} al {{ until }}.\r\n              </div>\r\n              </tab> -->\r\n          </tabset>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { Customer } from '@core/models/customer.model';\r\nimport { MailboxService } from '@core/services/mailbox/mailbox.service';\r\n\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { AccountService, createCustomerMap } from '@core/services/account/account.service';\r\nimport { HeaderService } from '@core/services/header/header.service';\r\nimport { filter, map } from 'rxjs/operators';\r\nimport { zip } from 'rxjs';\r\nimport { formatCustomDate } from '@core/utils';\r\nimport { FormGroup, FormBuilder, Validators, AbstractControl } from '@angular/forms';\r\nimport * as moment from 'moment';\r\nimport { DatepickerDateCustomClasses, BsLocaleService } from 'ngx-bootstrap/datepicker';\r\nimport { VirtualMailbox } from '@api/models';\r\n\r\n@Component({\r\n  selector: 'app-virtual-mailbox',\r\n  templateUrl: './virtual-mailbox.component.html',\r\n})\r\nexport class VirtualMailboxComponent implements OnInit {\r\n  state$ = this.createState();\r\n  searchForm: FormGroup;\r\n  maxDateTo = new Date();\r\n  minDateFrom = new Date(moment().subtract(60, 'days').format('L'));\r\n  dateCustomClasses: DatepickerDateCustomClasses[];\r\n  dateFrom: Date;\r\n  dateTo: Date;\r\n  formSubmit: boolean;\r\n  notifications: VirtualMailbox[];\r\n  documents: VirtualMailbox[];\r\n  since: string;\r\n  until: string;\r\n  showResult = false;\r\n\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    private bsLocaleService: BsLocaleService,\r\n    private headerService: HeaderService,\r\n    private accountService: AccountService,\r\n    private mailboxService: MailboxService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.headerService.updateTitle('menu_mailbox');\r\n    this.bsLocaleService.use('es');\r\n    this.createForm();\r\n    this.searchNotification();\r\n  }\r\n\r\n  getUsername(customer: Customer) {\r\n    return `${customer?.name} ${customer?.firstSurname} ${customer?.secondarySurname}`;\r\n  }\r\n\r\n  get maxDateFrom() {\r\n    return this.f.dateTo.value ? new Date(this.f.dateTo.value) : new Date();\r\n  }\r\n\r\n  get minDateTo() {\r\n    return this.f.dateFrom.value\r\n      ? new Date(this.f.dateFrom.value)\r\n      : new Date(moment().subtract(60, 'days').format('L'));\r\n  }\r\n\r\n  private createState() {\r\n    return zip(\r\n      this.accountService.currentCustomer$.pipe(\r\n        filter((customer) => !!customer),\r\n        createCustomerMap()\r\n      )\r\n    ).pipe(\r\n      map(([customer]) => ({\r\n        customer,\r\n      }))\r\n    );\r\n  }\r\n\r\n  private createForm() {\r\n    const since = new Date(moment().subtract(60, 'days').format('L'));\r\n    const until = new Date();\r\n    this.searchForm = this.formBuilder.group({\r\n      dateFrom: [since, [Validators.required]],\r\n      dateTo: [until, [Validators.required]],\r\n    });\r\n  }\r\n\r\n  searchNotification() {\r\n    this.showResult = false;\r\n    this.notifications = this.documents = [];\r\n    this.since = formatCustomDate(this.f.dateFrom.value);\r\n    this.until = formatCustomDate(this.f.dateTo.value);\r\n    this.mailboxService.checkCorrespondence(this.since, this.until).subscribe((result) => {\r\n      this.showResult = true;\r\n      this.notifications = this.documents = result;\r\n    });\r\n  }\r\n\r\n  get f() {\r\n    return this.searchForm.controls;\r\n  }\r\n\r\n  hasError(control: AbstractControl) {\r\n    return this.formSubmit && control.invalid;\r\n  }\r\n}\r\n","import { VirtualMailboxComponent } from './virtual-mailbox.component';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\n\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: VirtualMailboxComponent,\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class VirtualMailboxRoutingModule { }\r\n","import { SharedModule } from '@shared/shared.module';\r\nimport { VirtualMailboxComponent } from './virtual-mailbox.component';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { VirtualMailboxRoutingModule } from './virtual-mailbox-routing.module';\r\nimport { MailboxItemsComponent } from './components/mailbox-items/mailbox-items.component';\r\n\r\n\r\n\r\n\r\n@NgModule({\r\n  declarations: [VirtualMailboxComponent, MailboxItemsComponent],\r\n  imports: [\r\n    CommonModule,\r\n    VirtualMailboxRoutingModule,\r\n    SharedModule\r\n  ]\r\n})\r\nexport class VirtualMailboxModule { }\r\n"]}