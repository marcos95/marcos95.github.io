{"version":3,"sources":["webpack:///src/app/core/services/transactions/transaction.service.ts","webpack:///src/app/transactions/components/transaction-item/transaction-item.component.ts","webpack:///src/app/core/constants/origen-apunte.constant.ts","webpack:///src/app/transactions/components/transaction-item/transaction-item.component.html","webpack:///src/app/transactions/components/transaction-search/transaction-search.component.html","webpack:///src/app/transactions/components/transaction-search/transaction-search.component.ts","webpack:///src/app/transactions/transactions.component.html","webpack:///src/app/transactions/transactions-routing.module.ts","webpack:///src/app/transactions/transactions.component.ts","webpack:///src/app/transactions/transactions.module.ts"],"names":["TransactionService","TransactionItemComponent","httpClient","errorHandlerService","acuerdo","dateFromParam","dateToParam","referenceOTP","url","environment","apiBasePath","endpoints","trasactions","get","this","pipe","catchError","error","errorCode","MOV_NOT_FOUND","of","code","data","redirectErrorPage","body","post","generateOtp","put","validateOtp","MOVEMENTS_TYPE_ENUM","ACUERDO","APORTACION","CHEQUE_PAGARE","CHEQUE_PROPIO","EFECTO_COMERCIAL","EFECTO_RECIBIDO","EMBARGO","EXPEDIENTE_RECLAMACION","FONDO_INVERSION","IMPOSICION","LIQUIDACION","OPERACION_VALORES","OPERACION_EXTRANJERO","OPERACION_RENTA_FIJA","OPERACION_DIVERSA","OPERACION_REPO","PENSIONES","RECIBO_DOMICILIADO_RZ","RECIBO_DOMICILIADO_RB","RECIBO_VENTANILLA","REMESA","RETRO_PENSIONES","SUBVENCION","TRANSFERENCIA_SEPA_TF","TRANSFERENCIA_SEPA_TR","TRASPASO","APUNTE","APUNTE_MANUAL","BOLETA_CUC","CARG_COMIS_C57_GRP","CHEQUE_EXTRANJERO","COMIS_TRASP_VAL","DESINTER_INVERSIS","DOCUMENTOS_VARIOS","FACT_CON","Movements","name","MOVEMENTS_TYPE","providedIn","factory","movementsType","isOpen","find","oa","movement","codigoOrigenApunte","icon","signo","open","TransactionSearchComponent","formBuilder","globalPositionService","bsLocaleService","errorHandler","modalService","transactionService","banners","subs","Subscription","state$","zip","globalPosition$","map","globalPosition","account","deposit","maxDateTo","Date","minDateFrom","moment","subtract","format","formSubmit","invalidOtp","now","dateCustomClasses","date","classes","use","createForm","today","lastMonth","getMonth","getDay","getFullYear","searchForm","group","dateFrom","required","dateTo","valid","currentSearch","fechaDesde","formatCustomDate","f","value","fechaHasta","makeSearch","ref","modalRef","content","show","customFormat","openModal","invalidMovimentsOtpCode","add","switchMap","state","iban","IBAN","subscribe","otpId","otpModal","showError","secretKey","closeModal","movementsSearchList","getTransaction","Acuerdo","result","showMsgTableEmpty","item","hide","control","invalid","destroy","unsubscribe","controls","TransactionsComponent","TransactionsRoutingModule","routes","path","component","headerService","router","rangeDays","movementsList","updateTitle","fetchGlobalPosition","filter","navigate","forChild","TransactionsModule"],"mappings":"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","file":"x","sourcesContent":["import { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { CasePayload } from './../../../api/models/case-payload.model';\r\nimport { Injectable } from '@angular/core';\r\nimport { SalesforceResponse, OtpOutput, ApiError } from '@api/models';\r\nimport { environment } from '@environment/environment';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { PrivateMovementsData } from '@api/models/private-movements-data';\r\nimport { CurrentSearch } from '@api/models/moviments-serach';\r\nimport { pluck, catchError } from 'rxjs/operators';\r\nimport { OtpMoviments } from '@core/models/otp-movimentes';\r\nimport { ApiErrors } from '@api/constants';\r\nimport { of } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class TransactionService {\r\n  constructor(private httpClient: HttpClient, private errorHandlerService: ErrorHandlerService) {}\r\n\r\n  getTransaction(\r\n    acuerdo: string,\r\n    dateFromParam: string,\r\n    dateToParam: string,\r\n    referenceOTP?: string\r\n  ) {\r\n    // tslint:disable-next-line: max-line-length\r\n    let url = `${environment.apiBasePath}${environment.endpoints.trasactions.get}?acuerdo=${acuerdo}&fechaDesde=${dateFromParam}&fechaHasta=${dateToParam}`;\r\n    if (referenceOTP) {\r\n      url = `${url}&referenceOTP=${referenceOTP}`;\r\n    }\r\n    return this.httpClient.get<SalesforceResponse<PrivateMovementsData>>(url).pipe(\r\n      catchError((error: ApiError) => {\r\n        if (error.errorCode === ApiErrors.MOV_NOT_FOUND) {\r\n          return of({ code: ApiErrors.MOV_NOT_FOUND, data: [] });\r\n        }\r\n        return this.errorHandlerService.redirectErrorPage(error);\r\n      })\r\n    );\r\n  }\r\n\r\n  generateOtp(body: OtpMoviments) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.trasactions.generateOtp}`;\r\n    return this.httpClient.post<any>(url, body);\r\n  }\r\n\r\n  validateOtp(body: OtpMoviments) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.trasactions.validateOtp}`;\r\n    return this.httpClient.put<any>(url, body);\r\n  }\r\n}\r\n","import { MOVEMENTS_TYPE_ENUM } from './../../../core/constants/origen-apunte.constant';\r\nimport { Component, OnInit, Input, Inject } from '@angular/core';\r\nimport { MOVEMENTS_TYPE } from '@core/constants/origen-apunte.constant';\r\nimport { PrivateMovementsListaApuntesCliente } from '@api/models/private-movements-lista-apuntes-cliente';\r\n\r\n@Component({\r\n  selector: 'app-transaction-item',\r\n  templateUrl: './transaction-item.component.html',\r\n  styleUrls: ['./transaction-item.component.scss'],\r\n})\r\nexport class TransactionItemComponent implements OnInit {\r\n  isOpen = false;\r\n  @Input() movement: PrivateMovementsListaApuntesCliente;\r\n\r\n  constructor(\r\n    @Inject(MOVEMENTS_TYPE) public movementsType: Array<{ code: string; name: string }>\r\n\r\n  ) {}\r\n\r\n  ngOnInit(): void {}\r\n\r\n  open() {\r\n    this.isOpen = !this.isOpen;\r\n  }\r\n\r\n  get description(): string {\r\n    const origenApunte = this.movementsType.find((oa) => oa.code === this.movement.codigoOrigenApunte);\r\n    return origenApunte?.name;\r\n  }\r\n\r\n  /*\r\n   * Iconos por tipo de transaccion:\r\n   * Ingreso a depósito (IP): ico-euro\r\n   * Intereses (??): ico-percent\r\n   * Penalizaciones (??): ico-lightning\r\n   * Tranferecnias (TF o TR): ico-transfer\r\n   * Liquidacion de depósitos (HL): ico-refund\r\n   * Otros: ico-bookmark\r\n   */\r\n\r\n  get getIcon(): string {\r\n    let icon = null;\r\n    switch (this.movement.codigoOrigenApunte) {\r\n      case MOVEMENTS_TYPE_ENUM.ACUERDO:\r\n      case MOVEMENTS_TYPE_ENUM.APORTACION:\r\n      case MOVEMENTS_TYPE_ENUM.CHEQUE_PAGARE:\r\n      case MOVEMENTS_TYPE_ENUM.CHEQUE_PROPIO:\r\n      case MOVEMENTS_TYPE_ENUM.CHEQUE_EXTRANJERO:\r\n      case MOVEMENTS_TYPE_ENUM.EFECTO_COMERCIAL:\r\n      case MOVEMENTS_TYPE_ENUM.EFECTO_RECIBIDO:\r\n      case MOVEMENTS_TYPE_ENUM.EMBARGO:\r\n      case MOVEMENTS_TYPE_ENUM.IMPOSICION:\r\n      case MOVEMENTS_TYPE_ENUM.RECIBO_DOMICILIADO_RZ:\r\n      case MOVEMENTS_TYPE_ENUM.RECIBO_DOMICILIADO_RB:\r\n      case MOVEMENTS_TYPE_ENUM.RECIBO_VENTANILLA:\r\n      case MOVEMENTS_TYPE_ENUM.REMESA:\r\n      case MOVEMENTS_TYPE_ENUM.RETRO_PENSIONES:\r\n      case MOVEMENTS_TYPE_ENUM.SUBVENCION:\r\n        icon = 'ico-euro';\r\n        break;\r\n\r\n      case MOVEMENTS_TYPE_ENUM.LIQUIDACION:\r\n        icon = 'ico-refund';\r\n        break;\r\n\r\n      case MOVEMENTS_TYPE_ENUM.TRANSFERENCIA_SEPA_TR:\r\n      case MOVEMENTS_TYPE_ENUM.TRASPASO:\r\n        icon = 'ico-transfer';\r\n        break;\r\n\r\n      case MOVEMENTS_TYPE_ENUM.CARG_COMIS_C57_GRP:\r\n        icon = 'ico-percent';\r\n        break;\r\n\r\n      case MOVEMENTS_TYPE_ENUM.COMIS_TRASP_VAL:\r\n        icon = 'ico-lightning';\r\n        break;\r\n\r\n      default:\r\n        icon = 'ico-bookmark';\r\n        break;\r\n    }\r\n    return icon;\r\n  }\r\n\r\n  get isPositive() {\r\n    return this.movement.signo === 'H' ? true : false;\r\n  }\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\nexport enum MOVEMENTS_TYPE_ENUM {\r\n  ACUERDO = 'AC',\r\n  APORTACION = 'AO',\r\n  CHEQUE_PAGARE = 'CJ',\r\n  CHEQUE_PROPIO = 'CP',\r\n  EFECTO_COMERCIAL = 'EC',\r\n  EFECTO_RECIBIDO = 'EJ',\r\n  EMBARGO = 'EM',\r\n  EXPEDIENTE_RECLAMACION = 'ER',\r\n  FONDO_INVERSION = 'CV',\r\n  IMPOSICION = 'IP',\r\n  LIQUIDACION = 'HL',\r\n  OPERACION_VALORES = 'VA',\r\n  OPERACION_EXTRANJERO = 'XO',\r\n  OPERACION_RENTA_FIJA = 'RF',\r\n  OPERACION_DIVERSA = 'OP',\r\n  OPERACION_REPO = 'RO',\r\n  PENSIONES = 'PE',\r\n  RECIBO_DOMICILIADO_RZ = 'RZ',\r\n  RECIBO_DOMICILIADO_RB = 'RB',\r\n  RECIBO_VENTANILLA = 'RV',\r\n  REMESA = 'RM',\r\n  RETRO_PENSIONES = 'TG',\r\n  SUBVENCION = 'SV',\r\n  TRANSFERENCIA_SEPA_TF = 'TF',\r\n  TRANSFERENCIA_SEPA_TR = 'TR',\r\n  TRASPASO = 'RQ',\r\n  APUNTE = 'AF',\r\n  APUNTE_MANUAL = 'AM',\r\n  BOLETA_CUC = 'BQ',\r\n  CARG_COMIS_C57_GRP = 'CG',\r\n  CHEQUE_EXTRANJERO = 'XC',\r\n  COMIS_TRASP_VAL = 'CT',\r\n  DESINTER_INVERSIS = 'DI',\r\n  DOCUMENTOS_VARIOS = 'DJ',\r\n  FACT_CON = 'EG',\r\n}\r\n\r\nconst Movements = [\r\n  { code: MOVEMENTS_TYPE_ENUM.ACUERDO, name: 'transaction_ac' },\r\n  { code: MOVEMENTS_TYPE_ENUM.APORTACION, name: 'transaction_ao' },\r\n  { code: MOVEMENTS_TYPE_ENUM.CHEQUE_PAGARE, name: 'transaction_cj' },\r\n  { code: MOVEMENTS_TYPE_ENUM.CHEQUE_PROPIO, name: 'transaction_cp' },\r\n  { code: MOVEMENTS_TYPE_ENUM.EFECTO_COMERCIAL, name: 'transaction_ec' },\r\n  { code: MOVEMENTS_TYPE_ENUM.EFECTO_RECIBIDO, name: 'transaction_ej' },\r\n  { code: MOVEMENTS_TYPE_ENUM.EMBARGO, name: 'transaction_em' },\r\n  { code: MOVEMENTS_TYPE_ENUM.EXPEDIENTE_RECLAMACION, name: 'transaction_er' },\r\n  { code: MOVEMENTS_TYPE_ENUM.FONDO_INVERSION, name: 'transaction_cv' },\r\n  { code: MOVEMENTS_TYPE_ENUM.IMPOSICION, name: 'transaction_ip' },\r\n  { code: MOVEMENTS_TYPE_ENUM.LIQUIDACION, name: 'transaction_hl' },\r\n  { code: MOVEMENTS_TYPE_ENUM.OPERACION_VALORES, name: 'transaction_va' },\r\n  { code: MOVEMENTS_TYPE_ENUM.OPERACION_EXTRANJERO, name: 'transaction_xo' },\r\n  { code: MOVEMENTS_TYPE_ENUM.OPERACION_RENTA_FIJA, name: 'transaction_rf' },\r\n  { code: MOVEMENTS_TYPE_ENUM.OPERACION_DIVERSA, name: 'transaction_op' },\r\n  { code: MOVEMENTS_TYPE_ENUM.OPERACION_REPO, name: 'transaction_ro' },\r\n  { code: MOVEMENTS_TYPE_ENUM.PENSIONES, name: 'transaction_pe' },\r\n  { code: MOVEMENTS_TYPE_ENUM.RECIBO_DOMICILIADO_RZ, name: 'transaction_rz' },\r\n  { code: MOVEMENTS_TYPE_ENUM.RECIBO_DOMICILIADO_RB, name: 'transaction_rb' },\r\n  { code: MOVEMENTS_TYPE_ENUM.RECIBO_VENTANILLA, name: 'transaction_rv' },\r\n  { code: MOVEMENTS_TYPE_ENUM.REMESA, name: 'transaction_rm' },\r\n  { code: MOVEMENTS_TYPE_ENUM.RETRO_PENSIONES, name: 'transaction_tg' },\r\n  { code: MOVEMENTS_TYPE_ENUM.SUBVENCION, name: 'transaction_sv' },\r\n  { code: MOVEMENTS_TYPE_ENUM.TRANSFERENCIA_SEPA_TF, name: 'transaction_tf' },\r\n  { code: MOVEMENTS_TYPE_ENUM.TRANSFERENCIA_SEPA_TR, name: 'transaction_tr' },\r\n  { code: MOVEMENTS_TYPE_ENUM.TRASPASO, name: 'transaction_rq' },\r\n  { code: MOVEMENTS_TYPE_ENUM.APUNTE, name: 'transaction_af' },\r\n  { code: MOVEMENTS_TYPE_ENUM.APUNTE_MANUAL, name: 'transaction_am' },\r\n  { code: MOVEMENTS_TYPE_ENUM.BOLETA_CUC, name: 'transaction_bq' },\r\n  { code: MOVEMENTS_TYPE_ENUM.CARG_COMIS_C57_GRP, name: 'transaction_cg' },\r\n  { code: MOVEMENTS_TYPE_ENUM.CHEQUE_EXTRANJERO, name: 'transaction_xc' },\r\n  { code: MOVEMENTS_TYPE_ENUM.COMIS_TRASP_VAL, name: 'transaction_ct' },\r\n  { code: MOVEMENTS_TYPE_ENUM.DESINTER_INVERSIS, name: 'transaction_di' },\r\n  { code: MOVEMENTS_TYPE_ENUM.DOCUMENTOS_VARIOS, name: 'transaction_dj' },\r\n  { code: MOVEMENTS_TYPE_ENUM.FACT_CON, name: 'transaction_eg' },\r\n];\r\n\r\nexport const MOVEMENTS_TYPE = new InjectionToken('MOVEMENTS_TYPE', {\r\n  providedIn: 'root',\r\n  factory: () => Movements,\r\n});\r\n","<div class=\"table__body__row\">\r\n  <div class=\"table__body__title\" (click)=\"open()\">\r\n    <div class=\"table__body__title__group\">\r\n      <p class=\"table__body__title__group__col\">\r\n        {{ movement.fechaOperacion | date: 'dd/MM/yyyy' }}\r\n      </p>\r\n    </div>\r\n    <div class=\"table__body__title__group\">\r\n      <p class=\"table__body__title__group__col\" [class]=\"getIcon\"></p>\r\n    </div>\r\n    <div class=\"table__body__title__group\">\r\n      <p class=\"table__body__title__group__col\">\r\n        {{description | translate}}\r\n      </p>\r\n    </div>\r\n    <div class=\"table__body__title__group\">\r\n      <p class=\"table__body__title__group__col\" [ngClass]=\"{ 'text-green': isPositive }\">\r\n        <!-- {{ isPositive ? '':'-' }} -->\r\n        {{ movement.importeApunte | currency: '€' }}\r\n      </p>\r\n      <p class=\"table__body__title__group__col\">{{ movement.saldoArrastre | currency: '€' }}</p>\r\n    </div>\r\n  </div>\r\n  <div class=\"table__body__detail\" [hidden]=\"!isOpen\">\r\n    <div class=\"table__body__detail__row\">\r\n      <p>{{'transaction_value_date' | translate}}:</p>\r\n      <p>{{ movement.fechaValor | date: 'dd/MM/yyyy'}}</p>\r\n    </div>\r\n    <div class=\"table__body__detail__row\">\r\n      <p>{{'transaction_concept' | translate}}:</p>\r\n      <p>{{ movement.textoRemitente }}</p>\r\n    </div>\r\n    <!-- <div class=\"table__body__detail__row\">\r\n      <p>{{'transaction_ordering' | translate}}:</p>\r\n      <p>{{ movement.codigoOrigen }}</p>\r\n    </div>\r\n    <div class=\"table__body__detail__row\">\r\n      <p>{{'transaction_beneficiary' | translate}}:</p>\r\n      <p>{{ movement.identificadorOrigenApunte }}</p>\r\n    </div>\r\n    <div class=\"table__body__detail__row\">\r\n      <p>{{'transaction_commissions' | translate}}:</p>\r\n      <p>{{ movement.importeApunte | currency: '€' }}</p>\r\n    </div> -->\r\n  </div>\r\n</div>\r\n","<ng-container *ngIf=\"state$ | async as state\">\r\n  <div class=\"max-size transaction-search\">\r\n    <div class=\"main\" *ngIf=\"state?.account\">\r\n      <div class=\"main-col\">\r\n        <div class=\"main__header\">\r\n          <div class=\"main__header__desktop\">\r\n            <div class=\"main__header__title\">\r\n              <div class=\"main__header__title__col\">\r\n                <h1>{{ 'Buscador de movimientos' | translate }}</h1>\r\n                <p>\r\n                  {{ 'transaction_save_account' | translate }} {{ state.account.IBAN | formatIban }}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"main__header__mobile\">\r\n            <div class=\"main__header__mobile__col\">\r\n              <h1>{{ state.account.Balance | currency }}</h1>\r\n              <p>{{ state.account.IBAN | formatIban }}</p>\r\n              <span class=\"ico-search-1\"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"main__body\">\r\n          <form [formGroup]=\"searchForm\" (submit)=\"search()\">\r\n            <div class=\"group-input input-text\">\r\n              <label for=\"dateFrom\">{{ 'transaction_date_from' | translate }}</label>\r\n              <span class=\"ico-calendary icon-input yellow\"></span>\r\n              <input\r\n                id=\"dateFrom\"\r\n                type=\"text\"\r\n                bsDatepicker\r\n                formControlName=\"dateFrom\"\r\n                [minDate]=\"minDateFrom\"\r\n                [maxDate]=\"maxDateFrom\"\r\n                [bsConfig]=\"{ dateInputFormat: 'DD/MM/YYYY' }\"\r\n                [placeholder]=\"'dd/mm/aaaa' | translate\"\r\n                [ngClass]=\"{ error: hasError(searchForm.get('dateFrom')) }\"\r\n                [dateCustomClasses]=\"dateCustomClasses\"\r\n              />\r\n            </div>\r\n            <div class=\"group-input input-text\">\r\n              <label for=\"dateTo\">{{ 'transaction_date_to' | translate }}</label>\r\n              <span class=\"ico-calendary icon-input yellow\"></span>\r\n              <input\r\n                id=\"dateTo\"\r\n                type=\"text\"\r\n                bsDatepicker\r\n                formControlName=\"dateTo\"\r\n                [minDate]=\"minDateTo\"\r\n                [maxDate]=\"maxDateTo\"\r\n                [bsConfig]=\"{ dateInputFormat: 'DD/MM/YYYY' }\"\r\n                [placeholder]=\"'dd/mm/aaaa' | translate\"\r\n                [ngClass]=\"{ error: hasError(searchForm.get('dateTo')) }\"\r\n                [dateCustomClasses]=\"dateCustomClasses\"\r\n              />\r\n            </div>\r\n            <div class=\"group-button\">\r\n              <button type=\"submit\" class=\"btn--primary-small\">\r\n                {{ 'transaction_btn_search' | translate }}\r\n              </button>\r\n            </div>\r\n            <div class=\"main__button\">\r\n              <button type=\"submit\" class=\"btn--primary\">\r\n                {{ 'transaction_btn_search' | translate }}\r\n              </button>\r\n            </div>\r\n          </form>\r\n          <div class=\"table\">\r\n            <div class=\"table__header\">\r\n              <p>{{ 'transaction_date' | translate }}</p>\r\n              <p>{{ 'transaction_description' | translate }}</p>\r\n              <p>{{ 'transaction_amount' | translate }}</p>\r\n              <p>{{ 'transaction_balance' | translate }}</p>\r\n            </div>\r\n            <div class=\"table__body\" *ngIf=\"movementsSearchList?.length\">\r\n              <div\r\n                class=\"table__body__section\"\r\n                *ngFor=\"\r\n                  let item of movementsSearchList\r\n                    | groupBy: 'fechaOperacion'\r\n                    | keyvalue\r\n                    | sortBy: 'desc':'key';\r\n                  trackBy: trackByDates\r\n                \"\r\n              >\r\n                <p class=\"table__body__section__date\">\r\n                  {{ item.key | date: 'dd/MM/yyyy' }}\r\n                </p>\r\n                <app-transaction-item\r\n                  [movement]=\"movement\"\r\n                  *ngFor=\"let movement of item.value\"\r\n                ></app-transaction-item>\r\n              </div>\r\n            </div>\r\n            <div class=\"table__body\" *ngIf=\"!movementsSearchList?.length && showMsgTableEmpty\">\r\n              <div class=\"table__body__title\">\r\n                <p class=\"table__body__title__group__col\">\r\n                  {{\r\n                    'transaction_movements_search_not_found'\r\n                      | translate\r\n                        : {\r\n                            dateFrom: formatCustomDate(f.dateFrom.value, 'dd/MM/yyyy'),\r\n                            dateTo: formatCustomDate(f.dateTo.value, 'dd/MM/yyyy')\r\n                          }\r\n                  }}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <!-- <a class=\"table__actions\" [routerLink]=\"'../'\">\r\n              <span class=\"ico-refresh\"></span>\r\n              <p>{{ 'Volver' | translate | uppercase }}</p>\r\n            </a> -->\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"aside-col\" [appBannerBackground]=\"banners.transactions\">\r\n        <app-aside-banner [globalPosition]=\"state.globalPosition\"></app-aside-banner>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <ng-template #otpModal>\r\n    <app-otp-form\r\n      [invalidCode]=\"invalidMovimentsOtpCode\"\r\n      (hide)=\"closeModal()\"\r\n      (send)=\"validateOtp($event)\"\r\n      (repeat)=\"generateOtp(false)\"\r\n    >\r\n    </app-otp-form>\r\n  </ng-template>\r\n</ng-container>\r\n","import { format } from 'util';\r\nimport { TransactionService } from '@core/services/transactions/transaction.service';\r\nimport { FormGroup, FormBuilder, Validators, AbstractControl } from '@angular/forms';\r\nimport { Component, OnInit, ViewChild, TemplateRef, OnDestroy, Inject } from '@angular/core';\r\nimport { DatepickerDateCustomClasses, BsLocaleService } from 'ngx-bootstrap/datepicker';\r\nimport * as moment from 'moment';\r\nimport { BsModalRef, BsModalService } from 'ngx-bootstrap/modal';\r\nimport { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { Subscription, zip } from 'rxjs';\r\nimport { CurrentSearch } from '@api/models/moviments-serach';\r\nimport { formatDate } from '@angular/common';\r\nimport { GlobalPositionService } from '@core/services/global-position/global-position.service';\r\nimport { GlobalPosition, FinancialAccount } from '@api/models';\r\nimport { ProductTypes } from '@core/constants';\r\nimport { map, switchMap, finalize } from 'rxjs/operators';\r\nimport { PrivateMovementsData } from '@api/models/private-movements-data';\r\nimport { findAccount, findDeposit, isInvalidOtp } from '@core/utils';\r\nimport { PrivateMovementsListaApuntesCliente } from '@api/models/private-movements-lista-apuntes-cliente';\r\nimport { ApiErrors } from '@api/constants';\r\nimport { Banners, BANNERS } from '@core/constants/banners.constants';\r\n\r\n@Component({\r\n  selector: 'app-transaction-search',\r\n  templateUrl: './transaction-search.component.html',\r\n  styleUrls: ['./transaction-search.component.scss'],\r\n})\r\nexport class TransactionSearchComponent implements OnInit, OnDestroy {\r\n  @ViewChild('otpModal') otpModal: TemplateRef<any>;\r\n  private subs = new Subscription();\r\n  state$ = zip(\r\n    this.globalPositionService.globalPosition$,\r\n    this.globalPositionService.globalPosition$.pipe(findAccount()),\r\n    this.globalPositionService.globalPosition$.pipe(findDeposit())\r\n  ).pipe(map(([globalPosition, account, deposit]) => ({ globalPosition, account, deposit })));\r\n\r\n  acuerdo: string;\r\n  IBAN: string;\r\n  searchForm: FormGroup;\r\n  movementsSearchList: Array<PrivateMovementsListaApuntesCliente>;\r\n  maxDateTo = new Date();\r\n  minDateFrom = new Date(moment().subtract(365, 'days').format('L'));\r\n  dateCustomClasses: DatepickerDateCustomClasses[];\r\n  dateFrom: Date;\r\n  dateTo: Date;\r\n  formSubmit = false;\r\n  private otpId: string;\r\n  private modalRef: BsModalRef;\r\n  invalidOtp = false;\r\n  currentSearch: CurrentSearch;\r\n  saveAccount: FinancialAccount;\r\n  showMsgTableEmpty: boolean;\r\n  invalidMovimentsOtpCode: boolean;\r\n\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    private globalPositionService: GlobalPositionService,\r\n    private bsLocaleService: BsLocaleService,\r\n    private errorHandler: ErrorHandlerService,\r\n    private modalService: BsModalService,\r\n    private transactionService: TransactionService,\r\n    @Inject(BANNERS) public readonly banners: Banners\r\n  ) {\r\n    moment.locale('es');\r\n    const now = new Date();\r\n    this.dateCustomClasses = [{ date: now, classes: [] }];\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.bsLocaleService.use('es');\r\n    this.createForm();\r\n  }\r\n\r\n  get maxDateFrom() {\r\n    return this.f.dateTo.value ? new Date(this.f.dateTo.value) : new Date();\r\n  }\r\n\r\n  get minDateTo() {\r\n    return this.f.dateFrom.value\r\n      ? new Date(this.f.dateFrom.value)\r\n      : new Date(moment().subtract(365, 'days').format('L'));\r\n  }\r\n\r\n  private createForm() {\r\n    const today = new Date();\r\n    const lastMonth = new Date(\r\n      `${today.getMonth() > 0 ? today.getMonth() : 1}/${today.getDay()}/${today.getFullYear()}`\r\n    );\r\n\r\n    this.searchForm = this.formBuilder.group({\r\n      dateFrom: [lastMonth, [Validators.required]],\r\n      dateTo: [today, [Validators.required]],\r\n    });\r\n  }\r\n\r\n  get f() {\r\n    return this.searchForm.controls;\r\n  }\r\n\r\n  search() {\r\n    this.formSubmit = true;\r\n    if (this.searchForm.valid) {\r\n      this.currentSearch = {\r\n        acuerdo: this.acuerdo,\r\n        fechaDesde: this.formatCustomDate(this.f.dateFrom.value),\r\n        fechaHasta: this.formatCustomDate(this.f.dateTo.value),\r\n      };\r\n      this.makeSearch();\r\n    }\r\n  }\r\n\r\n  openModal(ref: TemplateRef<any>) {\r\n    if (!this.modalRef || (this.modalRef && !this.modalRef.content)) {\r\n      this.modalRef = this.modalService.show(ref);\r\n    }\r\n  }\r\n\r\n  formatCustomDate(date: Date, customFormat?: string) {\r\n    return formatDate(date, customFormat || 'yyyy-MM-dd', 'es');\r\n  }\r\n\r\n  generateOtp(openModal?: boolean) {\r\n    this.invalidMovimentsOtpCode = false;\r\n    this.subs.add(\r\n      this.state$\r\n        .pipe(\r\n          switchMap((state) =>\r\n            this.transactionService.generateOtp({\r\n              iban: state.account.IBAN,\r\n              dateFrom: this.currentSearch.fechaDesde,\r\n              dateTo: this.currentSearch.fechaHasta,\r\n            })\r\n          )\r\n        )\r\n        .subscribe(\r\n          ({ otpId }) => {\r\n            this.otpId = otpId;\r\n            if (openModal) {\r\n              this.openModal(this.otpModal);\r\n            }\r\n          },\r\n          (error) => {\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  validateOtp(secretKey: string) {\r\n    this.subs.add(\r\n      this.state$\r\n        .pipe(\r\n          switchMap((state) =>\r\n            this.transactionService.validateOtp({\r\n              iban: state.account.IBAN,\r\n              dateFrom: this.currentSearch.fechaDesde,\r\n              dateTo: this.currentSearch.fechaHasta,\r\n              otpId: this.otpId,\r\n              secretKey,\r\n            })\r\n          )\r\n        )\r\n        .subscribe(\r\n          ({ code }) => {\r\n            this.makeSearch(this.otpId);\r\n            this.closeModal();\r\n          },\r\n          (error) => {\r\n            if (isInvalidOtp(error)) {\r\n              this.invalidMovimentsOtpCode = true;\r\n              return;\r\n            }\r\n            this.errorHandler.showError(error);\r\n            this.closeModal();\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  makeSearch(referenceOTP?: string) {\r\n    this.movementsSearchList = [];\r\n    this.subs.add(\r\n      this.state$\r\n        .pipe(\r\n          switchMap((state) =>\r\n            this.transactionService.getTransaction(\r\n              state.account.Acuerdo,\r\n              this.currentSearch.fechaDesde,\r\n              this.currentSearch.fechaHasta,\r\n              referenceOTP\r\n            )\r\n          )\r\n        )\r\n        .subscribe(\r\n          (result) => {\r\n            if (result) {\r\n              switch (result.code) {\r\n                case 'OK':\r\n                case ApiErrors.MOV_NOT_FOUND:\r\n                  this.movementsSearchList = result ? result.data : [];\r\n                  this.showMsgTableEmpty = true;\r\n                  break;\r\n                case 'FECHA_NO_VALIDA_REQUIERE_OTP':\r\n                  this.generateOtp(true);\r\n                  break;\r\n                case 'NO_EXISTE_OTP':\r\n                  this.movementsSearchList = [];\r\n                  this.errorHandler.showError({ errorCode: result.code });\r\n                  break;\r\n\r\n                default:\r\n                  this.movementsSearchList = [];\r\n                  break;\r\n              }\r\n            }\r\n          },\r\n          (error) => {\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  trackByDates(item: { [key: string]: PrivateMovementsListaApuntesCliente }) {\r\n    return item.date;\r\n  }\r\n\r\n  closeModal() {\r\n    this.modalRef.hide();\r\n  }\r\n\r\n  hasError(control: AbstractControl) {\r\n    return this.formSubmit && control.invalid;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.globalPositionService.destroy();\r\n    this.subs.unsubscribe();\r\n  }\r\n}\r\n","<ng-container *ngIf=\"state$ | async as state\">\r\n  <div class=\"max-size transactions\">\r\n    <div class=\"main\" *ngIf=\"state?.account\">\r\n      <div class=\"main-col\">\r\n        <div class=\"main__header\">\r\n          <div class=\"main__header__desktop\">\r\n            <div class=\"main__header__title\">\r\n              <div class=\"main__header__title__col\">\r\n                <h1>{{ 'transaction_save_account' | translate }}</h1>\r\n                <p>{{ state.account.IBAN | formatIban }}</p>\r\n              </div>\r\n              <div class=\"main__header__title__col\">\r\n                <p>{{ 'transaction_available_balance' | translate }}</p>\r\n                <h1>{{ state.account.Balance | currency }}</h1>\r\n              </div>\r\n            </div>\r\n            <div class=\"main__header__buttons\">\r\n              <button\r\n                *ngIf=\"state?.deposit\"\r\n                type=\"button\"\r\n                class=\"btn--primary-small\"\r\n                routerLink=\"../../deposit/new-imposition\"\r\n              >\r\n                {{ 'transaction_btn_deposit' | translate }}\r\n              </button>\r\n              <button type=\"button\" class=\"btn--terciary-small\" routerLink=\"../../transfer\">\r\n                {{ 'transaction_btn_transfer' | translate }}\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div class=\"main__header__mobile\">\r\n            <div class=\"main__header__mobile__col\">\r\n              <h1>{{ state.account.Balance | currency }}</h1>\r\n              <p>{{ state.account.IBAN | formatIban }}</p>\r\n              <span class=\"ico-search-1\" [routerLink]=\"'search'\"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"main__body\">\r\n          <div class=\"table\">\r\n            <div class=\"table__header\">\r\n              <p>{{ 'transaction_date' | translate }}</p>\r\n              <p>{{ 'transaction_description' | translate }}</p>\r\n              <p>{{ 'transaction_amount' | translate }}</p>\r\n              <p>{{ 'transaction_balance' | translate }}</p>\r\n            </div>\r\n            <div class=\"table__body\" *ngIf=\"movementsList?.length\">\r\n              <div\r\n                class=\"table__body__section\"\r\n                *ngFor=\"\r\n                  let item of movementsList\r\n                    | groupBy: 'fechaOperacion'\r\n                    | keyvalue\r\n                    | sortBy: 'desc':'key';\r\n                  trackBy: trackByDates\r\n                \"\r\n              >\r\n                <p class=\"table__body__section__date\">\r\n                  {{ item.key | date: 'dd/MM/yyyy' }}\r\n                </p>\r\n                <app-transaction-item\r\n                  [movement]=\"movement\"\r\n                  *ngFor=\"let movement of item.value\"\r\n                ></app-transaction-item>\r\n              </div>\r\n            </div>\r\n            <div class=\"table__body\" *ngIf=\"!movementsList?.length && showMsgTableEmpty\">\r\n              <div class=\"table__body__title\">\r\n                <p class=\"table__body__title__group__col\">\r\n                  {{\r\n                    'transaction_movements_last_month_not_found' | translate: { days: rangeDays }\r\n                  }}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <a class=\"table__actions\" [routerLink]=\"'search'\">\r\n              <span class=\"ico-search-1\"></span>\r\n              <p>{{ 'transaction_look_for_movements' | translate | uppercase }}</p>\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"aside-col\" [appBannerBackground]=\"banners.transactions\">\r\n        <app-aside-banner [globalPosition]=\"state.globalPosition\"></app-aside-banner>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"main__button group-button\">\r\n    <button type=\"button\" class=\"btn--secondary\" routerLink=\"../../transfer\">\r\n      {{ 'transaction_btn_transfer' | translate }}\r\n    </button>\r\n    <button type=\"button\" class=\"btn--primary\" routerLink=\"../../deposit/new-imposition\">\r\n      {{ 'transaction_btn_deposit' | translate }}\r\n    </button>\r\n  </div>\r\n</ng-container>\r\n","import { TransactionSearchComponent } from './components/transaction-search/transaction-search.component';\r\nimport { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { TransactionsComponent } from './transactions.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: TransactionsComponent,\r\n  },\r\n  {\r\n    path: 'search',\r\n    component: TransactionSearchComponent,\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class TransactionsRoutingModule {}\r\n","import { PrivateMovementsData } from '@api/models/private-movements-data';\r\nimport { FinancialAccount } from '@api/models';\r\nimport { GlobalPositionService } from '@core/services/global-position/global-position.service';\r\nimport { Router } from '@angular/router';\r\nimport { Component, OnInit, OnDestroy, Inject } from '@angular/core';\r\nimport { HeaderService } from '@core/services/header/header.service';\r\nimport { TransactionService } from '@core/services/transactions/transaction.service';\r\nimport * as moment from 'moment';\r\nimport { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { zip, Subscription } from 'rxjs';\r\nimport { map, switchMap, filter, retry } from 'rxjs/operators';\r\nimport { findAccount, findDeposit } from '@core/utils';\r\nimport { PrivateMovementsListaApuntesCliente } from '@api/models/private-movements-lista-apuntes-cliente';\r\nimport { Banners, BANNERS } from '@core/constants/banners.constants';\r\n\r\n@Component({\r\n  selector: 'app-transactions',\r\n  templateUrl: './transactions.component.html',\r\n  styles: [],\r\n})\r\nexport class TransactionsComponent implements OnInit, OnDestroy {\r\n  readonly rangeDays = 89;\r\n  readonly state$ = zip(\r\n    this.globalPositionService.globalPosition$,\r\n    this.globalPositionService.globalPosition$.pipe(findAccount()),\r\n    this.globalPositionService.globalPosition$.pipe(findDeposit())\r\n  ).pipe(map(([globalPosition, account, deposit]) => ({ globalPosition, account, deposit })));\r\n\r\n  movementsList: Array<PrivateMovementsListaApuntesCliente> = [];\r\n  acuerdo: string;\r\n  saveAccount: FinancialAccount;\r\n  showMsgTableEmpty: boolean;\r\n\r\n  private subs = new Subscription();\r\n\r\n  constructor(\r\n    private headerService: HeaderService,\r\n    private globalPositionService: GlobalPositionService,\r\n    private router: Router,\r\n    private transactionService: TransactionService,\r\n    private errorHandler: ErrorHandlerService,\r\n    @Inject(BANNERS) public readonly banners: Banners\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.headerService.updateTitle('menu_accounts_web');\r\n    this.globalPositionService.fetchGlobalPosition();\r\n\r\n    const dateFrom = moment().subtract(this.rangeDays, 'days').format('YYYY-MM-DD');\r\n    const dateTo = moment().format('YYYY-MM-DD');\r\n\r\n    this.subs.add(\r\n      this.state$\r\n        .pipe(\r\n          filter((state) => !!state?.account),\r\n          switchMap((state) =>\r\n            this.transactionService.getTransaction(state?.account.Acuerdo, dateFrom, dateTo)\r\n          )\r\n        )\r\n        .subscribe(\r\n          (result) => {\r\n            this.movementsList = result?.data;\r\n            this.showMsgTableEmpty = true;\r\n          },\r\n          (error) => {\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  openSearch() {\r\n    this.router.navigate(['/search']);\r\n  }\r\n\r\n  trackByDates(item: { [key: string]: PrivateMovementsListaApuntesCliente }) {\r\n    return item.date;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.globalPositionService.destroy();\r\n    this.subs.unsubscribe();\r\n  }\r\n}\r\n","import { TransactionSearchComponent } from './components/transaction-search/transaction-search.component';\r\nimport { TransactionItemComponent } from './components/transaction-item/transaction-item.component';\r\nimport { SharedModule } from './../shared/shared.module';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { TransactionsRoutingModule } from './transactions-routing.module';\r\nimport { TransactionsComponent } from './transactions.component';\r\n\r\n@NgModule({\r\n  declarations: [TransactionsComponent, TransactionItemComponent, TransactionSearchComponent],\r\n  imports: [CommonModule, TransactionsRoutingModule, SharedModule],\r\n})\r\nexport class TransactionsModule {}\r\n"]}