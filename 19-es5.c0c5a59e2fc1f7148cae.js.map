{"version":3,"sources":["webpack:///src/app/core/services/transfer/transfer.service.ts","webpack:///src/app/transfer/utils/transfer.validators.ts","webpack:///src/app/transfer/components/transfer-form/transfer-form.component.html","webpack:///src/app/transfer/components/transfer-form/transfer-form.component.ts","webpack:///src/app/transfer/transfer.component.html","webpack:///src/app/transfer/pages/success-transfer/success-transfer.component.ts","webpack:///src/app/transfer/transfer.component.ts","webpack:///src/app/transfer/transfer-routing.module.ts","webpack:///src/app/transfer/pages/success-transfer/success-transfer.component.html","webpack:///src/app/transfer/transfer.module.ts"],"names":["TransferService","http","transfer","this","post","environment","apiBasePath","endpoints","simulate","otp","confirm","amountValidator","control","amount","value","isNaN","invalidAmount","minAmountError","TransferFormComponent","formBuilder","submitForm","submitted","createForm","form","markAllAsTouched","valid","emit","concept","touched","invalid","balance","group","required","balanceError","amountControl","get","hasError","onSubmit","SuccessTransferComponent","TransferComponent","TransferRoutingModule","routes","path","component","headerService","transferService","accountService","errorHandler","modalService","globalPositionService","router","route","banners","state$","createState","invalidOtp","subs","Subscription","fetchGlobalPosition","updateTitle","unsubscribe","closeModal","ref","getModalsCount","modalRef","show","hide","referenceOTP","add","currentTransfer","subscribe","openModal","otpModal","error","showError","pipe","switchMap","state","toString","sender","iban","account","IBAN","name","customerName","receiver","globalPosition","OriginIBAN","result","simulateOutput","keyOTP","navigateTouSuccessPage","currentCustomer$","map","DatosPersonales","nombreCliente","apellido1Cliente","apellido2Cliente","combineLatest","globalPosition$","getCustomerName","deposit","navigate","skipLocationChange","relativeTo","forChild","TransferModule"],"mappings":"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","file":"x","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Transfer, SimulateOutput, TransferOutput, OtpOutput } from '@api/models';\r\nimport { environment } from '@environment/environment';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class TransferService {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  simulate(transfer: Transfer) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.transfer.simulate}`;\r\n    return this.http.post<SimulateOutput>(url, transfer);\r\n  }\r\n\r\n  otp(transfer: Transfer) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.transfer.otp}`;\r\n    return this.http.post<{ referenceOTP: string }>(url, transfer);\r\n  }\r\n\r\n  confirm(transfer: Transfer) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.transfer.confirm}`;\r\n    return this.http.post<TransferOutput>(url, transfer);\r\n  }\r\n}\r\n","import { AbstractControl } from '@angular/forms';\r\nimport { parseLocaleNumber } from '@shared/directives/parse-currency.directive';\r\n\r\nexport function balanceValidator(balance: number) {\r\n  return (control: AbstractControl) => {\r\n    const amount = parseLocaleNumber(control?.value);\r\n    return amount > balance ? { balanceError: true } : null;\r\n  };\r\n}\r\n\r\nexport function amountValidator(control: AbstractControl) {\r\n  const amount = parseLocaleNumber(control.value);\r\n\r\n  return isNaN(amount) ? { invalidAmount: true } : amount <= 0 ? { minAmountError: true } : null;\r\n}\r\n","<form [formGroup]=\"form\" (submit)=\"onSubmit()\">\r\n  <div class=\"group-input\">\r\n    <label>{{ 'transfer_sender_account' | translate }}</label>\r\n    <p class=\"input\">{{ senderIban | formatIban }}</p>\r\n  </div>\r\n\r\n  <div class=\"group-input\">\r\n    <label>{{ 'transfer_receiver_account' | translate }}</label>\r\n    <p class=\"input\">{{ receiverIban | formatIban }}</p>\r\n  </div>\r\n\r\n  <div class=\"group-input\">\r\n    <label>{{ 'transfer_balance' | translate }}</label>\r\n    <p class=\"input\">{{ balance || 0 | currency }}</p>\r\n  </div>\r\n\r\n  <div class=\"group-input\">\r\n    <label>{{ 'transfer_amount' | translate }}</label>\r\n    <input\r\n      formControlName=\"amount\"\r\n      type=\"text\"\r\n      appParseCurrency\r\n      maxlength=\"10\"\r\n      [ngClass]=\"{ error: hasError(form.get('amount')) }\"\r\n    />\r\n\r\n    <p class=\"error-text\" *ngIf=\"hasAmountError\">\r\n      <span class=\"ico-alert\"></span>{{ 'transfer_balance_error' | translate }}\r\n    </p>\r\n\r\n    <p class=\"error-text\" *ngIf=\"hasMinAmountError\">\r\n      <span class=\"ico-alert\"></span>{{ 'transfer_min_amount_error' | translate }}\r\n    </p>\r\n  </div>\r\n\r\n  <div class=\"group-input\">\r\n    <label>{{ 'transfer_concept' | translate }}</label>\r\n    <input\r\n      formControlName=\"concept\"\r\n      type=\"text\"\r\n      maxlength=\"250\"\r\n      [ngClass]=\"{ error: hasError(form.get('concept')) }\"\r\n    />\r\n  </div>\r\n\r\n  <div class=\"group-button\">\r\n    <button type=\"submit\" class=\"btn--primary\">{{ 'transfer_continue' | translate }}</button>\r\n  </div>\r\n  <div class=\"main__button\">\r\n    <button type=\"submit\" class=\"btn--primary\">{{ 'transfer_continue' | translate }}</button>\r\n  </div>\r\n</form>\r\n","import { Component, OnInit, Output, EventEmitter, Input } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators, AbstractControl } from '@angular/forms';\r\nimport { balanceValidator, amountValidator } from '@transfer/utils/transfer.validators';\r\n\r\n@Component({\r\n  selector: 'app-transfer-form',\r\n  templateUrl: './transfer-form.component.html',\r\n  styles: [],\r\n})\r\nexport class TransferFormComponent implements OnInit {\r\n  @Input() senderIban: string;\r\n  @Input() receiverIban: string;\r\n  @Input() balance: number;\r\n  @Output() submitForm = new EventEmitter<{ amount: string; concept: string }>();\r\n  form: FormGroup;\r\n  submitted = false;\r\n\r\n  get hasAmountError() {\r\n    const amountControl = this.form.get('amount');\r\n    return this.hasError(amountControl) && amountControl.hasError('balanceError');\r\n  }\r\n\r\n  get hasMinAmountError() {\r\n    const amountControl = this.form.get('amount');\r\n    return this.hasError(amountControl) && amountControl.hasError('minAmountError');\r\n  }\r\n\r\n  constructor(private formBuilder: FormBuilder) {}\r\n\r\n  ngOnInit() {\r\n    this.createForm();\r\n  }\r\n\r\n  onSubmit() {\r\n    this.submitted = true;\r\n    this.form.markAllAsTouched();\r\n\r\n    if (this.form.valid) {\r\n      const amount: string = this.form.value.amount;\r\n      const concept: string = this.form.value.concept;\r\n\r\n      this.submitForm.emit({ amount, concept });\r\n    }\r\n  }\r\n\r\n  hasError(control: AbstractControl) {\r\n    return control.touched && control.invalid;\r\n  }\r\n\r\n  private createForm() {\r\n    this.form = this.formBuilder.group({\r\n      amount: ['', [Validators.required, balanceValidator(this.balance), amountValidator]],\r\n      concept: ['', Validators.required],\r\n    });\r\n  }\r\n}\r\n","<ng-container *ngIf=\"state$ | async as state\">\r\n  <div class=\"max-size transfer\" *ngIf=\"state?.globalPosition && state?.account\">\r\n    <div class=\"main\">\r\n      <div class=\"main-col\">\r\n        <div class=\"main__header\">\r\n          <div class=\"main__header__desktop\">\r\n            <div class=\"main__header__title\">\r\n              <div class=\"main__header__title__col\">\r\n                <h1>{{ 'transfer_title' | translate }}</h1>\r\n                <p>{{ state.account.IBAN | formatIban }}</p>\r\n              </div>\r\n              <div class=\"main__header__title__col\">\r\n                <p>{{ 'transfer_balance' | translate }}</p>\r\n                <h1>{{ state.account.Balance | currency }}</h1>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"main__body\">\r\n          <ng-container *ngIf=\"!simulateOutput; else confirmTransfer\">\r\n            <app-transfer-form\r\n              [senderIban]=\"state.account.IBAN\"\r\n              [receiverIban]=\"state.globalPosition.OriginIBAN\"\r\n              [balance]=\"state.account.Balance\"\r\n              (submitForm)=\"simulateTranfer($event)\"\r\n            ></app-transfer-form>\r\n          </ng-container>\r\n        </div>\r\n      </div>\r\n      <div class=\"aside-col\" [appBannerBackground]=\"banners.transfer\">\r\n        <app-aside-banner [globalPosition]=\"state.globalPosition\"></app-aside-banner>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <ng-template #confirmTransfer>\r\n    <div class=\"confirm-transfer\">\r\n      <div class=\"group-input\">\r\n        <label>{{ 'transfer_sender_account' | translate }}</label>\r\n        <p>{{ state.account.IBAN | formatIban }}</p>\r\n      </div>\r\n      <div class=\"group-input\">\r\n        <label>{{ 'transfer_receiver_account' | translate }}</label>\r\n        <p>{{ state.globalPosition.OriginIBAN | formatIban }}</p>\r\n      </div>\r\n      <div class=\"group-input\">\r\n        <label>{{ 'transfer_amount' | translate }}</label>\r\n        <p>{{ currentTransfer?.amount | currency }}</p>\r\n      </div>\r\n      <div class=\"group-input\">\r\n        <label>{{ 'transfer_concept' | translate }}</label>\r\n        <p>{{ currentTransfer?.concept }}</p>\r\n      </div>\r\n\r\n      <div class=\"group-input\">\r\n        <label>{{ 'transfer_fee' | translate }}</label>\r\n        <p>{{ simulateOutput?.fee | currency }}</p>\r\n      </div>\r\n      <div class=\"group-button\">\r\n        <button class=\"btn--primary\" (click)=\"generateOtp()\">\r\n          {{ 'transfer_confirm' | translate }}\r\n        </button>\r\n      </div>\r\n      <div class=\"main__button\">\r\n        <button class=\"btn--primary\" (click)=\"generateOtp()\">\r\n          {{ 'transfer_confirm' | translate }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </ng-template>\r\n\r\n  <ng-template #otpModal>\r\n    <app-otp-form\r\n      (send)=\"makeTransfer($event)\"\r\n      (repeat)=\"generateOtp()\"\r\n      (hide)=\"closeModal()\"\r\n      [invalidCode]=\"invalidOtp\"\r\n    ></app-otp-form>\r\n  </ng-template>\r\n</ng-container>\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-success-transfer',\r\n  templateUrl: './success-transfer.component.html',\r\n  styles: []\r\n})\r\nexport class SuccessTransferComponent implements OnInit {\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit(): void {\r\n  }\r\n\r\n}\r\n","import { AccountService } from '@core/services/account/account.service';\r\nimport { Component, OnInit, OnDestroy, ViewChild, TemplateRef, Inject } from '@angular/core';\r\nimport { TransferService } from '@core/services/transfer/transfer.service';\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { SimulateOutput, Transfer } from '@api/models';\r\nimport { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { BsModalRef, BsModalService } from 'ngx-bootstrap/modal';\r\nimport { parseLocaleNumber } from '@shared/directives/parse-currency.directive';\r\nimport { HeaderService } from '@core/services/header/header.service';\r\nimport { GlobalPositionService } from '@core/services/global-position/global-position.service';\r\nimport { map, switchMap } from 'rxjs/operators';\r\nimport { findAccount, isInvalidOtp, findDeposit } from '@core/utils';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { BANNERS, Banners } from '@core/constants/banners.constants';\r\n\r\n@Component({\r\n  selector: 'app-transfer',\r\n  templateUrl: './transfer.component.html',\r\n  styles: [],\r\n})\r\nexport class TransferComponent implements OnInit, OnDestroy {\r\n  state$ = this.createState();\r\n\r\n  @ViewChild('otpModal') otpModal: TemplateRef<any>;\r\n  simulateOutput: SimulateOutput;\r\n  invalidOtp = false;\r\n  currentTransfer: Transfer;\r\n\r\n  private referenceOTP: string;\r\n  private modalRef: BsModalRef;\r\n  private subs = new Subscription();\r\n\r\n  constructor(\r\n    private headerService: HeaderService,\r\n    private transferService: TransferService,\r\n    private accountService: AccountService,\r\n    private errorHandler: ErrorHandlerService,\r\n    private modalService: BsModalService,\r\n    private globalPositionService: GlobalPositionService,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    @Inject(BANNERS) public readonly banners: Banners\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.globalPositionService.fetchGlobalPosition();\r\n    this.headerService.updateTitle('transfer_title');\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subs.unsubscribe();\r\n    this.closeModal();\r\n  }\r\n\r\n  openModal(ref: any) {\r\n    if (!this.modalService.getModalsCount()) {\r\n      this.modalRef = this.modalService.show(ref);\r\n    }\r\n  }\r\n\r\n  closeModal() {\r\n    this.modalRef?.hide();\r\n  }\r\n\r\n  generateOtp() {\r\n    this.invalidOtp = false;\r\n    this.referenceOTP = null;\r\n\r\n    this.subs.add(\r\n      this.transferService.otp(this.currentTransfer).subscribe(\r\n        ({ referenceOTP }) => {\r\n          this.referenceOTP = referenceOTP;\r\n          this.openModal(this.otpModal);\r\n        },\r\n        (error) => {\r\n          this.errorHandler.showError(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  simulateTranfer({ amount, concept }) {\r\n    this.subs.add(\r\n      this.state$\r\n        .pipe(\r\n          switchMap((state) => {\r\n            this.currentTransfer = {\r\n              amount: parseLocaleNumber(amount).toString(),\r\n              concept,\r\n              sender: { iban: state?.account?.IBAN, name: state?.customerName },\r\n              receiver: { iban: state?.globalPosition?.OriginIBAN, name: state?.customerName },\r\n            };\r\n\r\n            return this.transferService.simulate(this.currentTransfer);\r\n          })\r\n        )\r\n        .subscribe(\r\n          (result) => {\r\n            this.simulateOutput = result;\r\n          },\r\n          (error) => {\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  makeTransfer(keyOTP: string) {\r\n    this.subs.add(\r\n      this.transferService\r\n        .confirm({ ...this.currentTransfer, otp: { keyOTP, referenceOTP: this.referenceOTP } })\r\n        .subscribe(\r\n          () => {\r\n            this.navigateTouSuccessPage();\r\n            this.closeModal();\r\n          },\r\n          (error) => {\r\n            if (isInvalidOtp(error)) {\r\n              this.invalidOtp = true;\r\n              return;\r\n            }\r\n            this.closeModal();\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  clearCurrentTranfer() {\r\n    this.currentTransfer = null;\r\n    this.simulateOutput = null;\r\n  }\r\n\r\n  private getCustomerName() {\r\n    return this.accountService.currentCustomer$.pipe(\r\n      map((result) =>\r\n        result?.DatosPersonales\r\n          ? `${result.DatosPersonales?.nombreCliente} ` +\r\n            `${result.DatosPersonales?.apellido1Cliente} ` +\r\n            `${result.DatosPersonales?.apellido2Cliente}`\r\n          : ''\r\n      )\r\n    );\r\n  }\r\n\r\n  private createState() {\r\n    return combineLatest([\r\n      this.globalPositionService.globalPosition$,\r\n      this.globalPositionService.globalPosition$.pipe(findAccount()),\r\n      this.globalPositionService.globalPosition$.pipe(findDeposit()),\r\n      this.getCustomerName(),\r\n    ]).pipe(\r\n      map(([globalPosition, account, deposit, customerName]) => ({\r\n        globalPosition,\r\n        account,\r\n        deposit,\r\n        customerName,\r\n      }))\r\n    );\r\n  }\r\n\r\n  private navigateTouSuccessPage() {\r\n    this.router.navigate(['./transfer-success'], {\r\n      skipLocationChange: true,\r\n      relativeTo: this.route,\r\n    });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { TransferComponent } from './transfer.component';\r\nimport { SuccessTransferComponent } from './pages/success-transfer/success-transfer.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: TransferComponent,\r\n  },\r\n  {\r\n    path: 'transfer-success',\r\n    component: SuccessTransferComponent,\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class TransferRoutingModule {}\r\n","<div class=\"max-size deposit\">\r\n  <div class=\"main\">\r\n    <div class=\"main-col no-aside\">\r\n      <div class=\"main__header\">\r\n        <div class=\"main__header__desktop\">\r\n          <div class=\"main__header__title\">\r\n            <div class=\"main__header__title__col\">\r\n              <h1>{{ 'transfer_title' | translate }}</h1>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"main__body\">\r\n        <div class=\"main__body__confirm\">\r\n          <span class=\"ico-check-filled\"></span>\r\n          <h2>{{ 'transfer_congrats' | translate }}</h2>\r\n          <h2>{{ 'transfer_success_process' | translate }}</h2>\r\n          <p>{{ 'transfer_success_balance' | translate }}</p>\r\n        </div>\r\n        <button type=\"button\" [routerLink]=\"['../../transactions']\" class=\"btn--primary\">\r\n          {{ 'transfer_success_button' | translate }}\r\n        </button>\r\n        <div class=\"main__button\">\r\n          <button type=\"button\" [routerLink]=\"['../../transactions']\" class=\"btn--primary\">\r\n            {{ 'transfer_success_button' | translate }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { TransferRoutingModule } from './transfer-routing.module';\r\nimport { TransferComponent } from './transfer.component';\r\nimport { SharedModule } from '@shared/shared.module';\r\nimport { TransferFormComponent } from './components/transfer-form/transfer-form.component';\r\nimport { SuccessTransferComponent } from './pages/success-transfer/success-transfer.component';\r\n\r\n@NgModule({\r\n  declarations: [TransferComponent, TransferFormComponent, SuccessTransferComponent],\r\n  imports: [SharedModule, TransferRoutingModule],\r\n})\r\nexport class TransferModule {}\r\n"]}