{"version":3,"sources":["webpack:///src/app/core/services/deposit/deposit.service.ts","webpack:///src/app/deposit/components/imposition-item/imposition-item.component.html","webpack:///src/app/deposit/components/imposition-item/imposition-item.component.ts","webpack:///src/app/deposit/deposit.component.html","webpack:///src/app/deposit/deposit.component.ts","webpack:///src/app/deposit/services/imposition.service.ts","webpack:///src/app/deposit/utils/imposition.validators.ts","webpack:///src/app/core/constants/external-documents.constants.ts","webpack:///src/app/deposit/components/new-imposition-form/new-imposition-form.component.html","webpack:///src/app/deposit/components/new-imposition-form/new-imposition-form.component.ts","webpack:///src/app/deposit/pages/new-imposition/new-imposition.component.html","webpack:///src/app/deposit/pages/new-imposition/new-imposition.component.ts","webpack:///node_modules/rxjs/_esm2015/internal/operators/retryWhen.js","webpack:///src/app/core/services/hire-deposit/hire-deposit.service.ts","webpack:///src/app/deposit/components/hire-deposit-status-bar/hire-deposit-status-bar.component.ts","webpack:///src/app/deposit/components/hire-deposit-status-bar/hire-deposit-status-bar.component.html","webpack:///src/app/deposit/components/hire-deposit-form/hire-deposit-form.component.html","webpack:///src/app/deposit/components/hire-deposit-form/hire-deposit-form.component.ts","webpack:///src/app/deposit/pages/hire-deposit/hire-deposit.component.html","webpack:///src/app/deposit/pages/hire-deposit/hire-deposit.component.ts","webpack:///src/app/deposit/pages/success-refund/success-refund.component.html","webpack:///src/app/deposit/pages/first-imposition/first-imposition.component.html","webpack:///src/app/deposit/deposit-routing.module.ts","webpack:///src/app/deposit/pages/success-refund/success-refund.component.ts","webpack:///src/app/deposit/pages/success-new-imposition/success-new-imposition.component.ts","webpack:///src/app/deposit/pages/success-new-imposition/success-new-imposition.component.html","webpack:///src/app/deposit/pages/first-imposition/first-imposition.component.ts","webpack:///src/app/deposit/pages/hire-deposit-success/hire-deposit-success.component.ts","webpack:///src/app/deposit/pages/hire-deposit-success/hire-deposit-success.component.html","webpack:///src/app/deposit/deposit.module.ts"],"names":["DepositService","http","errorHandlerService","agreement","url","environment","apiBasePath","endpoints","deposit","getImpositions","params","acuerdo","toString","estadoImposicion","codigoEntidad","subacuerdo","this","get","pipe","map","result","data","EE_O_ConsultaImposicionesBE","Respuesta","ListaImposicionesCliente","catchError","error","errorCode","IMP_NOT_FOUND","of","redirectErrorPage","imposition","post","createImposition","refund","createImpositionOTP","refundOTP","subagreement","getPdfImposition","response","strMessage","getRequiredDoc","showReceipt","ImpositionItemComponent","askRefundImposition","waitToRefundImposition","showDetails","moment","isSame","fechaValor","emit","expirationDate","fechaVencimiento","isEmployee","clientType","Employee","isSameOrAfter","descripcionEstadoImposicion","Activo","toggleDetails","DepositComponent","depositService","headerService","globalPositionService","modalService","errorHandler","router","activatedRoute","caseService","accountService","banners","state$","createStateStream","invalidRefundOtpCode","subs","Subscription","updateTitle","fetchGlobalPosition","unsubscribe","closeModal","ref","getModalsCount","modalRef","show","hide","impositions","activeImpositionsCount","filter","length","openModal","confirmCancelDepositModal","invalidCancelationModal","accept","cancelDeposit","selectedImposition","confirmRefundModal","fileName","Acuerdo","add","subscribe","blob","a","document","createElement","href","URL","createObjectURL","download","click","showError","depositAgreement","generateRefundOtp","refundOtpId","generateRefundImpositionOTP","impositionAgreement","nominalAmount","String","parseFloat","importeNominal","otpId","refundOtpModal","secretKey","refundImposition","otp","navigate","queryParams","skipLocationChange","relativeTo","item","date","expirationDates","it","recentExpirationDate","body","type","TOTAL_CANCELLATION_OF_THE_TERM_DEPOSIT","recordTypeDeveloperName","CANCELLATIONS","description","subject","newIBAN","IBAN","createCase","caseList","successCancelDepositModal","globalPosition$","globalPosition","combineLatest","tap","createImpositionsStream","currentCustomer$","account","currentCustomer","switchMap","ImpositionService","dictionaryService","createState","impositionConditions$","getImpositionConditions","onSuccess","onError","referenceOTP","generateOtp","generateCreateImpositionOTP","state","zip","amountValidator","formGroup","impositionConditionInput","amountInput","impositionCondition","value","amount","maximum","maxImposition","minimum","minImposition","documents","applications","employeeDocuments","impositionConditions","particularConditions","notEmployeeDocuments","EXTERNAL_DOCUMENTS","providedIn","factory","DatosPersonales","makeImposition","NewImpositionFormComponent","fb","externalDocuments","submitted","showConfirm","conditionsRead","form","hasError","createForm","markAllAsTouched","valid","duration","frecuency","settFrequency","control","touched","invalid","window","open","balance","group","required","Balance","balanceError","conditions","requiredTrue","validators","NewImpositionComponent","route","impositionService","invalidImpositionOtpCode","destroy","initImposition","otpModal","navigateToSuccessPage","retryWhen","notifier","source","lift","RetryWhenOperator","subscriber","OuterSubscriber","destination","super","err","isStopped","errors","retries","retriesSubscription","Subject","e","subscribeToResult","_unsubscribeAndRecycle","next","outerValue","innerValue","outerIndex","innerIndex","innerSub","_unsubscribe","HireDepositService","productid","newHiring","getPdfContract","sign","startSignProcessSubmit","code","ERROR_SUBMIT","message","uniqueId","startSignProcessBulkSign","ERROR_BULKSIGN","ERROR_BULKSIGN_REQUESTNEWSUBMIT","querySignProcess","HireDepositStatusBarComponent","step","completed","active","partial","HireDepositFormComponent","formBuilder","hireDeposit","readPdf","onSubmit","readParticularConditions","HireDepositComponent","hireDepositService","loadingService","isWorking","checkPendingHiring","hiringProcess","availablePodructId","idQueryParam","snapshot","id","getProductId","productId","pendingHirings","res","RCI_Product__r","ProductCode","toPromise","getProducts","pluck","switchMapTo","signDeposit","finalize","handleSignResponse","location","console","productList","mergeMap","delay","src","KO_RETRY","throwError","routes","path","component","SuccessRefundComponent","imposition$","createImpositionStream","isNaN","SuccessNewImpositionComponent","FirstImpositionComponent","isPendingSignResponse","canMakeFirstImposition","mapInProgressClient","HireDepositSuccessComponent","DepositRoutingModule","forChild","DepositModule"],"mappings":"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","file":"x","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { environment } from '@environment/environment';\r\nimport {\r\n  Imposition,\r\n  ImpositionOutput,\r\n  Refund,\r\n  RefundOutput,\r\n  OtpOutput,\r\n  ListaImposicionesCliente,\r\n  SalesforceResponse,\r\n  ApiError,\r\n} from '@api/models';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { ErrorHandlerService } from '../errors/error-handler.service';\r\nimport { of } from 'rxjs';\r\nimport { ApiErrors } from '@api/constants';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class DepositService {\r\n  constructor(private http: HttpClient, private errorHandlerService: ErrorHandlerService) {}\r\n\r\n  getImpositions(agreement: string) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.deposit.getImpositions}`;\r\n    const params = {\r\n      acuerdo: (+agreement).toString(),\r\n      estadoImposicion: 'TODAS',\r\n      codigoEntidad: '1508',\r\n      subacuerdo: '0',\r\n    };\r\n\r\n    return this.http\r\n      .get<SalesforceResponse<any>>(url, { params })\r\n      .pipe(\r\n        map(\r\n          (result) =>\r\n            result?.data[0]?.EE_O_ConsultaImposicionesBE?.Respuesta\r\n              ?.ListaImposicionesCliente as ListaImposicionesCliente[]\r\n        ),\r\n        catchError((error: ApiError) => {\r\n          if (error.errorCode === ApiErrors.IMP_NOT_FOUND) {\r\n            return of([] as ListaImposicionesCliente[]);\r\n          }\r\n\r\n          return this.errorHandlerService.redirectErrorPage(error);\r\n        })\r\n      );\r\n  }\r\n\r\n  createImposition(imposition: Imposition) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.deposit.createImposition}`;\r\n    return this.http.post<ImpositionOutput>(url, imposition);\r\n  }\r\n\r\n  refundImposition(refund: Refund) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.deposit.refund}`;\r\n    return this.http.post<RefundOutput>(url, refund);\r\n  }\r\n\r\n  generateCreateImpositionOTP(imposition: Imposition) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.deposit.createImpositionOTP}`;\r\n    return this.http.post<OtpOutput>(url, imposition);\r\n  }\r\n\r\n  generateRefundImpositionOTP(refund: Refund) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.deposit.refundOTP}`;\r\n    return this.http.post<OtpOutput>(url, refund);\r\n  }\r\n\r\n  getPdfImposition(agreement: string, subagreement: string) {\r\n    const params = { acuerdo: agreement, subacuerdo: subagreement };\r\n    const url = `${environment.apiBasePath}${environment.endpoints.deposit.getPdfImposition}`;\r\n    return this.http\r\n      .get<SalesforceResponse<{ strMessage: string }>>(url, { params })\r\n      .pipe(map((response) => response.data?.[0]?.strMessage));\r\n  }\r\n\r\n  getRequiredDoc() {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.deposit.getRequiredDoc}`;\r\n    return this.http.get<any>(url);\r\n  }\r\n}\r\n","<div\r\n  class=\"table__body__row\"\r\n  [ngClass]=\"isActive ? 'active' : 'inactive'\"\r\n  (click)=\"toggleDetails()\"\r\n>\r\n  <div class=\"table__body__title\">\r\n    <div class=\"table__body__title__group\">\r\n      <p class=\"table__body__title__group__col\">\r\n        {{ imposition?.fechaValor | date: 'dd/MM/yyyy' }}\r\n      </p>\r\n    </div>\r\n    <div class=\"table__body__title__group\">\r\n      <p class=\"table__body__title__group__col\">\r\n        {{\r\n          'deposit_imposition_detail_status_' + imposition?.descripcionEstadoImposicion\r\n            | lowercase\r\n            | translate\r\n        }}\r\n      </p>\r\n      <p class=\"table__body__title__group__col\">\r\n        {{ 'deposit_imposition_detail_term_web' | translate: { term: imposition?.duracion || 0 } }}\r\n      </p>\r\n    </div>\r\n    <div class=\"table__body__title__group\">\r\n      <p class=\"table__body__title__group__col\">\r\n        {{ imposition?.importeNominal | currency }}\r\n      </p>\r\n    </div>\r\n  </div>\r\n  <div class=\"table__body__detail\" *ngIf=\"showDetails\">\r\n    <!-- Acuerdo -->\r\n    <div class=\"table__body__detail__row\" *ngIf=\"imposition?.subacuerdo\">\r\n      <p>{{ 'deposit_imposition_detail_number' | translate }}</p>\r\n      <p>{{ imposition?.subacuerdo }}</p>\r\n    </div>\r\n\r\n    <!-- Fecha vencimiento -->\r\n    <div class=\"table__body__detail__row\" *ngIf=\"imposition?.fechaVencimiento\">\r\n      <p>{{ 'deposit_imposition_detail_expiration' | translate }}</p>\r\n      <p>{{ imposition?.fechaVencimiento | date: 'dd/MM/yyyy' }}</p>\r\n    </div>\r\n\r\n    <!-- Interes -->\r\n    <div class=\"table__body__detail__row\" *ngIf=\"imposition?.tin\">\r\n      <p>{{ 'deposit_imposition_detail_interest' | translate }}</p>\r\n      <p>{{ imposition?.tin | number: '1.2-4' }} %</p>\r\n    </div>\r\n\r\n    <!-- Fecha liquidaciÃ³n -->\r\n    <div class=\"table__body__detail__row\" *ngIf=\"imposition?.fechaProximaLiquidacion\">\r\n      <p>{{ 'deposit_imposition_detail_liquidation' | translate }}</p>\r\n      <p>{{ imposition?.fechaProximaLiquidacion | date: 'dd/MM/yyyy' }}</p>\r\n    </div>\r\n\r\n    <div class=\"table__body__detail__row\">\r\n      <button (click)=\"refundImposition()\" *ngIf=\"isActive && canRefundImposition\">\r\n        {{ 'deposit_cancel_imposition_button' | translate }}\r\n      </button>\r\n\r\n      <button (click)=\"showReceipt.emit(imposition)\" *ngIf=\"isActive\">\r\n        {{ 'deposit_show_imposition_receipt_button' | translate }}\r\n      </button>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\r\nimport { ListaImposicionesCliente } from '@api/models';\r\nimport { ImpositionStatus } from '@core/constants';\r\nimport * as moment from 'moment';\r\nimport { ClientType } from '@core/constants/client-type.constants';\r\n\r\n@Component({\r\n  selector: 'app-imposition-item',\r\n  templateUrl: './imposition-item.component.html',\r\n  styles: [''],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class ImpositionItemComponent {\r\n  @Input() imposition: ListaImposicionesCliente;\r\n  @Input() clientType: ClientType;\r\n  @Output() askRefundImposition = new EventEmitter<ListaImposicionesCliente>();\r\n  @Output() waitToRefundImposition = new EventEmitter<void>();\r\n  @Output() showReceipt = new EventEmitter<ListaImposicionesCliente>();\r\n  showDetails = false;\r\n\r\n  constructor() {}\r\n\r\n  toggleDetails() {\r\n    this.showDetails = !this.showDetails;\r\n  }\r\n\r\n  refundImposition() {\r\n    if (moment().isSame(moment(this.imposition.fechaValor), 'day')) {\r\n      this.waitToRefundImposition.emit();\r\n    } else {\r\n      this.askRefundImposition.emit(this.imposition);\r\n    }\r\n  }\r\n\r\n  get canRefundImposition() {\r\n    const expirationDate = moment(this.imposition.fechaVencimiento);\r\n    const isEmployee = this.clientType === ClientType.Employee;\r\n\r\n    return isEmployee || (!isEmployee && moment().isSameOrAfter(expirationDate));\r\n  }\r\n\r\n  get isActive() {\r\n    return this.imposition?.descripcionEstadoImposicion === ImpositionStatus.Activo;\r\n  }\r\n}\r\n","<ng-container *ngIf=\"state$ | async as state\">\r\n  <div class=\"max-size deposit\">\r\n    <div class=\"main\">\r\n      <div class=\"main-col\" *ngIf=\"state.globalPosition\">\r\n        <div class=\"main__header\">\r\n          <div class=\"main__header__desktop\">\r\n            <div class=\"main__header__title\">\r\n              <div class=\"main__header__title__col\">\r\n                <h1>{{ 'deposit_title' | translate }}</h1>\r\n                <p>{{ state.deposit?.IBAN | formatIban }}</p>\r\n              </div>\r\n              <div class=\"main__header__title__col\">\r\n                <p>{{ 'deposit_balance' | translate }}</p>\r\n                <h1>{{ state.deposit?.Balance | currency }}</h1>\r\n              </div>\r\n            </div>\r\n            <div class=\"main__header__buttons\">\r\n              <button type=\"button\" class=\"btn--primary-small\" routerLink=\"./new-imposition\">\r\n                {{ 'deposit_new_imposition_title' | translate }}\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn--terciary-small\"\r\n                *ngIf=\"\r\n                  canShowCancelDeposit(\r\n                    state?.impositions,\r\n                    state?.currentCustomer?.DatosPersonales?.clientType\r\n                  )\r\n                \"\r\n                (click)=\"askCancelDeposit(state?.impositions)\"\r\n              >\r\n                {{ 'deposit_cancel_deposit' | translate }}\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div class=\"main__header__mobile\">\r\n            <div class=\"main__header__mobile__col\">\r\n              <h1>{{ state.deposit?.Balance | currency }}</h1>\r\n              <a href=\"javascript:;\" routerLink=\"../../transactions\">{{\r\n                'deposit_go_to_asociated_account' | translate\r\n              }}</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"main__body\">\r\n          <div class=\"table\">\r\n            <div class=\"table__header\">\r\n              <p>{{ 'deposit_imposition_date' | translate }}</p>\r\n              <p>{{ 'deposit_imposition_description' | translate }}</p>\r\n              <p>{{ 'deposit_imposition_term' | translate }}</p>\r\n              <p>{{ 'deposit_imposition_amount' | translate }}</p>\r\n            </div>\r\n            <div class=\"table__body\" *ngIf=\"!emptyImpositions(state.impositions)\">\r\n              <div\r\n                class=\"table__body__section\"\r\n                *ngFor=\"\r\n                  let impositionGroup of state.impositions\r\n                    | groupBy: 'fechaValor'\r\n                    | keyvalue\r\n                    | sortBy: 'desc':'key';\r\n                  trackBy: trackByDates\r\n                \"\r\n              >\r\n                <p class=\"table__body__section__date\">\r\n                  {{ impositionGroup.key | date: 'dd/MM/yyyy' }}\r\n                </p>\r\n                <app-imposition-item\r\n                  *ngFor=\"let imposition of impositionGroup.value\"\r\n                  [imposition]=\"imposition\"\r\n                  [clientType]=\"state?.currentCustomer?.DatosPersonales?.clientType\"\r\n                  (askRefundImposition)=\"askRefundImposition($event)\"\r\n                  (waitToRefundImposition)=\"openModal(waitToRefundModal)\"\r\n                  (showReceipt)=\"onShowReceipt(state?.deposit, $event)\"\r\n                ></app-imposition-item>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"table__body\" *ngIf=\"emptyImpositions(state.impositions)\">\r\n              <div class=\"table__body__title\">\r\n                <p class=\"table__body__title__group__col\">\r\n                  {{ 'deposit_empty_impositions_list_message' | translate }}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"aside-col\" [appBannerBackground]=\"banners.deposit\">\r\n        <app-aside-banner [globalPosition]=\"state.globalPosition\"></app-aside-banner>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"main__button group-button\">\r\n    <button\r\n      type=\"button\"\r\n      class=\"btn--secondary\"\r\n      *ngIf=\"\r\n        canShowCancelDeposit(\r\n          state?.impositions,\r\n          state?.currentCustomer?.DatosPersonales?.clientType\r\n        )\r\n      \"\r\n      (click)=\"askCancelDeposit(state?.impositions)\"\r\n    >\r\n      {{ 'deposit_cancel_deposit' | translate }}\r\n    </button>\r\n    <button type=\"button\" class=\"btn--primary\" routerLink=\"./new-imposition\">\r\n      {{ 'deposit_new_imposition_title' | translate }}\r\n    </button>\r\n  </div>\r\n\r\n  <!-- Modal: No puede hacer reintegro, mensaje de que espere -->\r\n  <ng-template #waitToRefundModal>\r\n    <app-info-modal\r\n      head=\"deposit_cancel_imposition_title\"\r\n      description=\"deposit_cancel_imposition_wait_text\"\r\n      type=\"warning\"\r\n      (hide)=\"closeModal()\"\r\n    ></app-info-modal>\r\n  </ng-template>\r\n\r\n  <!-- Modal: no puede cancelar deposito -->\r\n  <ng-template #invalidCancelationModal>\r\n    <app-info-modal\r\n      head=\"deposit_cancel_title\"\r\n      description=\"deposit_cancel_subtitle\"\r\n      type=\"warning\"\r\n      (hide)=\"closeModal()\"\r\n    ></app-info-modal>\r\n  </ng-template>\r\n\r\n  <!-- Modal: cancelar deposito OK -->\r\n  <ng-template #successCancelDeposit>\r\n    <app-info-modal\r\n      head=\"deposit_cancel_success_title\"\r\n      description=\"deposit_cancel_success_description\"\r\n      type=\"success\"\r\n      (hide)=\"closeModal()\"\r\n    ></app-info-modal>\r\n  </ng-template>\r\n\r\n  <!-- Modal: confirmar cancelar deposito -->\r\n  <ng-template #confirmCancelDepositModal>\r\n    <app-confirm-modal\r\n      description=\"deposit_cancel2_subtitle_web\"\r\n      (confirm)=\"onCancelDeposit($event, state?.deposit)\"\r\n    >\r\n    </app-confirm-modal>\r\n  </ng-template>\r\n\r\n  <!-- Modal: confirmar anular ingreso -->\r\n  <ng-template #confirmRefundModal>\r\n    <app-confirm-modal\r\n      description=\"deposit_cancel_imposition_text_web\"\r\n      (confirm)=\"confirmRefundImposition($event, state.deposit.Acuerdo)\"\r\n    >\r\n    </app-confirm-modal>\r\n  </ng-template>\r\n\r\n  <!-- Modal: anular ingreso otp -->\r\n  <ng-template #refundOtpModal>\r\n    <app-otp-form\r\n      [invalidCode]=\"invalidRefundOtpCode\"\r\n      (repeat)=\"generateRefundOtp(state.deposit.Acuerdo)\"\r\n      (send)=\"refundImposition($event, state.deposit.Acuerdo)\"\r\n      (hide)=\"closeModal()\"\r\n    ></app-otp-form>\r\n  </ng-template>\r\n</ng-container>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  TemplateRef,\r\n  ViewChild,\r\n  Inject,\r\n} from '@angular/core';\r\nimport { DepositService } from '@core/services/deposit/deposit.service';\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { HeaderService } from '@core/services/header/header.service';\r\nimport { GlobalPositionService } from '@core/services/global-position/global-position.service';\r\nimport { switchMap, filter, map, tap } from 'rxjs/operators';\r\nimport { findDeposit, findAccount, isInvalidOtp } from '@core/utils';\r\nimport { ListaImposicionesCliente, FinancialAccount } from '@api/models';\r\nimport { BsModalService, BsModalRef } from 'ngx-bootstrap/modal';\r\nimport { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { ImpositionStatus } from '@core/constants';\r\nimport { CaseService } from '@core/services/case/case.service';\r\nimport { CasePayload } from '@api/models/case-payload.model';\r\nimport { CASE_CANCELLATIONS } from '@core/config/sub-cases';\r\nimport { CASES } from '@core/config/cases';\r\nimport { b64toBlob } from '@core/utils/file.utils';\r\nimport { Banners, BANNERS } from '@core/constants/banners.constants';\r\nimport { AccountService } from '@core/services/account/account.service';\r\nimport * as moment from 'moment';\r\nimport { ClientType } from '@core/constants/client-type.constants';\r\n\r\n@Component({\r\n  selector: 'app-deposit',\r\n  templateUrl: './deposit.component.html',\r\n  styles: [],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class DepositComponent implements OnInit, OnDestroy {\r\n  @ViewChild('refundOtpModal') refundOtpModal: TemplateRef<any>;\r\n  @ViewChild('confirmRefundModal') confirmRefundModal: TemplateRef<any>;\r\n  @ViewChild('confirmCancelDepositModal') confirmCancelDepositModal: TemplateRef<any>;\r\n  @ViewChild('invalidCancelationModal') invalidCancelationModal: TemplateRef<any>;\r\n  @ViewChild('successCancelDeposit') successCancelDepositModal: TemplateRef<any>;\r\n  readonly state$ = this.createStateStream();\r\n\r\n  invalidRefundOtpCode = false;\r\n\r\n  private selectedImposition: ListaImposicionesCliente;\r\n  private refundOtpId: string;\r\n  private modalRef: BsModalRef;\r\n  private subs = new Subscription();\r\n\r\n  constructor(\r\n    private depositService: DepositService,\r\n    private headerService: HeaderService,\r\n    private globalPositionService: GlobalPositionService,\r\n    private modalService: BsModalService,\r\n    private errorHandler: ErrorHandlerService,\r\n    private router: Router,\r\n    private activatedRoute: ActivatedRoute,\r\n    private caseService: CaseService,\r\n    private accountService: AccountService,\r\n    @Inject(BANNERS) public readonly banners: Banners\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.headerService.updateTitle('menu_deposits_web');\r\n    this.globalPositionService.fetchGlobalPosition();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subs.unsubscribe();\r\n    this.closeModal();\r\n  }\r\n\r\n  openModal(ref: any) {\r\n    if (!this.modalService.getModalsCount()) {\r\n      this.modalRef = this.modalService.show(ref);\r\n    }\r\n  }\r\n\r\n  closeModal() {\r\n    this.modalRef?.hide();\r\n  }\r\n\r\n  askCancelDeposit(impositions: ListaImposicionesCliente[]) {\r\n    const activeImpositionsCount = impositions?.filter(\r\n      (imposition) => imposition.descripcionEstadoImposicion === ImpositionStatus.Activo\r\n    ).length;\r\n\r\n    if (activeImpositionsCount === 0) {\r\n      this.openModal(this.confirmCancelDepositModal);\r\n    } else {\r\n      this.openModal(this.invalidCancelationModal);\r\n    }\r\n  }\r\n\r\n  onCancelDeposit(accept: boolean, deposit: FinancialAccount) {\r\n    this.closeModal();\r\n    if (accept) {\r\n      this.cancelDeposit(deposit);\r\n    }\r\n  }\r\n\r\n  askRefundImposition(imposition: ListaImposicionesCliente) {\r\n    this.selectedImposition = imposition;\r\n    this.openModal(this.confirmRefundModal);\r\n  }\r\n\r\n  onShowReceipt(deposit: FinancialAccount, imposition: ListaImposicionesCliente) {\r\n    const fileName = `imposition-receipt-${deposit.Acuerdo}-${imposition.subacuerdo}.pdf`;\r\n\r\n    this.subs.add(\r\n      this.depositService\r\n        .getPdfImposition(deposit?.Acuerdo, imposition?.subacuerdo)\r\n        .pipe(b64toBlob())\r\n        .subscribe(\r\n          (blob) => {\r\n            const a = document.createElement('a');\r\n            a.href = URL.createObjectURL(blob);\r\n            a.download = fileName;\r\n            a.click();\r\n          },\r\n          (error) => {\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  confirmRefundImposition(result: boolean, depositAgreement: string) {\r\n    this.closeModal();\r\n    if (result) {\r\n      this.generateRefundOtp(depositAgreement);\r\n    }\r\n  }\r\n\r\n  generateRefundOtp(depositAgreement: string) {\r\n    this.invalidRefundOtpCode = false;\r\n    this.refundOtpId = null;\r\n\r\n    this.subs.add(\r\n      this.depositService\r\n        .generateRefundImpositionOTP({\r\n          depositAgreement,\r\n          impositionAgreement: this.selectedImposition?.subacuerdo,\r\n          nominalAmount: String(parseFloat(this.selectedImposition?.importeNominal)),\r\n        })\r\n        .subscribe(\r\n          ({ otpId }) => {\r\n            this.openModal(this.refundOtpModal);\r\n            this.refundOtpId = otpId;\r\n          },\r\n          (error) => {\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  refundImposition(secretKey: string, depositAgreement: string) {\r\n    this.subs.add(\r\n      this.depositService\r\n        .refundImposition({\r\n          depositAgreement,\r\n          impositionAgreement: this.selectedImposition?.subacuerdo,\r\n          nominalAmount: this.selectedImposition?.importeNominal,\r\n          otp: {\r\n            otpId: this.refundOtpId,\r\n            secretKey,\r\n          },\r\n        })\r\n        .subscribe(\r\n          () => {\r\n            this.closeModal();\r\n            this.router.navigate(['./refund-success'], {\r\n              queryParams: { importeNominal: this.selectedImposition?.importeNominal },\r\n              skipLocationChange: true,\r\n              relativeTo: this.activatedRoute,\r\n            });\r\n          },\r\n          (error) => {\r\n            if (isInvalidOtp(error)) {\r\n              this.invalidRefundOtpCode = true;\r\n              return;\r\n            }\r\n\r\n            this.closeModal();\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  onConfirmRefundSuccessModal() {\r\n    this.globalPositionService.fetchGlobalPosition();\r\n    this.closeModal();\r\n  }\r\n\r\n  trackByDates(item: { [key: string]: ListaImposicionesCliente }) {\r\n    return item.date;\r\n  }\r\n\r\n  trackByImposition(imposition: ListaImposicionesCliente) {\r\n    return imposition.subacuerdo;\r\n  }\r\n\r\n  emptyImpositions(impositions: []) {\r\n    return impositions && impositions.length === 0;\r\n  }\r\n\r\n  canShowCancelDeposit(impositions: ListaImposicionesCliente[], clientType: ClientType) {\r\n    const expirationDates = impositions?.map((it) => moment(it.fechaVencimiento));\r\n    const recentExpirationDate = moment.max(expirationDates);\r\n    const isEmployee = clientType === ClientType.Employee;\r\n\r\n    return isEmployee || (!isEmployee && moment().isSameOrAfter(recentExpirationDate));\r\n  }\r\n\r\n  private cancelDeposit(deposit: FinancialAccount) {\r\n    const body = new CasePayload();\r\n    body.type = CASE_CANCELLATIONS.TOTAL_CANCELLATION_OF_THE_TERM_DEPOSIT;\r\n    body.recordTypeDeveloperName = CASES.CANCELLATIONS;\r\n    body.description = 'CancelaciÃ³n de depÃ³sito';\r\n    body.subject = 'CancelaciÃ³n de depÃ³sito';\r\n    body.newIBAN = deposit?.IBAN;\r\n\r\n    this.subs.add(\r\n      this.caseService.createCase({ caseList: [body] }).subscribe(\r\n        () => {\r\n          this.closeModal();\r\n          this.openModal(this.successCancelDepositModal);\r\n        },\r\n        (error) => {\r\n          this.errorHandler.showError(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  private createStateStream() {\r\n    const globalPosition$ = this.globalPositionService.globalPosition$.pipe(\r\n      filter((globalPosition) => !!globalPosition)\r\n    );\r\n\r\n    return combineLatest([\r\n      globalPosition$,\r\n      globalPosition$.pipe(findDeposit()).pipe(\r\n        tap((deposit) => {\r\n          if (!deposit) {\r\n            this.router.navigate(['./hire'], { relativeTo: this.activatedRoute });\r\n          }\r\n        })\r\n      ),\r\n      globalPosition$.pipe(findAccount()),\r\n      this.createImpositionsStream(),\r\n      this.accountService.currentCustomer$,\r\n    ]).pipe(\r\n      map(([globalPosition, deposit, account, impositions, currentCustomer]) => ({\r\n        globalPosition,\r\n        deposit,\r\n        account,\r\n        impositions,\r\n        currentCustomer,\r\n      }))\r\n    );\r\n  }\r\n\r\n  private createImpositionsStream() {\r\n    return this.globalPositionService.globalPosition$.pipe(\r\n      findDeposit(),\r\n      filter((deposit) => !!deposit?.Acuerdo),\r\n      switchMap((deposit) => this.depositService.getImpositions(deposit?.Acuerdo))\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Imposition, ApiError, ImpositionOutput } from '@api/models';\r\nimport { Subscription, Observable, zip } from 'rxjs';\r\nimport { DepositService } from '@core/services/deposit/deposit.service';\r\nimport { switchMap, map } from 'rxjs/operators';\r\nimport { GlobalPositionService } from '@core/services/global-position/global-position.service';\r\nimport { findDeposit, findAccount } from '@core/utils';\r\nimport { DictionaryService } from '@core/services/dictionary/dictionary.service';\r\n\r\n@Injectable()\r\nexport class ImpositionService {\r\n  readonly state$ = this.createState();\r\n  readonly impositionConditions$ = this.dictionaryService.getImpositionConditions();\r\n\r\n  private imposition: Imposition;\r\n  private referenceOTP: string;\r\n  private subs = new Subscription();\r\n\r\n  constructor(\r\n    private depositService: DepositService,\r\n    private globalPositionService: GlobalPositionService,\r\n    private dictionaryService: DictionaryService\r\n  ) {}\r\n\r\n  initImposition(imposition: Imposition) {\r\n    this.imposition = imposition;\r\n  }\r\n\r\n  fetchGlobalPosition() {\r\n    this.globalPositionService.fetchGlobalPosition();\r\n  }\r\n\r\n  generateOtp(onSuccess?: () => void, onError?: (error: ApiError) => void) {\r\n    this.referenceOTP = null;\r\n\r\n    const generateOtp = (imposition: Imposition) =>\r\n      this.depositService.generateCreateImpositionOTP({ ...imposition });\r\n\r\n    this.subs.add(\r\n      this.state$\r\n        .pipe(\r\n          switchMap((state) =>\r\n            generateOtp({ ...this.imposition, depositAgreement: state?.deposit?.Acuerdo })\r\n          )\r\n        )\r\n        .subscribe(\r\n          ({ otpId }) => {\r\n            this.referenceOTP = otpId;\r\n            onSuccess?.();\r\n          },\r\n          (error) => onError?.(error)\r\n        )\r\n    );\r\n  }\r\n\r\n  createImposition(secretKey: string, onSuccess?: () => void, onError?: (error: ApiError) => void) {\r\n    this.subs.add(\r\n      this.state$\r\n        .pipe(\r\n          switchMap((state) =>\r\n            this.depositService.createImposition({\r\n              ...this.imposition,\r\n              depositAgreement: state?.deposit.Acuerdo,\r\n              otp: { secretKey, otpId: this.referenceOTP },\r\n            })\r\n          )\r\n        )\r\n        .subscribe(\r\n          () => {\r\n            onSuccess?.();\r\n          },\r\n          (error) => {\r\n            onError?.(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  destroy() {\r\n    this.subs.unsubscribe();\r\n  }\r\n\r\n  private createState() {\r\n    return zip(\r\n      this.globalPositionService.globalPosition$,\r\n      this.globalPositionService.globalPosition$.pipe(findDeposit()),\r\n      this.globalPositionService.globalPosition$.pipe(findAccount())\r\n    ).pipe(\r\n      map(([globalPosition, deposit, account]) => ({\r\n        globalPosition,\r\n        deposit,\r\n        account,\r\n      }))\r\n    );\r\n  }\r\n}\r\n","import { FormGroup, AbstractControl } from '@angular/forms';\r\nimport { ImpositionCondition } from '@api/models';\r\nimport { parseLocaleNumber } from '@shared/directives/parse-currency.directive';\r\n\r\nexport function amountValidator(formGroup: FormGroup) {\r\n  const impositionConditionInput = formGroup.get('impositionCondition');\r\n  const amountInput = formGroup.get('amount');\r\n\r\n  const impositionCondition: ImpositionCondition = impositionConditionInput.value;\r\n  const amount = parseLocaleNumber(amountInput.value);\r\n\r\n  if (!impositionCondition) {\r\n    return null;\r\n  }\r\n\r\n  if (impositionCondition?.maximum < amount) {\r\n    return { maxImposition: true };\r\n  }\r\n\r\n  if (impositionCondition?.minimum > amount) {\r\n    return { minImposition: true };\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport function balanceValidator(balance: number) {\r\n  return (control: AbstractControl) => {\r\n    const amount = parseLocaleNumber(control?.value);\r\n    return amount > balance ? { balanceError: true } : null;\r\n  };\r\n}\r\n","import { InjectionToken, inject } from '@angular/core';\r\nimport { AccountService } from '@core/services/account/account.service';\r\nimport { ClientType } from './client-type.constants';\r\nimport { environment } from '@environment/environment';\r\n\r\nexport interface ExternalDocuments {\r\n  impositionConditions: string;\r\n  particularConditions: string;\r\n}\r\n\r\nconst documents = environment.applications.documents;\r\n\r\nconst employeeDocuments: ExternalDocuments = {\r\n  impositionConditions: `${documents}/documentacion-legal/condiciones-imposicion-RenaultBank.pdf`,\r\n  particularConditions: `${documents}/documentacion-legal/informacion-precontractual-deposito-RenaultBank.pdf`,\r\n};\r\n\r\nconst notEmployeeDocuments: ExternalDocuments = {\r\n  impositionConditions: `${documents}/documentacion-legal/condiciones-imposicion-publico-RenaultBank.pdf`,\r\n  particularConditions: `${documents}/documentacion-legal/informacion-precontractual-deposito-publico-RenaultBank.pdf`,\r\n};\r\n\r\nexport const EXTERNAL_DOCUMENTS = new InjectionToken<ExternalDocuments>('EXTERNAL_DOCUMENTS', {\r\n  providedIn: 'root',\r\n  factory: () => {\r\n    const accountService = inject(AccountService);\r\n    const clientType = accountService.currentCustomer?.DatosPersonales?.clientType;\r\n\r\n    if (clientType === ClientType.Employee) {\r\n      return employeeDocuments;\r\n    }\r\n\r\n    return notEmployeeDocuments;\r\n  },\r\n});\r\n","<form [formGroup]=\"form\" (submit)=\"onSubmit()\" *ngIf=\"!showConfirm; else confirm\">\r\n  <div class=\"group-input\">\r\n    <label>{{ 'deposit_sender_account' | translate }}</label>\r\n    <p class=\"input\">{{ account?.IBAN | formatIban }}</p>\r\n  </div>\r\n  <div class=\"group-input\">\r\n    <label>{{ 'deposit_receiver_account' | translate }}</label>\r\n    <p class=\"input\">{{ deposit?.IBAN | formatIban }}</p>\r\n  </div>\r\n  <div class=\"group-input\">\r\n    <label>{{ 'deposit_new_imposition_account_balance' | translate }}</label>\r\n    <p class=\"input\">{{ account?.Balance || 0 | number: '1.2-2' }}</p>\r\n  </div>\r\n  <div class=\"group-input\">\r\n    <label>{{ 'deposit_amount' | translate }}</label>\r\n    <input\r\n      formControlName=\"amount\"\r\n      type=\"text\"\r\n      appParseCurrency\r\n      [allowDecimal]=\"false\"\r\n      [ngClass]=\"{\r\n        error: hasError(form.get('amount')) || hasMaxAmountError || hasMinAmountError\r\n      }\"\r\n      maxlength=\"10\"\r\n    />\r\n\r\n    <p class=\"error-text\" *ngIf=\"hasBalanceError && !hasMinAmountError && !hasMaxAmountError\">\r\n      <span class=\"ico-alert\"></span>\r\n      {{ 'deposit_hire_amount_account_insufficient' | translate }}\r\n    </p>\r\n\r\n    <p class=\"error-text\" *ngIf=\"hasMinAmountError\">\r\n      <span class=\"ico-alert\"></span>\r\n      {{\r\n        'deposit_hire_minnimum_import_web'\r\n          | translate: { amount: impositionCondition?.minimum | currency }\r\n      }}\r\n    </p>\r\n\r\n    <p class=\"error-text\" *ngIf=\"hasMaxAmountError\">\r\n      <span class=\"ico-alert\"></span>\r\n      {{\r\n        'deposit_hire_maximum_import_web'\r\n          | translate: { amount: impositionCondition?.maximum | currency }\r\n      }}\r\n    </p>\r\n  </div>\r\n\r\n  <div class=\"group-input input-select\">\r\n    <label>{{ 'deposit_time' | translate }}</label>\r\n    <ng-select\r\n      [items]=\"impositionConditions\"\r\n      [placeholder]=\"'deposit_time_election' | translate\"\r\n      formControlName=\"impositionCondition\"\r\n      [ngClass]=\"{ error: hasError(form.get('impositionCondition')) }\"\r\n      [searchable]=\"false\"\r\n      [clearable]=\"false\"\r\n    >\r\n      <ng-template ng-label-tmp ng-option-tmp let-item=\"item\">\r\n        {{ 'deposit_time_options_web' | translate: { time: item.duration } }}\r\n      </ng-template>\r\n    </ng-select>\r\n  </div>\r\n\r\n  <div class=\"group-input input-checkbox\">\r\n    <input\r\n      type=\"checkbox\"\r\n      formControlName=\"conditions\"\r\n      id=\"conditions\"\r\n      [ngClass]=\"{ error: hasError(form.get('conditions')) }\"\r\n    />\r\n    <label for=\"conditions\"\r\n      >{{ 'deposit_new_imposition_condition_1_web' | translate }}&nbsp;\r\n      <a (click)=\"readConditions()\" href=\"javascript:;\">\r\n        {{ 'deposit_new_imposition_condition_2_web' | translate }}</a\r\n      >\r\n    </label>\r\n    <span class=\"check ico-check-2\"></span>\r\n    <p class=\"error-text\" *ngIf=\"!this.conditionsRead && this.submitted\">\r\n      <span class=\"ico-alert\"></span>{{ 'deposit_new_imposition_must_read_conditions' | translate }}\r\n    </p>\r\n  </div>\r\n  <div class=\"group-button\">\r\n    <button type=\"submit\" class=\"btn--primary\">\r\n      {{ 'generic_continue_button' | translate }}\r\n    </button>\r\n    <button routerLink=\"../..\" type=\"button\" class=\"btn--secondary\">\r\n      {{ 'deposit_cancel' | translate }}\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"main__button group-button\">\r\n    <button routerLink=\"../..\" type=\"button\" class=\"btn--secondary\">\r\n      {{ 'deposit_cancel' | translate }}\r\n    </button>\r\n    <button type=\"submit\" class=\"btn--primary\">\r\n      {{ 'deposit_continue' | translate }}\r\n    </button>\r\n  </div>\r\n</form>\r\n\r\n<ng-template #confirm>\r\n  <div class=\"deposit-confirm\">\r\n    <div class=\"group-input\">\r\n      <label>{{ 'deposit_sender_account' | translate }}</label>\r\n      <p>{{ account?.IBAN | formatIban }}</p>\r\n    </div>\r\n\r\n    <div class=\"group-input\">\r\n      <label>{{ 'deposit_receiver_account' | translate }}</label>\r\n      <p>{{ deposit?.IBAN | formatIban }}</p>\r\n    </div>\r\n\r\n    <div class=\"group-input\">\r\n      <label>{{ 'deposit_new_impositon_amount' | translate }}</label>\r\n      <p>{{ imposition?.nominalAmount | currency }}</p>\r\n    </div>\r\n\r\n    <div class=\"group-input\">\r\n      <label>{{ 'deposit_imposition_term' | translate }}</label>\r\n      <p>\r\n        {{\r\n          'deposit_new_imposition_term_value_web'\r\n            | translate\r\n              : {\r\n                  term: impositionCondition?.duration | number\r\n                }\r\n        }}\r\n      </p>\r\n    </div>\r\n\r\n    <div class=\"group-input\">\r\n      <label>{{ 'deposit_new_imposition_fee' | translate }}</label>\r\n      <p>0,00 %</p>\r\n    </div>\r\n    <div class=\"group-button\">\r\n      <button type=\"button\" (click)=\"makeImposition.emit(imposition)\" class=\"btn--primary\">\r\n        {{ 'generic_confirm_button' | translate }}\r\n      </button>\r\n    </div>\r\n    <div class=\"main__button\">\r\n      <button type=\"submit\" class=\"btn--primary\" (click)=\"makeImposition.emit(imposition)\">\r\n        {{ 'generic_confirm_button' | translate }}\r\n      </button>\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  Inject,\r\n} from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators, AbstractControl } from '@angular/forms';\r\nimport { amountValidator, balanceValidator } from '@deposit/utils/imposition.validators';\r\nimport { ImpositionCondition, Imposition, FinancialAccount } from '@api/models';\r\nimport { parseLocaleNumber } from '@shared/directives/parse-currency.directive';\r\nimport {\r\n  EXTERNAL_DOCUMENTS,\r\n  ExternalDocuments,\r\n} from '@core/constants/external-documents.constants';\r\n\r\n@Component({\r\n  selector: 'app-new-imposition-form',\r\n  templateUrl: './new-imposition-form.component.html',\r\n  styles: [],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class NewImpositionFormComponent implements OnInit {\r\n  @Input() impositionConditions: ImpositionCondition[];\r\n  @Input() account: FinancialAccount;\r\n  @Input() deposit: FinancialAccount;\r\n  @Output() makeImposition = new EventEmitter<Imposition>();\r\n\r\n  form: FormGroup;\r\n  submitted = false;\r\n  imposition: Imposition;\r\n  showConfirm = false;\r\n  conditionsRead = false;\r\n\r\n  //  utils to template\r\n  get hasBalanceError() {\r\n    const amount = this.form.get('amount');\r\n    return this.hasError(amount) && amount.hasError('balanceError');\r\n  }\r\n\r\n  get hasMinAmountError() {\r\n    return this.form.hasError('minImposition');\r\n  }\r\n\r\n  get hasMaxAmountError() {\r\n    return this.form.hasError('maxImposition');\r\n  }\r\n\r\n  get impositionCondition(): ImpositionCondition {\r\n    return this.form?.get('impositionCondition').value;\r\n  }\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    @Inject(EXTERNAL_DOCUMENTS) private externalDocuments: ExternalDocuments\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.createForm();\r\n  }\r\n\r\n  onSubmit() {\r\n    this.submitted = true;\r\n    this.form.markAllAsTouched();\r\n\r\n    if (this.form.valid && this.conditionsRead) {\r\n      const impositionCondition: ImpositionCondition = this.form.value.impositionCondition;\r\n      this.imposition = {\r\n        nominalAmount: parseLocaleNumber(this.form.value.amount).toString(),\r\n        duration: impositionCondition?.duration,\r\n        frecuency: impositionCondition?.settFrequency,\r\n      };\r\n\r\n      this.showConfirm = true;\r\n    }\r\n  }\r\n\r\n  hasError(control: AbstractControl) {\r\n    return control.touched && control.invalid;\r\n  }\r\n\r\n  readConditions() {\r\n    this.conditionsRead = true;\r\n    window?.open(this.externalDocuments.impositionConditions);\r\n  }\r\n\r\n  private createForm() {\r\n    this.form = this.fb.group(\r\n      {\r\n        amount: ['', [Validators.required, balanceValidator(this.account?.Balance)]],\r\n        impositionCondition: [null, Validators.required],\r\n        conditions: [false, [Validators.requiredTrue]],\r\n      },\r\n      { validators: amountValidator }\r\n    );\r\n  }\r\n}\r\n","<ng-container *ngIf=\"state$ | async as state\">\r\n  <div class=\"max-size deposit-form\" *ngIf=\"state.globalPosition\">\r\n    <div class=\"main\">\r\n      <div class=\"main-col no-aside\">\r\n        <div class=\"main__header\">\r\n          <div class=\"main__header__desktop\">\r\n            <div class=\"main__header__title\">\r\n              <div class=\"main__header__title__col\">\r\n                <h1>{{ 'deposit_new_imposition_title' | translate }}</h1>\r\n                <p>{{ state.deposit?.IBAN | formatIban }}</p>\r\n              </div>\r\n              <div class=\"main__header__title__col\">\r\n                <p>{{ 'deposit_new_imposition_account_balance' | translate }}</p>\r\n                <h1>{{ state.account?.Balance | currency }}</h1>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"main__body\">\r\n          <app-new-imposition-form\r\n            [account]=\"state?.account\"\r\n            [deposit]=\"state?.deposit\"\r\n            [impositionConditions]=\"impositionConditions$ | async\"\r\n            (makeImposition)=\"onMakeImposition($event)\"\r\n          ></app-new-imposition-form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <ng-template #otpModal>\r\n    <app-otp-form\r\n      [invalidCode]=\"invalidImpositionOtpCode\"\r\n      (send)=\"createImposition($event)\"\r\n      (repeat)=\"generateOtp()\"\r\n      (hide)=\"closeModal()\"\r\n    ></app-otp-form>\r\n  </ng-template>\r\n</ng-container>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  ViewChild,\r\n  TemplateRef,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Self,\r\n} from '@angular/core';\r\nimport { Imposition } from '@api/models';\r\nimport { BsModalService, BsModalRef } from 'ngx-bootstrap/modal';\r\nimport { isInvalidOtp } from '@core/utils';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { ImpositionService } from '@deposit/services/imposition.service';\r\n\r\n@Component({\r\n  selector: 'app-new-imposition',\r\n  templateUrl: './new-imposition.component.html',\r\n  styles: [],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  providers: [ImpositionService],\r\n})\r\nexport class NewImpositionComponent implements OnInit, OnDestroy {\r\n  readonly state$ = this.impositionService.state$;\r\n  readonly impositionConditions$ = this.impositionService.impositionConditions$;\r\n  @ViewChild('otpModal') otpModal: TemplateRef<any>;\r\n\r\n  invalidImpositionOtpCode = false;\r\n  private modalRef: BsModalRef;\r\n\r\n  constructor(\r\n    private modalService: BsModalService,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private errorHandler: ErrorHandlerService,\r\n    @Self() private impositionService: ImpositionService\r\n  ) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  ngOnDestroy() {\r\n    this.closeModal();\r\n    this.impositionService.destroy();\r\n  }\r\n\r\n  openModal(ref: any) {\r\n    if (!this.modalService.getModalsCount()) {\r\n      this.modalRef = this.modalService.show(ref);\r\n    }\r\n  }\r\n\r\n  closeModal() {\r\n    this.modalRef?.hide();\r\n  }\r\n\r\n  onMakeImposition(imposition: Imposition) {\r\n    this.impositionService.initImposition(imposition);\r\n    this.generateOtp();\r\n  }\r\n\r\n  generateOtp() {\r\n    this.invalidImpositionOtpCode = false;\r\n\r\n    this.impositionService.generateOtp(\r\n      () => {\r\n        this.openModal(this.otpModal);\r\n      },\r\n      (error) => {\r\n        this.errorHandler.showError(error);\r\n      }\r\n    );\r\n  }\r\n\r\n  createImposition(secretKey: string) {\r\n    this.impositionService.createImposition(\r\n      secretKey,\r\n      () => {\r\n        this.closeModal();\r\n        this.navigateToSuccessPage();\r\n      },\r\n      (error) => {\r\n        if (isInvalidOtp(error)) {\r\n          this.invalidImpositionOtpCode = true;\r\n          return;\r\n        }\r\n        this.closeModal();\r\n        this.errorHandler.showError(error);\r\n      }\r\n    );\r\n  }\r\n\r\n  private navigateToSuccessPage() {\r\n    this.router.navigate(['../new-imposition-success'], {\r\n      skipLocationChange: true,\r\n      relativeTo: this.route,\r\n    });\r\n  }\r\n}\r\n","import { Subject } from '../Subject';\nimport { OuterSubscriber } from '../OuterSubscriber';\nimport { subscribeToResult } from '../util/subscribeToResult';\nexport function retryWhen(notifier) {\n    return (source) => source.lift(new RetryWhenOperator(notifier, source));\n}\nclass RetryWhenOperator {\n    constructor(notifier, source) {\n        this.notifier = notifier;\n        this.source = source;\n    }\n    call(subscriber, source) {\n        return source.subscribe(new RetryWhenSubscriber(subscriber, this.notifier, this.source));\n    }\n}\nclass RetryWhenSubscriber extends OuterSubscriber {\n    constructor(destination, notifier, source) {\n        super(destination);\n        this.notifier = notifier;\n        this.source = source;\n    }\n    error(err) {\n        if (!this.isStopped) {\n            let errors = this.errors;\n            let retries = this.retries;\n            let retriesSubscription = this.retriesSubscription;\n            if (!retries) {\n                errors = new Subject();\n                try {\n                    const { notifier } = this;\n                    retries = notifier(errors);\n                }\n                catch (e) {\n                    return super.error(e);\n                }\n                retriesSubscription = subscribeToResult(this, retries);\n            }\n            else {\n                this.errors = null;\n                this.retriesSubscription = null;\n            }\n            this._unsubscribeAndRecycle();\n            this.errors = errors;\n            this.retries = retries;\n            this.retriesSubscription = retriesSubscription;\n            errors.next(err);\n        }\n    }\n    _unsubscribe() {\n        const { errors, retriesSubscription } = this;\n        if (errors) {\n            errors.unsubscribe();\n            this.errors = null;\n        }\n        if (retriesSubscription) {\n            retriesSubscription.unsubscribe();\n            this.retriesSubscription = null;\n        }\n        this.retries = null;\n    }\n    notifyNext(outerValue, innerValue, outerIndex, innerIndex, innerSub) {\n        const { _unsubscribe } = this;\n        this._unsubscribe = null;\n        this._unsubscribeAndRecycle();\n        this._unsubscribe = _unsubscribe;\n        this.source.subscribe(this);\n    }\n}\n//# sourceMappingURL=retryWhen.js.map","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { environment } from '@environment/environment';\r\nimport { ApiErrors } from '@api/constants';\r\nimport {\r\n  ResponseSubmitEvicertia,\r\n  ResponseBulkSignEvicertia,\r\n  ResponseQuerySignEvicertia,\r\n} from '@api/models';\r\nimport { map } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class HireDepositService {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  newHiring(productid: string) {\r\n    const params = { productid };\r\n    return this.http.post(\r\n      `${environment.apiBasePath}${environment.endpoints.deposit.newHiring}`,\r\n      null,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  getPdfContract() {\r\n    return this.http.get(\r\n      `${environment.apiBasePath}${environment.endpoints.deposit.getPdfContract}`\r\n    );\r\n  }\r\n\r\n  // proceso de firma\r\n  startSignProcessSubmit() {\r\n    return this.http\r\n      .post<ResponseSubmitEvicertia>(\r\n        `${environment.apiBasePath}${environment.endpoints.sign.startSignProcessSubmit}`,\r\n        null\r\n      )\r\n      .pipe(\r\n        map((data) => {\r\n          if (data?.code === ApiErrors.ERROR_SUBMIT) {\r\n            throw {\r\n              errorCode: data?.code,\r\n              message: data?.code,\r\n            };\r\n          }\r\n\r\n          return data?.data[0]?.uniqueId;\r\n        })\r\n      );\r\n  }\r\n\r\n  startSignProcessBulkSign() {\r\n    return this.http\r\n      .post<ResponseBulkSignEvicertia>(\r\n        `${environment.apiBasePath}${environment.endpoints.sign.startSignProcessBulkSign}`,\r\n        null\r\n      )\r\n      .pipe(\r\n        map((data) => {\r\n          if (\r\n            data?.code === ApiErrors.ERROR_BULKSIGN ||\r\n            data?.code === ApiErrors.ERROR_BULKSIGN_REQUESTNEWSUBMIT\r\n          ) {\r\n            throw { errorCode: data?.code, message: data?.code };\r\n          }\r\n\r\n          return data?.data[0];\r\n        })\r\n      );\r\n  }\r\n\r\n  querySignProcess() {\r\n    return this.http.post<ResponseQuerySignEvicertia>(\r\n      `${environment.apiBasePath}${environment.endpoints.sign.querySignProcess}`,\r\n      null\r\n    );\r\n  }\r\n}\r\n","import { Component, OnInit, ChangeDetectionStrategy, Input } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-hire-deposit-status-bar',\r\n  templateUrl: './hire-deposit-status-bar.component.html',\r\n  styles: [],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class HireDepositStatusBarComponent {\r\n  @Input() step: 0 | 1 | 2 | 3 = 0;\r\n\r\n  get firstStepClass() {\r\n    return { completed: this.step > 0, active: this.step === 0 };\r\n  }\r\n\r\n  get secondStepClass() {\r\n    return { completed: this.step > 1, active: this.step === 1 };\r\n  }\r\n\r\n  get thirdStepClass() {\r\n    return { completed: this.step > 2, active: this.step === 2 };\r\n  }\r\n\r\n  get lineClass() {\r\n    return { partial: this.step === 1, completed: this.step > 1 };\r\n  }\r\n}\r\n","<div class=\"status-bar\">\r\n  <div class=\"step\" [ngClass]=\"firstStepClass\">\r\n    <div class=\"step__circle\">\r\n      <span class=\"step__number\">1</span>\r\n      <span class=\"step__icon ico-check-2\"></span>\r\n    </div>\r\n    <p>{{ 'deposit_hire_step_one' | translate }}</p>\r\n  </div>\r\n\r\n  <div class=\"step\" [ngClass]=\"secondStepClass\">\r\n    <div class=\"step__circle\">\r\n      <span class=\"step__number\">2</span>\r\n      <span class=\"step__icon ico-check-2\"></span>\r\n    </div>\r\n    <p>{{ 'deposit_hire_step_two' | translate }}</p>\r\n  </div>\r\n\r\n  <div class=\"step\" [ngClass]=\"thirdStepClass\">\r\n    <div class=\"step__circle\">\r\n      <span class=\"step__number\">3</span>\r\n      <span class=\"step__icon ico-check-2\"></span>\r\n    </div>\r\n    <p>{{ 'deposit_hire_step_three' | translate }}</p>\r\n  </div>\r\n\r\n  <div class=\"line partial\" [ngClass]=\"lineClass\"></div>\r\n</div>\r\n","<form [formGroup]=\"form\" (submit)=\"onSubmit()\">\r\n  <div class=\"group-input\">\r\n    <label>{{ 'transfer_sender_account' | translate }}</label>\r\n    <p class=\"input\">{{ account?.IBAN | formatIban }}</p>\r\n  </div>\r\n\r\n  <div class=\"description\">\r\n    <label>{{ 'deposit_hire_conditions_description' | translate }}</label>\r\n  </div>\r\n\r\n  <div class=\"group-input input-checkbox\">\r\n    <input\r\n      type=\"checkbox\"\r\n      formControlName=\"particularConditions\"\r\n      id=\"particularConditions\"\r\n      [ngClass]=\"{ error: hasError(form.get('particularConditions')) }\"\r\n    />\r\n    <label for=\"particularConditions\"\r\n      >{{ 'deposit_hire_conditions_web' | translate }}\r\n      <a (click)=\"readParticularConditions()\" href=\"javascript:;\">\r\n        {{ 'deposit_hire_particular_conditions_web' | translate }}</a\r\n      ></label\r\n    >\r\n    <span class=\"check ico-check-2\"></span>\r\n    <p class=\"error-text\" *ngIf=\"!readPdf.particularConditions && submitted\">\r\n      <span class=\"ico-alert\"></span\r\n      >{{ 'hire_deposit_must_read_particular_conditions' | translate }}\r\n    </p>\r\n  </div>\r\n\r\n  <div class=\"group-button\">\r\n    <button type=\"submit\" class=\"btn--primary\">\r\n      {{ 'deposit_continue' | translate }}\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"main__button\">\r\n    <button type=\"submit\" class=\"btn--primary\">\r\n      {{ 'deposit_continue' | translate }}\r\n    </button>\r\n  </div>\r\n</form>\r\n","import { Component, OnInit, Output, EventEmitter, Input, Inject } from '@angular/core';\r\nimport { FormGroup, Validators, FormBuilder, AbstractControl } from '@angular/forms';\r\nimport { FinancialAccount } from '@api/models';\r\nimport {\r\n  EXTERNAL_DOCUMENTS,\r\n  ExternalDocuments,\r\n} from '@core/constants/external-documents.constants';\r\n\r\n@Component({\r\n  selector: 'app-hire-deposit-form',\r\n  templateUrl: './hire-deposit-form.component.html',\r\n  styles: [],\r\n})\r\nexport class HireDepositFormComponent implements OnInit {\r\n  @Input() account: FinancialAccount;\r\n  @Output() hireDeposit = new EventEmitter<void>();\r\n  form: FormGroup;\r\n  submitted = false;\r\n\r\n  readonly readPdf = {\r\n    particularConditions: false,\r\n  };\r\n\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    @Inject(EXTERNAL_DOCUMENTS) private externalDocuments: ExternalDocuments\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.createForm();\r\n  }\r\n\r\n  onSubmit() {\r\n    this.submitted = true;\r\n    this.form.markAllAsTouched();\r\n\r\n    if (this.form.valid && this.readPdf.particularConditions) {\r\n      this.hireDeposit.emit();\r\n    }\r\n  }\r\n\r\n  readParticularConditions() {\r\n    this.readPdf.particularConditions = true;\r\n    window?.open(this.externalDocuments.particularConditions);\r\n  }\r\n\r\n  hasError(control: AbstractControl) {\r\n    return control.touched && control.invalid;\r\n  }\r\n\r\n  private createForm() {\r\n    this.form = this.formBuilder.group({\r\n      particularConditions: [false, [Validators.requiredTrue]],\r\n    });\r\n  }\r\n}\r\n","<ng-container *ngIf=\"state$ | async as state\">\r\n  <div class=\"max-size deposit-form\" *ngIf=\"state.globalPosition\">\r\n    <div class=\"main\">\r\n      <div class=\"main-col\">\r\n        <div class=\"main__header\">\r\n          <div class=\"main__header__desktop\">\r\n            <div class=\"main__header__title\">\r\n              <div class=\"main__header__title__col\">\r\n                <h1>{{ 'deposit_hire_title' | translate }}</h1>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"main__body\">\r\n          <p class=\"info-text\" *ngIf=\"isWorking\">\r\n            {{ 'deposit_hire_loading_contract_response' | translate }}\r\n          </p>\r\n\r\n          <app-hire-deposit-form\r\n            *ngIf=\"!isWorking\"\r\n            [account]=\"state.account\"\r\n            (hireDeposit)=\"onHireDeposit()\"\r\n          ></app-hire-deposit-form>\r\n        </div>\r\n      </div>\r\n      <div class=\"aside-col\">\r\n        <app-hire-deposit-status-bar></app-hire-deposit-status-bar>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</ng-container>\r\n","import { Component, OnInit, OnDestroy, Inject } from '@angular/core';\r\nimport { GlobalPositionService } from '@core/services/global-position/global-position.service';\r\nimport { zip, Subscription, Observable, of, throwError } from 'rxjs';\r\nimport { findAccount } from '@core/utils';\r\nimport {\r\n  map,\r\n  filter,\r\n  mergeMap,\r\n  delay,\r\n  switchMapTo,\r\n  pluck,\r\n  retryWhen,\r\n  finalize,\r\n} from 'rxjs/operators';\r\nimport { HireDepositService } from '@core/services/hire-deposit/hire-deposit.service';\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { DictionaryService } from '@core/services/dictionary/dictionary.service';\r\nimport { ResponseBulkSignEvicertiaData, ApiError } from '@api/models';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { ApiErrors } from '@api/constants';\r\nimport { LoadingService } from '@core/services/loading/loading.service';\r\n\r\n@Component({\r\n  selector: 'app-hire-deposit',\r\n  templateUrl: './hire-deposit.component.html',\r\n  styles: [],\r\n})\r\nexport class HireDepositComponent implements OnInit, OnDestroy {\r\n  readonly state$ = this.createState();\r\n  availablePodructId: string;\r\n  isWorking = false;\r\n\r\n  private subs = new Subscription();\r\n\r\n  constructor(\r\n    @Inject(DOCUMENT) private document: Document,\r\n    private globalPositionService: GlobalPositionService,\r\n    private hireDepositService: HireDepositService,\r\n    private errorHandler: ErrorHandlerService,\r\n    private dictionaryService: DictionaryService,\r\n    private activatedRoute: ActivatedRoute,\r\n    private loadingService: LoadingService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.checkPendingHiring();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subs.unsubscribe();\r\n  }\r\n\r\n  onHireDeposit() {\r\n    this.hiringProcess(this.availablePodructId);\r\n  }\r\n\r\n  private async checkPendingHiring() {\r\n    const idQueryParam = this.activatedRoute.snapshot.queryParams.id;\r\n\r\n    if (idQueryParam) {\r\n      this.availablePodructId = idQueryParam;\r\n    } else {\r\n      try {\r\n        this.availablePodructId = await this.getProductId();\r\n      } catch (error) {\r\n        this.errorHandler.redirectErrorPage(error);\r\n      }\r\n    }\r\n  }\r\n\r\n  private async getProductId() {\r\n    let productId = await this.globalPositionService\r\n      .pendingHirings()\r\n      .pipe(map((res) => res.data?.[0]?.RCI_Product__r?.ProductCode))\r\n      .toPromise();\r\n\r\n    if (!productId) {\r\n      productId = await this.getProducts().pipe(pluck('externalId')).toPromise();\r\n    }\r\n\r\n    return productId;\r\n  }\r\n\r\n  private createState() {\r\n    return zip(\r\n      this.globalPositionService.globalPosition$,\r\n      this.globalPositionService.globalPosition$.pipe(findAccount())\r\n    ).pipe(map(([globalPosition, account]) => ({ globalPosition, account })));\r\n  }\r\n\r\n  private hiringProcess(productId: string) {\r\n    this.loadingService.show();\r\n    this.isWorking = true;\r\n\r\n    this.subs.add(\r\n      this.hireDepositService\r\n        .newHiring(productId)\r\n        .pipe(\r\n          switchMapTo(this.hireDepositService.getPdfContract()),\r\n          switchMapTo(this.signDeposit())\r\n        )\r\n        .pipe(\r\n          finalize(() => {\r\n            this.loadingService.hide();\r\n            this.isWorking = false;\r\n          })\r\n        )\r\n        .subscribe(\r\n          (data) => {\r\n            this.handleSignResponse(data);\r\n          },\r\n          (error) => {\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  private handleSignResponse(data: ResponseBulkSignEvicertiaData) {\r\n    try {\r\n      const url = new URL(data?.url);\r\n      this.document.location.href = url.href;\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  private getProducts() {\r\n    return this.dictionaryService.getProducts().pipe(map((item) => item.productList?.[0]));\r\n  }\r\n\r\n  // Sign process\r\n  private signDeposit() {\r\n    return this.hireDepositService.querySignProcess().pipe(\r\n      map((data) => data?.data),\r\n      filter((data) => !data || data?.length === 0),\r\n      mergeMap(() => this.hireDepositService.startSignProcessSubmit()),\r\n      delay(5000),\r\n      mergeMap(() => this.hireDepositService.startSignProcessBulkSign().pipe(retryWithBackoff()))\r\n    );\r\n  }\r\n}\r\n\r\nexport function retryWithBackoff() {\r\n  let retries = 3;\r\n  const delayTime = 5000;\r\n\r\n  return (src: Observable<any>) =>\r\n    src.pipe(\r\n      retryWhen((errors: Observable<any>) =>\r\n        errors.pipe(\r\n          mergeMap((error: ApiError) => {\r\n            if (error?.errorCode === ApiErrors.KO_RETRY) {\r\n              if (retries-- > 0) {\r\n                return of(error).pipe(delay(delayTime));\r\n              } else {\r\n                return throwError({ errorCode: 'MAX_RETRIES_EXCEEDED' } as ApiError);\r\n              }\r\n            } else {\r\n              retries = 5;\r\n              return throwError(error);\r\n            }\r\n          })\r\n        )\r\n      )\r\n    );\r\n}\r\n","<div class=\"max-size deposit\" *ngIf=\"state$ | async as state\">\r\n  <div class=\"main\" *ngIf=\"state.globalPosition\">\r\n    <div class=\"main-col no-aside\">\r\n      <div class=\"main__header\">\r\n        <div class=\"main__header__desktop\">\r\n          <div class=\"main__header__title\">\r\n            <div class=\"main__header__title__col\">\r\n              <h1>{{ 'deposit_cancel_imposition_title' | translate }}</h1>\r\n              <p>{{ state.deposit?.IBAN | formatIban }}</p>\r\n            </div>\r\n            <div class=\"main__header__title__col\">\r\n              <p>{{ 'deposit_cancel_imposition_amount' | translate }}</p>\r\n              <h1>{{ (imposition$ | async).importeNominal | currency }}</h1>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"main__body\">\r\n        <div class=\"main__body__confirm\">\r\n          <span class=\"ico-check-filled\"></span>\r\n          <h2>{{ 'deposit_cancel_impositon_congrats' | translate }}</h2>\r\n          <h2>{{ 'deposit_cancel_impositon_success_operation' | translate }}</h2>\r\n          <p>{{ 'deposit_cancel_impositon_success_money' | translate }}</p>\r\n        </div>\r\n        <button type=\"button\" [routerLink]=\"['..']\" class=\"btn--primary\">\r\n          {{ 'deposit_cancel_impositon_success_button' | translate }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"main__button\">\r\n    <button type=\"button\" [routerLink]=\"['..']\" class=\"btn--primary\">\r\n      {{ 'deposit_cancel_impositon_success_button' | translate }}\r\n    </button>\r\n  </div>\r\n</div>\r\n","<ng-container *ngIf=\"state$ | async as state\">\r\n  <div class=\"max-size deposit-form\">\r\n    <div class=\"main\" *ngIf=\"isPendingSignResponse\">\r\n      <div class=\"main-col\">\r\n        <div class=\"main__header\">\r\n          <div class=\"main__header__desktop\">\r\n            <div class=\"main__header__title\">\r\n              <div class=\"main__header__title__col\">\r\n                <h1>{{ 'deposit_hire_title' | translate }}</h1>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"main__body\">\r\n          <p class=\"info-text\">{{ 'deposit_hire_loading_sign_response' | translate }}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div\r\n      class=\"main\"\r\n      *ngIf=\"!isPendingSignResponse && canMakeFirstImposition && state.globalPosition\"\r\n    >\r\n      <div class=\"main-col\">\r\n        <div class=\"main__header\">\r\n          <div class=\"main__header__desktop\">\r\n            <div class=\"main__header__title\">\r\n              <div class=\"main__header__title__col\">\r\n                <h1>{{ 'deposit_hire_title' | translate }}</h1>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"main__body\">\r\n          <app-new-imposition-form\r\n            [account]=\"state?.account\"\r\n            [deposit]=\"state?.deposit\"\r\n            [impositionConditions]=\"impositionConditions$ | async\"\r\n            (makeImposition)=\"onMakeImposition($event)\"\r\n          ></app-new-imposition-form>\r\n        </div>\r\n      </div>\r\n      <div class=\"aside-col\">\r\n        <app-hire-deposit-status-bar [step]=\"2\"></app-hire-deposit-status-bar>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <ng-template #otpModal>\r\n    <app-otp-form\r\n      [invalidCode]=\"invalidImpositionOtpCode\"\r\n      (send)=\"createImposition($event)\"\r\n      (repeat)=\"generateOtp()\"\r\n      (hide)=\"closeModal()\"\r\n    ></app-otp-form>\r\n  </ng-template>\r\n</ng-container>\r\n","import { DepositComponent } from './deposit.component';\r\nimport { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { NewImpositionComponent } from './pages/new-imposition/new-imposition.component';\r\nimport { HireDepositComponent } from './pages/hire-deposit/hire-deposit.component';\r\nimport { SuccessRefundComponent } from './pages/success-refund/success-refund.component';\r\nimport { SuccessNewImpositionComponent } from './pages/success-new-imposition/success-new-imposition.component';\r\nimport { FirstImpositionComponent } from './pages/first-imposition/first-imposition.component';\r\nimport { HireDepositSuccessComponent } from './pages/hire-deposit-success/hire-deposit-success.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: DepositComponent,\r\n  },\r\n  {\r\n    path: 'new-imposition',\r\n    component: NewImpositionComponent,\r\n  },\r\n  {\r\n    path: 'refund-success',\r\n    component: SuccessRefundComponent,\r\n  },\r\n  {\r\n    path: 'new-imposition-success',\r\n    component: SuccessNewImpositionComponent,\r\n  },\r\n  {\r\n    path: 'hire',\r\n    component: HireDepositComponent,\r\n  },\r\n  {\r\n    path: 'first-imposition',\r\n    component: FirstImpositionComponent,\r\n  },\r\n  {\r\n    path: 'hire-deposit-success',\r\n    component: HireDepositSuccessComponent,\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class DepositRoutingModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { GlobalPositionService } from '@core/services/global-position/global-position.service';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { tap, map } from 'rxjs/operators';\r\nimport { ListaImposicionesCliente } from '@api/models';\r\nimport { Observable, zip } from 'rxjs';\r\nimport { findDeposit } from '@core/utils';\r\n\r\n@Component({\r\n  selector: 'app-success-refund',\r\n  templateUrl: './success-refund.component.html',\r\n  styles: [],\r\n})\r\nexport class SuccessRefundComponent implements OnInit {\r\n  readonly state$ = this.createStateStream();\r\n  readonly imposition$ = this.createImpositionStream();\r\n\r\n  constructor(\r\n    private globalPositionService: GlobalPositionService,\r\n    private activatedRoute: ActivatedRoute,\r\n    private router: Router\r\n  ) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  private createStateStream() {\r\n    return zip(\r\n      this.globalPositionService.globalPosition$,\r\n      this.globalPositionService.globalPosition$.pipe(findDeposit())\r\n    ).pipe(map(([globalPosition, deposit]) => ({ globalPosition, deposit })));\r\n  }\r\n\r\n  private createImpositionStream() {\r\n    return this.activatedRoute.queryParams.pipe(\r\n      tap((imposition: Partial<ListaImposicionesCliente>) => {\r\n        if (isNaN(parseFloat(imposition.importeNominal))) {\r\n          this.router.navigate(['..'], { relativeTo: this.activatedRoute });\r\n        }\r\n      })\r\n    ) as Observable<Partial<ListaImposicionesCliente>>;\r\n  }\r\n}\r\n","import { Component, OnInit, ChangeDetectionStrategy } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-success-new-imposition',\r\n  templateUrl: './success-new-imposition.component.html',\r\n  styles: [],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class SuccessNewImpositionComponent implements OnInit {\r\n  constructor() {}\r\n\r\n  ngOnInit(): void {}\r\n}\r\n","<div class=\"max-size deposit\">\r\n  <div class=\"main\">\r\n    <div class=\"main-col no-aside\">\r\n      <div class=\"main__header\">\r\n        <div class=\"main__header__desktop\">\r\n          <div class=\"main__header__title\">\r\n            <div class=\"main__header__title__col\">\r\n              <h1>{{ 'deposit_new_imposition_title' | translate }}</h1>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"main__body\">\r\n        <div class=\"main__body__confirm\">\r\n          <span class=\"ico-check-filled\"></span>\r\n          <h2>{{ 'deposit_new_impositon_congrats' | translate }}</h2>\r\n          <h2>{{ 'deposit_new_impositon_success_process' | translate }}</h2>\r\n          <p>{{ 'deposit_new_impositon_success_balance' | translate }}</p>\r\n        </div>\r\n        <button type=\"button\" [routerLink]=\"['..']\" class=\"btn--primary\">\r\n          {{ 'deposit_new_impositon_success_button' | translate }}\r\n        </button>\r\n        <div class=\"main__button\">\r\n          <button type=\"button\" [routerLink]=\"['..']\" class=\"btn--primary\">\r\n            {{ 'deposit_new_impositon_success_button' | translate }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { Component, OnInit, Self, ViewChild, TemplateRef, OnDestroy } from '@angular/core';\r\nimport { ImpositionService } from '@deposit/services/imposition.service';\r\nimport { Imposition, ApiError } from '@api/models';\r\nimport { BsModalService, BsModalRef } from 'ngx-bootstrap/modal';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { isInvalidOtp } from '@core/utils';\r\nimport { retryWhen, mergeMap, delay, map, finalize } from 'rxjs/operators';\r\nimport { of, throwError, Subscription } from 'rxjs';\r\nimport { DepositService } from '@core/services/deposit/deposit.service';\r\n\r\n@Component({\r\n  selector: 'app-first-imposition',\r\n  templateUrl: './first-imposition.component.html',\r\n  styles: [],\r\n  providers: [ImpositionService],\r\n})\r\nexport class FirstImpositionComponent implements OnInit, OnDestroy {\r\n  readonly state$ = this.impositionService.state$;\r\n  readonly impositionConditions$ = this.impositionService.impositionConditions$;\r\n  @ViewChild('otpModal') otpModal: TemplateRef<any>;\r\n\r\n  isPendingSignResponse = true;\r\n  canMakeFirstImposition = false;\r\n\r\n  invalidImpositionOtpCode = false;\r\n  private modalRef: BsModalRef;\r\n  private subs = new Subscription();\r\n\r\n  constructor(\r\n    private modalService: BsModalService,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private errorHandler: ErrorHandlerService,\r\n    @Self() private impositionService: ImpositionService,\r\n    private depositService: DepositService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.getRequiredDoc();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.closeModal();\r\n    this.impositionService.destroy();\r\n    this.subs.unsubscribe();\r\n  }\r\n\r\n  openModal(ref: any) {\r\n    if (!this.modalService.getModalsCount()) {\r\n      this.modalRef = this.modalService.show(ref);\r\n    }\r\n  }\r\n\r\n  closeModal() {\r\n    this.modalRef?.hide();\r\n  }\r\n\r\n  getRequiredDoc() {\r\n    this.subs.add(\r\n      this.depositService\r\n        .getRequiredDoc()\r\n        .pipe(\r\n          map(this.mapInProgressClient),\r\n          retryWithBackoff(),\r\n          finalize(() => {\r\n            this.isPendingSignResponse = false;\r\n          })\r\n        )\r\n        .subscribe(\r\n          () => {\r\n            this.impositionService.fetchGlobalPosition();\r\n            this.canMakeFirstImposition = true;\r\n          },\r\n          (error) => {\r\n            this.errorHandler.showError(error, () => {\r\n              this.router.navigate(['..'], {\r\n                relativeTo: this.route,\r\n              });\r\n            });\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  onMakeImposition(imposition: Imposition) {\r\n    this.impositionService.initImposition(imposition);\r\n    this.generateOtp();\r\n  }\r\n\r\n  generateOtp() {\r\n    this.invalidImpositionOtpCode = false;\r\n\r\n    this.impositionService.generateOtp(\r\n      () => {\r\n        this.openModal(this.otpModal);\r\n      },\r\n      (error) => {\r\n        this.errorHandler.showError(error);\r\n      }\r\n    );\r\n  }\r\n\r\n  createImposition(secretKey: string) {\r\n    this.impositionService.createImposition(\r\n      secretKey,\r\n      () => {\r\n        this.closeModal();\r\n        this.navigateToSuccessPage();\r\n      },\r\n      (error) => {\r\n        if (isInvalidOtp(error)) {\r\n          this.invalidImpositionOtpCode = true;\r\n          return;\r\n        }\r\n        this.closeModal();\r\n        this.errorHandler.showError(error);\r\n      }\r\n    );\r\n  }\r\n\r\n  private mapInProgressClient(response: any) {\r\n    // In progress\r\n    if (response.code === 'OB_GET_REQUIRED_DOC_IN_PROGRESS') {\r\n      const error: ApiError = {\r\n        message: 'OB_GET_REQUIRED_DOC_IN_PROGRESS',\r\n        errorCode: 'OB_GET_REQUIRED_DOC_IN_PROGRESS',\r\n      };\r\n      throw error;\r\n    }\r\n\r\n    // RSI Failed\r\n    if (response.code === 'OB_GET_REQUIRED_DOC_NOT_APPROVED') {\r\n      const error: ApiError = {\r\n        message: 'OB_GET_REQUIRED_DOC_NOT_APPROVED',\r\n        errorCode: 'OB_GET_REQUIRED_DOC_NOT_APPROVED',\r\n      };\r\n      throw error;\r\n    }\r\n\r\n    return response;\r\n  }\r\n\r\n  private navigateToSuccessPage() {\r\n    this.router.navigate(['../hire-deposit-success'], {\r\n      skipLocationChange: true,\r\n      relativeTo: this.route,\r\n    });\r\n  }\r\n}\r\n\r\nexport function retryWithBackoff() {\r\n  let retries = 25;\r\n  const delayTime = 7500;\r\n\r\n  return (src) =>\r\n    src.pipe(\r\n      retryWhen((errors) =>\r\n        errors.pipe(\r\n          mergeMap((error: ApiError) => {\r\n            if (error?.errorCode === 'OB_GET_REQUIRED_DOC_IN_PROGRESS') {\r\n              if (retries-- > 0) {\r\n                return of(error).pipe(delay(delayTime));\r\n              } else {\r\n                return throwError({ errorCode: 'MAX_RETRIES_EXCEEDED' } as ApiError);\r\n              }\r\n            } else {\r\n              retries = 5;\r\n              return throwError(error);\r\n            }\r\n          })\r\n        )\r\n      )\r\n    );\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-hire-deposit-success',\r\n  templateUrl: './hire-deposit-success.component.html',\r\n  styles: []\r\n})\r\nexport class HireDepositSuccessComponent implements OnInit {\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit(): void {\r\n  }\r\n\r\n}\r\n","<div class=\"max-size deposit deposit-form\">\r\n  <div class=\"main\">\r\n    <div class=\"main-col\">\r\n      <div class=\"main__header\">\r\n        <div class=\"main__header__desktop\">\r\n          <div class=\"main__header__title\">\r\n            <div class=\"main__header__title__col\">\r\n              <h1>{{ 'deposit_hire_title' | translate }}</h1>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"main__body\">\r\n        <div class=\"main__body__confirm\">\r\n          <span class=\"ico-check-filled\"></span>\r\n          <h2>{{ 'deposit_hire_congrats' | translate }}</h2>\r\n          <h2>{{ 'deposit_hire_process_success' | translate }}</h2>\r\n          <p>{{ 'deposit_hire_deposit_ready_caption' | translate }}</p>\r\n        </div>\r\n        <button type=\"button\" [routerLink]=\"['..']\" class=\"btn--primary\">\r\n          {{ 'deposit_hire_button_understand' | translate }}\r\n        </button>\r\n        <div class=\"main__button\">\r\n          <button type=\"button\" [routerLink]=\"['..']\" class=\"btn--primary\">\r\n            {{ 'deposit_hire_button_understand' | translate }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"aside-col\">\r\n      <app-hire-deposit-status-bar [step]=\"3\"></app-hire-deposit-status-bar>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { DepositRoutingModule } from './deposit-routing.module';\r\nimport { NewImpositionComponent } from './pages/new-imposition/new-imposition.component';\r\nimport { SharedModule } from '@shared/shared.module';\r\nimport { DepositComponent } from './deposit.component';\r\nimport { HireDepositComponent } from './pages/hire-deposit/hire-deposit.component';\r\nimport { ImpositionItemComponent } from './components/imposition-item/imposition-item.component';\r\nimport { SuccessRefundComponent } from './pages/success-refund/success-refund.component';\r\nimport { NewImpositionFormComponent } from './components/new-imposition-form/new-imposition-form.component';\r\nimport { SuccessNewImpositionComponent } from './pages/success-new-imposition/success-new-imposition.component';\r\nimport { FirstImpositionComponent } from './pages/first-imposition/first-imposition.component';\r\nimport { HireDepositFormComponent } from './components/hire-deposit-form/hire-deposit-form.component';\r\nimport { HireDepositStatusBarComponent } from './components/hire-deposit-status-bar/hire-deposit-status-bar.component';\r\nimport { HireDepositSuccessComponent } from './pages/hire-deposit-success/hire-deposit-success.component';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    DepositComponent,\r\n    NewImpositionComponent,\r\n    HireDepositComponent,\r\n    ImpositionItemComponent,\r\n    SuccessRefundComponent,\r\n    NewImpositionFormComponent,\r\n    SuccessNewImpositionComponent,\r\n    FirstImpositionComponent,\r\n    HireDepositFormComponent,\r\n    HireDepositStatusBarComponent,\r\n    HireDepositSuccessComponent,\r\n  ],\r\n  imports: [SharedModule, DepositRoutingModule],\r\n})\r\nexport class DepositModule {}\r\n"]}