(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"M+7o":function(t,e,a){"use strict";a.r(e);var i=a("PCNd"),n=a("ofXK"),o=a("9yxR"),r=a("pLZG"),c=a("lJxs"),s=a("1uah"),b=a("a+Vh"),d=a("3Pt+"),l=a("wd/R"),u=a("fXoL"),m=a("hzby"),p=a("vHNk"),h=a("wO+i"),f=a("JIr8"),v=a("AytR"),_=a("LRne"),S=a("tk/3"),g=a("v98y");let R=(()=>{class t{constructor(t,e){this.httpClient=t,this.errorHandlerService=e}checkCorrespondence(t,e){return this.httpClient.get(`${v.a.apiBasePath}${v.a.endpoints.virtualMailbox.checkCorrespondence}?since=${t}&until=${e}`).pipe(Object(h.a)("data"),Object(f.a)(t=>t.errorCode?Object(_.a)([]):this.errorHandlerService.redirectErrorPage(t)))}getCorrespondence(t){return this.httpClient.get(`${v.a.apiBasePath}${v.a.endpoints.virtualMailbox.getCorrespondence}?visualized=${t.visualizado}&formcode=${t.codigoFormulario}&date=${t.fecha}&documentid=${t.idDocumento}&account=${t.cuenta}&externalid=${t.idExterno}`).pipe(Object(c.a)(t=>{var e,a;return null===(a=null===(e=t)||void 0===e?void 0:e.data)||void 0===a?void 0:a[0]}))}}return t.\u0275fac=function(e){return new(e||t)(u.Wb(S.b),u.Wb(g.a))},t.\u0275prov=u.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var C=a("44PX"),y=a("quSY"),w=a("OMSe"),x=a("sYmb");let D=(()=>{class t{constructor(t){this.mailboxService=t,this.subs=new y.a}ngOnInit(){}download(t){this.subs.add(this.mailboxService.getCorrespondence(t).pipe(Object(r.a)(t=>!!t),Object(w.a)()).subscribe(t=>{const e=document.createElement("a");e.href=URL.createObjectURL(t),e.download=this.item.nomDoc,e.click()}))}ngOnDestroy(){this.subs.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(u.Mb(R))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-mailbox-items"]],inputs:{type:"type",item:"item"},decls:9,vars:7,consts:[[1,"tabs-block--desktop__body__row"],[1,"tabs-block--desktop__body__row__title"],[1,"date"],[1,"name"],[1,"ico-download",3,"click"]],template:function(t,e){1&t&&(u.Sb(0,"div",0),u.Sb(1,"div",1),u.Sb(2,"p",2),u.Ec(3),u.dc(4,"date"),u.Rb(),u.Sb(5,"p",3),u.Ec(6),u.dc(7,"translate"),u.Rb(),u.Sb(8,"span",4),u.ac("click",(function(){return e.download(e.item)})),u.Rb(),u.Rb(),u.Rb()),2&t&&(u.Ab(3),u.Fc(u.fc(4,2,e.item.fecha,"dd/MM/yyyy")),u.Ab(3),u.Fc(u.ec(7,5,e.item.nomDoc)))},pipes:[n.f,x.d],styles:[""]}),t})();function F(t,e){1&t&&u.Nb(0,"app-mailbox-items",26),2&t&&u.jc("item",e.$implicit)}function j(t,e){if(1&t&&(u.Sb(0,"div"),u.Cc(1,F,1,1,"app-mailbox-items",25),u.Rb()),2&t){const t=u.cc(2);u.Ab(1),u.jc("ngForOf",t.notifications)}}const k=function(t,e){return{since:t,until:e}};function O(t,e){if(1&t&&(u.Sb(0,"div",27),u.Sb(1,"p"),u.Ec(2),u.dc(3,"translate"),u.Rb(),u.Rb()),2&t){const t=u.cc(2);u.Ab(2),u.Gc(" ",u.fc(3,1,"virtual_mb_mailing_not_found_range_date",u.oc(4,k,t.since,t.until))," ")}}const A=function(){return{dateInputFormat:"DD/MM/YYYY"}},$=function(t){return{error:t}};function M(t,e){if(1&t){const t=u.Tb();u.Sb(0,"div",1),u.Sb(1,"div",2),u.Sb(2,"div",3),u.Sb(3,"div",4),u.Sb(4,"div",5),u.Sb(5,"div",6),u.Sb(6,"div",7),u.Sb(7,"h1"),u.Ec(8),u.dc(9,"translate"),u.Rb(),u.Sb(10,"p"),u.Ec(11),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Sb(12,"div",8),u.Sb(13,"form",9),u.ac("submit",(function(){return u.wc(t),u.cc().searchNotification()})),u.Sb(14,"div",10),u.dc(15,"translate"),u.Sb(16,"label",11),u.Ec(17),u.dc(18,"translate"),u.Rb(),u.Nb(19,"span",12),u.Nb(20,"input",13),u.dc(21,"translate"),u.Rb(),u.Sb(22,"div",10),u.dc(23,"translate"),u.Sb(24,"label",14),u.Ec(25),u.dc(26,"translate"),u.Rb(),u.Nb(27,"span",12),u.Nb(28,"input",15),u.dc(29,"translate"),u.Rb(),u.Sb(30,"div",16),u.Sb(31,"button",17),u.Ec(32),u.dc(33,"translate"),u.Rb(),u.Rb(),u.Sb(34,"div",18),u.Sb(35,"button",19),u.Ec(36),u.dc(37,"translate"),u.Rb(),u.Rb(),u.Rb(),u.Sb(38,"div",20),u.Sb(39,"tabset",null,21),u.Sb(41,"tab",22),u.dc(42,"translate"),u.Cc(43,j,2,1,"div",23),u.Cc(44,O,4,7,"div",24),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb()}if(2&t){const t=e.ngIf,a=u.cc();u.Ab(8),u.Fc(u.ec(9,24,"virtual_mb_title")),u.Ab(3),u.Fc(a.getUsername(null==t?null:t.customer)),u.Ab(2),u.jc("formGroup",a.searchForm),u.Ab(1),u.jc("title",u.ec(15,26,"virtual_mb_range_max_60")),u.Ab(3),u.Fc(u.ec(18,28,"virtual_mb_date_from")),u.Ab(3),u.jc("minDate",a.minDateFrom)("maxDate",a.maxDateFrom)("bsConfig",u.mc(44,A))("placeholder",u.ec(21,30,"dd/mm/aaaa"))("ngClass",u.nc(45,$,a.hasError(a.searchForm.get("since"))))("dateCustomClasses",a.dateCustomClasses),u.Ab(2),u.jc("title",u.ec(23,32,"virtual_mb_range_max_60")),u.Ab(3),u.Fc(u.ec(26,34,"virtual_mb_date_to")),u.Ab(3),u.jc("minDate",a.minDateTo)("maxDate",a.maxDateTo)("bsConfig",u.mc(47,A))("placeholder",u.ec(29,36,"dd/mm/aaaa"))("ngClass",u.nc(48,$,a.hasError(a.searchForm.get("dateTo"))))("dateCustomClasses",a.dateCustomClasses),u.Ab(4),u.Gc(" ",u.ec(33,38,"virtual_mb_btn_search")," "),u.Ab(4),u.Gc(" ",u.ec(37,40,"virtual_mb_btn_search")," "),u.Ab(5),u.jc("heading",u.ec(42,42,"virtual_mb_tab_mailing")),u.Ab(2),u.jc("ngIf",a.notifications.length&&a.showResult),u.Ab(1),u.jc("ngIf",!a.notifications.length&&a.showResult)}}let E=(()=>{class t{constructor(t,e,a,i,n){this.formBuilder=t,this.bsLocaleService=e,this.headerService=a,this.accountService=i,this.mailboxService=n,this.state$=this.createState(),this.maxDateTo=new Date,this.minDateFrom=new Date(l().subtract(60,"days").format("L")),this.showResult=!1}ngOnInit(){this.headerService.updateTitle("menu_mailbox"),this.bsLocaleService.use("es"),this.createForm(),this.searchNotification()}getUsername(t){var e,a,i;return`${null===(e=t)||void 0===e?void 0:e.name} ${null===(a=t)||void 0===a?void 0:a.firstSurname} ${null===(i=t)||void 0===i?void 0:i.secondarySurname}`}get maxDateFrom(){return this.f.dateTo.value?new Date(this.f.dateTo.value):new Date}get minDateTo(){return this.f.dateFrom.value?new Date(this.f.dateFrom.value):new Date(l().subtract(60,"days").format("L"))}createState(){return Object(s.a)(this.accountService.currentCustomer$.pipe(Object(r.a)(t=>!!t),Object(o.b)())).pipe(Object(c.a)(([t])=>({customer:t})))}createForm(){const t=new Date(l().subtract(60,"days").format("L")),e=new Date;this.searchForm=this.formBuilder.group({dateFrom:[t,[d.r.required]],dateTo:[e,[d.r.required]]})}searchNotification(){this.showResult=!1,this.notifications=this.documents=[],this.since=Object(b.f)(this.f.dateFrom.value),this.until=Object(b.f)(this.f.dateTo.value),this.mailboxService.checkCorrespondence(this.since,this.until).subscribe(t=>{this.showResult=!0,this.notifications=this.documents=t})}get f(){return this.searchForm.controls}hasError(t){return this.formSubmit&&t.invalid}}return t.\u0275fac=function(e){return new(e||t)(u.Mb(d.c),u.Mb(m.d),u.Mb(p.a),u.Mb(o.a),u.Mb(R))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-virtual-mailbox"]],decls:2,vars:3,consts:[["class","max-size virtual-mailbox",4,"ngIf"],[1,"max-size","virtual-mailbox"],[1,"main"],[1,"main-col"],[1,"main__header"],[1,"main__header__desktop"],[1,"main__header__title"],[1,"main__header__title__col"],[1,"main__body"],[3,"formGroup","submit"],[1,"group-input","input-text",3,"title"],["for","dateFrom"],[1,"ico-calendary","icon-input","yellow"],["id","dateFrom","type","text","bsDatepicker","","formControlName","dateFrom",3,"minDate","maxDate","bsConfig","placeholder","ngClass","dateCustomClasses"],["for","dateTo"],["id","dateTo","type","text","bsDatepicker","","formControlName","dateTo",3,"minDate","maxDate","bsConfig","placeholder","ngClass","dateCustomClasses"],[1,"group-button"],["type","submit",1,"btn--primary-small"],[1,"main__button"],["type","submit",1,"btn--primary"],[1,"tabs-block--desktop"],["staticTabs",""],[3,"heading"],[4,"ngIf"],["class","tabs-block--desktop__no-data",4,"ngIf"],["type","notification",3,"item",4,"ngFor","ngForOf"],["type","notification",3,"item"],[1,"tabs-block--desktop__no-data"]],template:function(t,e){1&t&&(u.Cc(0,M,45,50,"div",0),u.dc(1,"async")),2&t&&u.jc("ngIf",u.ec(1,1,e.state$))},directives:[n.p,d.s,d.o,d.g,m.b,d.b,m.a,d.n,d.f,n.n,C.c,C.a,n.o,D],pipes:[n.b,x.d],encapsulation:2}),t})();var T=a("tyNb");const I=[{path:"",component:E}];let N=(()=>{class t{}return t.\u0275mod=u.Kb({type:t}),t.\u0275inj=u.Jb({factory:function(e){return new(e||t)},imports:[[T.h.forChild(I)],T.h]}),t})();a.d(e,"VirtualMailboxModule",(function(){return L}));let L=(()=>{class t{}return t.\u0275mod=u.Kb({type:t}),t.\u0275inj=u.Jb({factory:function(e){return new(e||t)},imports:[[n.c,N,i.a]]}),t})()}}]);
//# sourceMappingURL=20-es2015.dab2887e1e4e1688b897.js.map