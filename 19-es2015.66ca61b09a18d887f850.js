(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{uqTW:function(t,e,n){"use strict";n.r(e);var r=n("tyNb"),c=n("quSY"),a=n("itXk"),i=n("dZRt"),s=n("eIep"),o=n("lJxs"),b=n("a+Vh"),l=n("9H/N"),u=n("fXoL"),d=n("vHNk"),f=n("AytR"),p=n("tk/3");let m=(()=>{class t{constructor(t){this.http=t}simulate(t){return this.http.post(`${f.a.apiBasePath}${f.a.endpoints.transfer.simulate}`,t)}otp(t){return this.http.post(`${f.a.apiBasePath}${f.a.endpoints.transfer.otp}`,t)}confirm(t){return this.http.post(`${f.a.apiBasePath}${f.a.endpoints.transfer.confirm}`,t)}}return t.\u0275fac=function(e){return new(e||t)(u.Wb(p.b))},t.\u0275prov=u.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var h=n("9yxR"),v=n("v98y"),S=n("K3ix"),_=n("2PZR"),g=n("ofXK"),R=n("0rpK"),A=n("YonX"),E=n("3Pt+");function I(t){const e=Object(i.b)(t.value);return isNaN(e)?{invalidAmount:!0}:e<=0?{minAmountError:!0}:null}var O=n("sYmb"),P=n("tepA");function F(t,e){1&t&&(u.Sb(0,"p",9),u.Nb(1,"span",10),u.Ec(2),u.dc(3,"translate"),u.Rb()),2&t&&(u.Ab(2),u.Gc("",u.ec(3,1,"transfer_balance_error")," "))}function y(t,e){1&t&&(u.Sb(0,"p",9),u.Nb(1,"span",10),u.Ec(2),u.dc(3,"translate"),u.Rb()),2&t&&(u.Ab(2),u.Gc("",u.ec(3,1,"transfer_min_amount_error")," "))}const T=function(t){return{error:t}};let j=(()=>{class t{constructor(t){this.formBuilder=t,this.submitForm=new u.n,this.submitted=!1}get hasAmountError(){const t=this.form.get("amount");return this.hasError(t)&&t.hasError("balanceError")}get hasMinAmountError(){const t=this.form.get("amount");return this.hasError(t)&&t.hasError("minAmountError")}ngOnInit(){this.createForm()}onSubmit(){this.submitted=!0,this.form.markAllAsTouched(),this.form.valid&&this.submitForm.emit({amount:this.form.value.amount,concept:this.form.value.concept})}hasError(t){return t.touched&&t.invalid}createForm(){var t;this.form=this.formBuilder.group({amount:["",[E.r.required,(t=this.balance,e=>{var n;return Object(i.b)(null===(n=e)||void 0===n?void 0:n.value)>t?{balanceError:!0}:null}),I]],concept:["",E.r.required]})}}return t.\u0275fac=function(e){return new(e||t)(u.Mb(E.c))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-transfer-form"]],inputs:{senderIban:"senderIban",receiverIban:"receiverIban",balance:"balance"},outputs:{submitForm:"submitForm"},decls:42,vars:39,consts:[[3,"formGroup","submit"],[1,"group-input"],[1,"input"],["formControlName","amount","type","text","appParseCurrency","","maxlength","10",3,"ngClass"],["class","error-text",4,"ngIf"],["formControlName","concept","type","text","maxlength","250",3,"ngClass"],[1,"group-button"],["type","submit",1,"btn--primary"],[1,"main__button"],[1,"error-text"],[1,"ico-alert"]],template:function(t,e){1&t&&(u.Sb(0,"form",0),u.ac("submit",(function(){return e.onSubmit()})),u.Sb(1,"div",1),u.Sb(2,"label"),u.Ec(3),u.dc(4,"translate"),u.Rb(),u.Sb(5,"p",2),u.Ec(6),u.dc(7,"formatIban"),u.Rb(),u.Rb(),u.Sb(8,"div",1),u.Sb(9,"label"),u.Ec(10),u.dc(11,"translate"),u.Rb(),u.Sb(12,"p",2),u.Ec(13),u.dc(14,"formatIban"),u.Rb(),u.Rb(),u.Sb(15,"div",1),u.Sb(16,"label"),u.Ec(17),u.dc(18,"translate"),u.Rb(),u.Sb(19,"p",2),u.Ec(20),u.dc(21,"currency"),u.Rb(),u.Rb(),u.Sb(22,"div",1),u.Sb(23,"label"),u.Ec(24),u.dc(25,"translate"),u.Rb(),u.Nb(26,"input",3),u.Cc(27,F,4,3,"p",4),u.Cc(28,y,4,3,"p",4),u.Rb(),u.Sb(29,"div",1),u.Sb(30,"label"),u.Ec(31),u.dc(32,"translate"),u.Rb(),u.Nb(33,"input",5),u.Rb(),u.Sb(34,"div",6),u.Sb(35,"button",7),u.Ec(36),u.dc(37,"translate"),u.Rb(),u.Rb(),u.Sb(38,"div",8),u.Sb(39,"button",7),u.Ec(40),u.dc(41,"translate"),u.Rb(),u.Rb(),u.Rb()),2&t&&(u.jc("formGroup",e.form),u.Ab(3),u.Fc(u.ec(4,15,"transfer_sender_account")),u.Ab(3),u.Fc(u.ec(7,17,e.senderIban)),u.Ab(4),u.Fc(u.ec(11,19,"transfer_receiver_account")),u.Ab(3),u.Fc(u.ec(14,21,e.receiverIban)),u.Ab(4),u.Fc(u.ec(18,23,"transfer_balance")),u.Ab(3),u.Fc(u.ec(21,25,e.balance||0)),u.Ab(4),u.Fc(u.ec(25,27,"transfer_amount")),u.Ab(2),u.jc("ngClass",u.nc(35,T,e.hasError(e.form.get("amount")))),u.Ab(1),u.jc("ngIf",e.hasAmountError),u.Ab(1),u.jc("ngIf",e.hasMinAmountError),u.Ab(3),u.Fc(u.ec(32,29,"transfer_concept")),u.Ab(2),u.jc("ngClass",u.nc(37,T,e.hasError(e.form.get("concept")))),u.Ab(3),u.Fc(u.ec(37,31,"transfer_continue")),u.Ab(4),u.Fc(u.ec(41,33,"transfer_continue")))},directives:[E.s,E.o,E.g,E.b,E.n,E.f,i.a,E.i,g.n,g.p],pipes:[O.d,P.a,g.d],encapsulation:2}),t})();var C=n("zcjR");const N=["otpModal"];function w(t,e){if(1&t){const t=u.Tb();u.Qb(0),u.Sb(1,"app-transfer-form",15),u.ac("submitForm",(function(e){return u.wc(t),u.cc(3).simulateTranfer(e)})),u.Rb(),u.Pb()}if(2&t){const t=u.cc(2).ngIf;u.Ab(1),u.jc("senderIban",t.account.IBAN)("receiverIban",t.globalPosition.OriginIBAN)("balance",t.account.Balance)}}function M(t,e){if(1&t&&(u.Sb(0,"div",4),u.Sb(1,"div",5),u.Sb(2,"div",6),u.Sb(3,"div",7),u.Sb(4,"div",8),u.Sb(5,"div",9),u.Sb(6,"div",10),u.Sb(7,"h1"),u.Ec(8),u.dc(9,"translate"),u.Rb(),u.Sb(10,"p"),u.Ec(11),u.dc(12,"formatIban"),u.Rb(),u.Rb(),u.Sb(13,"div",10),u.Sb(14,"p"),u.Ec(15),u.dc(16,"translate"),u.Rb(),u.Sb(17,"h1"),u.Ec(18),u.dc(19,"currency"),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Sb(20,"div",11),u.Cc(21,w,2,3,"ng-container",12),u.Rb(),u.Rb(),u.Sb(22,"div",13),u.Nb(23,"app-aside-banner",14),u.Rb(),u.Rb(),u.Rb()),2&t){const t=u.cc().ngIf,e=u.tc(3),n=u.cc();u.Ab(8),u.Fc(u.ec(9,8,"transfer_title")),u.Ab(3),u.Fc(u.ec(12,10,t.account.IBAN)),u.Ab(4),u.Fc(u.ec(16,12,"transfer_balance")),u.Ab(3),u.Fc(u.ec(19,14,t.account.Balance)),u.Ab(3),u.jc("ngIf",!n.simulateOutput)("ngIfElse",e),u.Ab(1),u.jc("appBannerBackground",n.banners.transfer),u.Ab(1),u.jc("globalPosition",t.globalPosition)}}function k(t,e){if(1&t){const t=u.Tb();u.Sb(0,"div",16),u.Sb(1,"div",17),u.Sb(2,"label"),u.Ec(3),u.dc(4,"translate"),u.Rb(),u.Sb(5,"p"),u.Ec(6),u.dc(7,"formatIban"),u.Rb(),u.Rb(),u.Sb(8,"div",17),u.Sb(9,"label"),u.Ec(10),u.dc(11,"translate"),u.Rb(),u.Sb(12,"p"),u.Ec(13),u.dc(14,"formatIban"),u.Rb(),u.Rb(),u.Sb(15,"div",17),u.Sb(16,"label"),u.Ec(17),u.dc(18,"translate"),u.Rb(),u.Sb(19,"p"),u.Ec(20),u.dc(21,"currency"),u.Rb(),u.Rb(),u.Sb(22,"div",17),u.Sb(23,"label"),u.Ec(24),u.dc(25,"translate"),u.Rb(),u.Sb(26,"p"),u.Ec(27),u.Rb(),u.Rb(),u.Sb(28,"div",17),u.Sb(29,"label"),u.Ec(30),u.dc(31,"translate"),u.Rb(),u.Sb(32,"p"),u.Ec(33),u.dc(34,"currency"),u.Rb(),u.Rb(),u.Sb(35,"div",18),u.Sb(36,"button",19),u.ac("click",(function(){return u.wc(t),u.cc(2).generateOtp()})),u.Ec(37),u.dc(38,"translate"),u.Rb(),u.Rb(),u.Sb(39,"div",20),u.Sb(40,"button",19),u.ac("click",(function(){return u.wc(t),u.cc(2).generateOtp()})),u.Ec(41),u.dc(42,"translate"),u.Rb(),u.Rb(),u.Rb()}if(2&t){const t=u.cc().ngIf,e=u.cc();u.Ab(3),u.Fc(u.ec(4,12,"transfer_sender_account")),u.Ab(3),u.Fc(u.ec(7,14,t.account.IBAN)),u.Ab(4),u.Fc(u.ec(11,16,"transfer_receiver_account")),u.Ab(3),u.Fc(u.ec(14,18,t.globalPosition.OriginIBAN)),u.Ab(4),u.Fc(u.ec(18,20,"transfer_amount")),u.Ab(3),u.Fc(u.ec(21,22,null==e.currentTransfer?null:e.currentTransfer.amount)),u.Ab(4),u.Fc(u.ec(25,24,"transfer_concept")),u.Ab(3),u.Fc(null==e.currentTransfer?null:e.currentTransfer.concept),u.Ab(3),u.Fc(u.ec(31,26,"transfer_fee")),u.Ab(3),u.Fc(u.ec(34,28,null==e.simulateOutput?null:e.simulateOutput.fee)),u.Ab(4),u.Gc(" ",u.ec(38,30,"transfer_confirm")," "),u.Ab(4),u.Gc(" ",u.ec(42,32,"transfer_confirm")," ")}}function B(t,e){if(1&t){const t=u.Tb();u.Sb(0,"app-otp-form",21),u.ac("send",(function(e){return u.wc(t),u.cc(2).makeTransfer(e)}))("repeat",(function(){return u.wc(t),u.cc(2).generateOtp()}))("hide",(function(){return u.wc(t),u.cc(2).closeModal()})),u.Rb()}if(2&t){const t=u.cc(2);u.jc("invalidCode",t.invalidOtp)}}function $(t,e){if(1&t&&(u.Qb(0),u.Cc(1,M,24,16,"div",1),u.Cc(2,k,43,34,"ng-template",null,2,u.Dc),u.Cc(4,B,1,1,"ng-template",null,3,u.Dc),u.Pb()),2&t){const t=e.ngIf;u.Ab(1),u.jc("ngIf",(null==t?null:t.globalPosition)&&(null==t?null:t.account))}}const x=function(){return["../../transactions"]},G=[{path:"",component:(()=>{class t{constructor(t,e,n,r,a,i,s,o,b){this.headerService=t,this.transferService=e,this.accountService=n,this.errorHandler=r,this.modalService=a,this.globalPositionService=i,this.router=s,this.route=o,this.banners=b,this.state$=this.createState(),this.invalidOtp=!1,this.subs=new c.a}ngOnInit(){this.globalPositionService.fetchGlobalPosition(),this.headerService.updateTitle("transfer_title")}ngOnDestroy(){this.subs.unsubscribe(),this.closeModal()}openModal(t){this.modalService.getModalsCount()||(this.modalRef=this.modalService.show(t))}closeModal(){var t;null===(t=this.modalRef)||void 0===t||t.hide()}generateOtp(){this.invalidOtp=!1,this.referenceOTP=null,this.subs.add(this.transferService.otp(this.currentTransfer).subscribe(({referenceOTP:t})=>{this.referenceOTP=t,this.openModal(this.otpModal)},t=>{this.errorHandler.showError(t)}))}simulateTranfer({amount:t,concept:e}){this.subs.add(this.state$.pipe(Object(s.a)(n=>{var r,c,a,s,o,b;return this.currentTransfer={amount:Object(i.b)(t).toString(),concept:e,sender:{iban:null===(c=null===(r=n)||void 0===r?void 0:r.account)||void 0===c?void 0:c.IBAN,name:null===(a=n)||void 0===a?void 0:a.customerName},receiver:{iban:null===(o=null===(s=n)||void 0===s?void 0:s.globalPosition)||void 0===o?void 0:o.OriginIBAN,name:null===(b=n)||void 0===b?void 0:b.customerName}},this.transferService.simulate(this.currentTransfer)})).subscribe(t=>{this.simulateOutput=t},t=>{this.errorHandler.showError(t)}))}makeTransfer(t){this.subs.add(this.transferService.confirm(Object.assign(Object.assign({},this.currentTransfer),{otp:{keyOTP:t,referenceOTP:this.referenceOTP}})).subscribe(()=>{this.navigateTouSuccessPage(),this.closeModal()},t=>{Object(b.j)(t)?this.invalidOtp=!0:(this.closeModal(),this.errorHandler.showError(t))}))}clearCurrentTranfer(){this.currentTransfer=null,this.simulateOutput=null}getCustomerName(){return this.accountService.currentCustomer$.pipe(Object(o.a)(t=>{var e,n,r,c;return(null===(e=t)||void 0===e?void 0:e.DatosPersonales)?`${null===(n=t.DatosPersonales)||void 0===n?void 0:n.nombreCliente} `+`${null===(r=t.DatosPersonales)||void 0===r?void 0:r.apellido1Cliente} `+`${null===(c=t.DatosPersonales)||void 0===c?void 0:c.apellido2Cliente}`:""}))}createState(){return Object(a.a)([this.globalPositionService.globalPosition$,this.globalPositionService.globalPosition$.pipe(Object(b.d)()),this.globalPositionService.globalPosition$.pipe(Object(b.e)()),this.getCustomerName()]).pipe(Object(o.a)(([t,e,n,r])=>({globalPosition:t,account:e,deposit:n,customerName:r})))}navigateTouSuccessPage(){this.router.navigate(["./transfer-success"],{skipLocationChange:!0,relativeTo:this.route})}}return t.\u0275fac=function(e){return new(e||t)(u.Mb(d.a),u.Mb(m),u.Mb(h.a),u.Mb(v.a),u.Mb(S.b),u.Mb(_.a),u.Mb(r.d),u.Mb(r.a),u.Mb(l.a))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-transfer"]],viewQuery:function(t,e){var n;1&t&&u.Ic(N,!0),2&t&&u.sc(n=u.bc())&&(e.otpModal=n.first)},decls:2,vars:3,consts:[[4,"ngIf"],["class","max-size transfer",4,"ngIf"],["confirmTransfer",""],["otpModal",""],[1,"max-size","transfer"],[1,"main"],[1,"main-col"],[1,"main__header"],[1,"main__header__desktop"],[1,"main__header__title"],[1,"main__header__title__col"],[1,"main__body"],[4,"ngIf","ngIfElse"],[1,"aside-col",3,"appBannerBackground"],[3,"globalPosition"],[3,"senderIban","receiverIban","balance","submitForm"],[1,"confirm-transfer"],[1,"group-input"],[1,"group-button"],[1,"btn--primary",3,"click"],[1,"main__button"],[3,"invalidCode","send","repeat","hide"]],template:function(t,e){1&t&&(u.Cc(0,$,6,1,"ng-container",0),u.dc(1,"async")),2&t&&u.jc("ngIf",u.ec(1,1,e.state$))},directives:[g.p,R.a,A.a,j,C.a],pipes:[g.b,O.d,P.a,g.d],encapsulation:2}),t})()},{path:"transfer-success",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=u.Gb({type:t,selectors:[["app-success-transfer"]],decls:29,vars:22,consts:[[1,"max-size","deposit"],[1,"main"],[1,"main-col","no-aside"],[1,"main__header"],[1,"main__header__desktop"],[1,"main__header__title"],[1,"main__header__title__col"],[1,"main__body"],[1,"main__body__confirm"],[1,"ico-check-filled"],["type","button",1,"btn--primary",3,"routerLink"],[1,"main__button"]],template:function(t,e){1&t&&(u.Sb(0,"div",0),u.Sb(1,"div",1),u.Sb(2,"div",2),u.Sb(3,"div",3),u.Sb(4,"div",4),u.Sb(5,"div",5),u.Sb(6,"div",6),u.Sb(7,"h1"),u.Ec(8),u.dc(9,"translate"),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Sb(10,"div",7),u.Sb(11,"div",8),u.Nb(12,"span",9),u.Sb(13,"h2"),u.Ec(14),u.dc(15,"translate"),u.Rb(),u.Sb(16,"h2"),u.Ec(17),u.dc(18,"translate"),u.Rb(),u.Sb(19,"p"),u.Ec(20),u.dc(21,"translate"),u.Rb(),u.Rb(),u.Sb(22,"button",10),u.Ec(23),u.dc(24,"translate"),u.Rb(),u.Sb(25,"div",11),u.Sb(26,"button",10),u.Ec(27),u.dc(28,"translate"),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb()),2&t&&(u.Ab(8),u.Fc(u.ec(9,8,"transfer_title")),u.Ab(6),u.Fc(u.ec(15,10,"transfer_congrats")),u.Ab(3),u.Fc(u.ec(18,12,"transfer_success_process")),u.Ab(3),u.Fc(u.ec(21,14,"transfer_success_balance")),u.Ab(2),u.jc("routerLink",u.mc(20,x)),u.Ab(1),u.Gc(" ",u.ec(24,16,"transfer_success_button")," "),u.Ab(3),u.jc("routerLink",u.mc(21,x)),u.Ab(1),u.Gc(" ",u.ec(28,18,"transfer_success_button")," "))},directives:[r.e],pipes:[O.d],encapsulation:2}),t})()}];let D=(()=>{class t{}return t.\u0275mod=u.Kb({type:t}),t.\u0275inj=u.Jb({factory:function(e){return new(e||t)},imports:[[r.h.forChild(G)],r.h]}),t})();var H=n("PCNd");n.d(e,"TransferModule",(function(){return J}));let J=(()=>{class t{}return t.\u0275mod=u.Kb({type:t}),t.\u0275inj=u.Jb({factory:function(e){return new(e||t)},imports:[[H.a,D]]}),t})()}}]);