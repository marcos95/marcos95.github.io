{"version":3,"sources":["webpack:///src/app/core/services/password/password.service.ts","webpack:///src/app/personal-data/components/info-personal-data/info-personal-data.component.html","webpack:///src/app/personal-data/components/info-personal-data/info-personal-data.component.ts","webpack:///src/app/personal-data/components/data-protection/data-protection.component.ts","webpack:///src/app/personal-data/components/data-protection/data-protection.component.html","webpack:///src/app/personal-data/components/change-password-form/change-password-form.component.ts","webpack:///src/app/personal-data/components/change-password-form/change-password-form.component.html","webpack:///src/app/personal-data/personal-data.component.html","webpack:///src/app/personal-data/personal-data-routing.module.ts","webpack:///src/app/personal-data/personal-data.component.ts","webpack:///src/app/personal-data/personal-data.module.ts"],"names":["PasswordService","http","body","this","post","environment","apiBasePath","endpoints","passwordRegeneration","put","changePassword","CUSTOMER_CASE_FORM","TYPE_CASE","CATEGORY","COMENTS","EMAIL","PHONE","STREET_TYPE","STREET_NAME","STREET_NUMBER","PORTAL","FLOOR","DOOR","POSTAL_CODE","LOCATION_CODE","ADDRESS","ADDRESS_LOCATION","EMPLOYMENT_SITUATION","InfoPersonalDataComponent","dictionaryService","streetTypes","updateChange","formError","formCase","employmentSituation","locationList","updatePersonalDate","Object","emailValidator","required","pattern","phoneValidator","addressValidator","postalCodeAndLocationValidation","validationRequired","customer","setLocationStream","postalCode","addressConcat","concatAddress","concatPostalCodeAndLocation","getEmploymentStatus","subscribe","result","find","opt","code","name","streetName","streetNumber","value","getLocation","postalCodeAndLocation","locationName","provinceName","laboralSituationCode","ls","param","hasOwnProperty","lab","emit","DataProtectionComponent","disableCheck","indPubliPe","indNoCesiEmpGrupo","ChangePasswordFormComponent","formBuilder","hide","submitted","createForm","form","markAllAsTouched","valid","password","newPassword","control","touched","invalid","get","hasError","group","newPasswordConfirm","validators","onSubmit","routes","path","component","PersonalDataComponent","headerService","accountService","modalService","passwordService","errorHandler","customer$","getCustomer","invalidOtp","subs","Subscription","updateTitle","template","modalRef","show","firstSurname","secondarySurname","openModal","changePasswordModal","passwordData","changePasswordData","newPpassword","confirmNewPassword","closeModal","generateOtp","add","otpId","changePasswordOtpId","otpModal","error","showError","secretKey","confirmChangePassword","otp","reference","successChangePasswordModal","currentCustomer$","pipe","filter","PersonalDataRoutingModule","forChild","PersonalDataModule"],"mappings":"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","file":"x","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { ReGenerationPswData } from '@api/models/reGenerationPswData';\r\nimport { environment } from '@environment/environment';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class PasswordService {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  changePassword(body: ReGenerationPswData) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.passwordRegeneration}`;\r\n    return this.http.post<{ otpId: string }>(url, body);\r\n  }\r\n\r\n  confirmChangePassword(body: ReGenerationPswData) {\r\n    const url = `${environment.apiBasePath}${environment.endpoints.passwordRegeneration}`;\r\n    return this.http.put(url, body);\r\n  }\r\n}\r\n","<div class=\"tab__personal-data\" *ngIf=\"customer\">\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ 'profile_name_label' | translate }}</p>\r\n    </div>\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ customer.name | titlecase }}</p>\r\n    </div>\r\n  </div>\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ 'profile_lastnames_label' | translate }}</p>\r\n    </div>\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ customer.firstSurname | titlecase }} {{ customer.secondarySurname | titlecase }}</p>\r\n    </div>\r\n  </div>\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ 'profile_dni_label' | translate }}</p>\r\n    </div>\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ customer.identificationNumber }}</p>\r\n    </div>\r\n  </div>\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ 'profile_address_label' | translate }}</p>\r\n    </div>\r\n    <div class=\"tab__personal-data__col\">\r\n      <!-- <app-inline-editable\r\n        type=\"text\"\r\n        [validators]=\"addressValidator\"\r\n        [fieldValue]=\"addressConcat\"\r\n        (save)=\"saveEditable($event, 'address')\"\r\n        placeholder=\"profile_address_placeholder\"\r\n      ></app-inline-editable> -->\r\n      <!-- <app-inline-editable\r\n        type=\"text\"\r\n        [validators]=\"postalCodeAndLocationValidation\"\r\n        [fieldValue]=\"postalCodeAndLocation | titlecase\"\r\n        (save)=\"saveEditable($event, 'addressLocation')\"\r\n        placeholder=\"profile_address_cp_placeholder\"\r\n        >\r\n      </app-inline-editable> -->\r\n      <p>{{ addressConcat | titlecase }} {{ postalCodeAndLocation | titlecase }}</p>\r\n    </div>\r\n  </div>\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ 'profile_phone_label' | translate }}</p>\r\n    </div>\r\n    <div class=\"tab__personal-data__col\">\r\n      <!-- <app-inline-editable\r\n        type=\"text\"\r\n        [validators]=\"phoneValidator\"\r\n        [fieldValue]=\"customer.mobilePhone\"\r\n        (save)=\"saveEditable($event, formCase.PHONE)\"\r\n        placeholder=\"+34\"\r\n      ></app-inline-editable> -->\r\n      <p>{{ customer.mobilePhone }}</p>\r\n    </div>\r\n  </div>\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ 'profile_email_label' | translate }}</p>\r\n    </div>\r\n    <div class=\"tab__personal-data__col\">\r\n      <!-- <app-inline-editable\r\n        type=\"email\"\r\n        [validators]=\"emailValidator\"\r\n        [fieldValue]=\"customer.email\"\r\n        (save)=\"saveEditable($event, formCase.EMAIL)\"\r\n        (formError)=\"formError.emit($event)\"\r\n        placeholder=\"profile_email_placeholder\"\r\n      ></app-inline-editable> -->\r\n      <p>{{ customer.email }}</p>\r\n    </div>\r\n  </div>\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ 'profile_laboral_situation_label' | translate }}</p>\r\n    </div>\r\n    <div class=\"tab__personal-data__col\">\r\n      <!-- <app-inline-editable\r\n        type=\"select\"\r\n        [validators]=\"validationRequired\"\r\n        [fieldValue]=\"customer.laboralSituationCode\"\r\n        [optionsList]=\"employmentSituation\"\r\n        optionKey=\"code\"\r\n        optionValue=\"name\"\r\n        (save)=\"saveEditable($event, formCase.EMPLOYMENT_SITUATION)\"\r\n        (formError)=\"formError.emit($event)\"\r\n        placeholder=\"profile_laboral_situaton_placeholder\"\r\n      >\r\n      </app-inline-editable> -->\r\n      <p>{{ getOptionsNameLaboralSituation(customer.laboralSituationCode) | titlecase }}</p>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>{{ 'profile_password_label' | translate }}</p>\r\n    </div>\r\n    <div class=\"tab__personal-data__col\">\r\n      <div class=\"tab__personal-data__edit\">\r\n        <p class=\"tab__personal-data__edit__text\">********</p>\r\n        <span\r\n          class=\"ico-edit tab__personal-data__edit__icon\"\r\n          (click)=\"changePassword.emit()\"\r\n        ></span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"tab__personal-data\" *ngIf=\"!customer\">\r\n  <div class=\"tab__personal-data__row\">\r\n    <div class=\"tab__personal-data__col\">\r\n      <p>Los datos del perfil no han podido ser consultados.</p>\r\n      <p>Por favor inténtelo más tarde.</p>\r\n      <p>Disculpe las molestias.</p>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { Customer } from '@core/models/customer.model';\r\nimport { DictionaryService } from '@core/services/dictionary/dictionary.service';\r\nimport { Component, OnInit, Inject, Input, Output, EventEmitter } from '@angular/core';\r\nimport { LABORAL_SITUATION, STREET_TYPES, StreetTypes } from '@core/constants';\r\nimport { Cnogroupcnocnae } from '@api/models';\r\nimport { Validators } from '@angular/forms';\r\nimport { FORM_CASE } from '@core/config/form-case';\r\nimport { AddressLocation } from '@api/models/addressLocation';\r\nimport {\r\n  emailRegExp,\r\n  spanishPhoneRegExp,\r\n  initPostalCodeAndLocationRegExp,\r\n  streetTypeNameAndNumberFloorDoor,\r\n} from '@shared/utils';\r\nimport { noWhiteSpaceValidator } from '@shared/validators';\r\n\r\nexport enum CUSTOMER_CASE_FORM {\r\n  TYPE_CASE = 'typeCase',\r\n  CATEGORY = 'category',\r\n  COMENTS = 'coments',\r\n  EMAIL = 'email',\r\n  PHONE = 'phone',\r\n  STREET_TYPE = 'streetType',\r\n  STREET_NAME = 'streetName',\r\n  STREET_NUMBER = 'streetNumber',\r\n  PORTAL = 'portal',\r\n  FLOOR = 'floor',\r\n  DOOR = 'door',\r\n  POSTAL_CODE = 'postalCode',\r\n  LOCATION_CODE = 'locationCode',\r\n  ADDRESS = 'address',\r\n  ADDRESS_LOCATION = 'addressLocation',\r\n  EMPLOYMENT_SITUATION = 'employmentSituation',\r\n}\r\n@Component({\r\n  selector: 'app-info-personal-data',\r\n  templateUrl: './info-personal-data.component.html',\r\n  styleUrls: ['./info-personal-data.component.scss'],\r\n})\r\nexport class InfoPersonalDataComponent implements OnInit {\r\n  @Input() formControl;\r\n  @Input() customer: Customer;\r\n  @Output() updateChange = new EventEmitter<any>();\r\n  @Output() formError = new EventEmitter<boolean>();\r\n  @Output() changePassword = new EventEmitter<void>();\r\n\r\n  formCase = FORM_CASE;\r\n  employmentSituation: Cnogroupcnocnae[] = [];\r\n  locationList: AddressLocation[] = [];\r\n  updatePersonalDate = new Object();\r\n\r\n  emailValidator = [Validators.required, Validators.pattern(emailRegExp), noWhiteSpaceValidator];\r\n  phoneValidator = [\r\n    Validators.required,\r\n    Validators.pattern(spanishPhoneRegExp),\r\n    noWhiteSpaceValidator,\r\n  ];\r\n  addressValidator = [Validators.required, Validators.pattern(streetTypeNameAndNumberFloorDoor)];\r\n  postalCodeAndLocationValidation = [\r\n    Validators.required,\r\n    Validators.pattern(initPostalCodeAndLocationRegExp),\r\n  ];\r\n  validationRequired = [Validators.required];\r\n  postalCodeEmit: string;\r\n  addressConcat: string;\r\n  postalCodeAndLocation: string;\r\n\r\n  constructor(\r\n    private dictionaryService: DictionaryService,\r\n    @Inject(STREET_TYPES) public streetTypes: StreetTypes\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    if (this.customer) {\r\n      this.setLocationStream(this.customer.postalCode);\r\n      this.addressConcat = this.concatAddress();\r\n      this.concatPostalCodeAndLocation(this.locationList);\r\n      this.dictionaryService.getEmploymentStatus().subscribe((result) => {\r\n        this.employmentSituation = result;\r\n      });\r\n    }\r\n  }\r\n\r\n  private concatAddress() {\r\n    const streetType = this.streetTypes.find((opt) => opt.code === this.customer.streetTypes);\r\n    return `${streetType.name}, ${this.customer.streetName}, ${this.customer.streetNumber}`;\r\n  }\r\n\r\n  private setLocationStream(value) {\r\n    this.dictionaryService.getLocation(value).subscribe((result) => {\r\n      this.locationList = result;\r\n      this.concatPostalCodeAndLocation(this.locationList);\r\n    });\r\n  }\r\n  private concatPostalCodeAndLocation(locationList) {\r\n    this.postalCodeAndLocation = `${this.customer.postalCode}, ${this.customer.locationName}, ${this.customer.provinceName}`;\r\n  }\r\n\r\n  getOptionsNameLaboralSituation(laboralSituationCode) {\r\n    return this.employmentSituation.find((ls) => ls.code === laboralSituationCode)?.name;\r\n  }\r\n\r\n  saveEditable(value, param) {\r\n    switch (param) {\r\n      case CUSTOMER_CASE_FORM.ADDRESS:\r\n        if (this.addressConcat !== value) {\r\n          this.updatePersonalDate[param] = value;\r\n        } else {\r\n          if (this.updatePersonalDate.hasOwnProperty(param)) {\r\n            delete this.updatePersonalDate[param];\r\n          }\r\n        }\r\n        break;\r\n\r\n      case CUSTOMER_CASE_FORM.ADDRESS_LOCATION:\r\n        if (this.postalCodeAndLocation !== value) {\r\n          this.updatePersonalDate[param] = value;\r\n        } else {\r\n          if (this.updatePersonalDate.hasOwnProperty(param)) {\r\n            delete this.updatePersonalDate[param];\r\n          }\r\n        }\r\n        break;\r\n\r\n      case CUSTOMER_CASE_FORM.EMPLOYMENT_SITUATION:\r\n        if (this.postalCodeAndLocation !== value) {\r\n          this.updatePersonalDate[param] = this.employmentSituation.find(\r\n            (lab) => lab.code === value\r\n          ).name;\r\n        } else {\r\n          if (this.updatePersonalDate.hasOwnProperty(param)) {\r\n            delete this.updatePersonalDate[param];\r\n          }\r\n        }\r\n        break;\r\n\r\n      default:\r\n        if (this.customer[param] !== value) {\r\n          this.updatePersonalDate[param] = value;\r\n        } else {\r\n          if (this.updatePersonalDate.hasOwnProperty(param)) {\r\n            delete this.updatePersonalDate[param];\r\n          }\r\n        }\r\n        break;\r\n    }\r\n    this.updateChange.emit(this.updatePersonalDate);\r\n  }\r\n}\r\n","import { Component, OnInit, Input } from '@angular/core';\r\nimport { Customer } from '@core/models/customer.model';\r\n\r\n@Component({\r\n  selector: 'app-data-protection',\r\n  templateUrl: './data-protection.component.html',\r\n  styleUrls: ['./data-protection.component.scss'],\r\n})\r\nexport class DataProtectionComponent implements OnInit {\r\n  @Input() customer: Customer;\r\n  readonly disableCheck = true;\r\n  constructor() {}\r\n\r\n  ngOnInit(): void {}\r\n\r\n  get activeNoCesionEmpNoGrupo() {\r\n    return this.customer.indPubliPe === 'S';\r\n  }\r\n\r\n  get activeIndPubliPe() {\r\n    return this.customer.indNoCesiEmpGrupo === 'N';\r\n  }\r\n}\r\n","<div class=\"data-protection\">\r\n  <div class=\"data-protection__row\">\r\n    <div class=\"switch\">\r\n      <label for=\"button-2\" class=\"switch__label\">\r\n        <p>\r\n          {{'profile_agree_offer_products_services' | translate}}\r\n        </p>\r\n      </label>\r\n      <label class=\"switch__button\" for=\"button-2\">\r\n        <input type=\"checkbox\" id=\"button-2\" [checked]=\"activeNoCesionEmpNoGrupo\" [disabled]=\"disableCheck\" />\r\n        <span class=\"slider round\"></span>\r\n      </label>\r\n    </div>\r\n  </div>\r\n  <div class=\"data-protection__row\">\r\n    <div class=\"switch\">\r\n      <label for=\"button-3\" class=\"switch__label\">\r\n        <p>\r\n          {{'profile_agree_share_my_personal_data' | translate}}\r\n        </p>\r\n      </label>\r\n      <label class=\"switch__button\" for=\"button-3\">\r\n        <input type=\"checkbox\" id=\"button-3\" [checked]=\"activeIndPubliPe\" [disabled]=\"disableCheck\"/>\r\n        <span class=\"slider round\"></span>\r\n      </label>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { Component, OnInit, Output, EventEmitter } from '@angular/core';\r\nimport { FormGroup, FormBuilder, AbstractControl, Validators } from '@angular/forms';\r\nimport { passwordFormat, matchValidator } from '@core/utils';\r\n\r\n@Component({\r\n  selector: 'app-change-password-form',\r\n  templateUrl: './change-password-form.component.html',\r\n  styles: [],\r\n})\r\nexport class ChangePasswordFormComponent implements OnInit {\r\n  @Output() changePassword = new EventEmitter<ChangePasswordData>();\r\n  @Output() hide = new EventEmitter<void>();\r\n  form: FormGroup;\r\n  submitted = false;\r\n\r\n  constructor(private formBuilder: FormBuilder) {}\r\n\r\n  ngOnInit() {\r\n    this.createForm();\r\n  }\r\n\r\n  onSubmit() {\r\n    this.submitted = true;\r\n    this.form.markAllAsTouched();\r\n\r\n    if (this.form.valid) {\r\n      this.changePassword.emit({\r\n        password: this.form.value.password,\r\n        newPassword: this.form.value.newPassword,\r\n      });\r\n    }\r\n  }\r\n\r\n  hasError(control: AbstractControl) {\r\n    return control.touched && control.invalid;\r\n  }\r\n\r\n  hasMismatchError() {\r\n    return this.form.get('newPasswordConfirm').touched && this.form.hasError('mismatch');\r\n  }\r\n\r\n  private createForm() {\r\n    this.form = this.formBuilder.group(\r\n      {\r\n        password: ['', [Validators.required]],\r\n        newPassword: ['', [Validators.required, Validators.pattern(passwordFormat)]],\r\n        newPasswordConfirm: ['', [Validators.required, Validators.pattern(passwordFormat)]],\r\n      },\r\n      { validators: matchValidator('newPassword', 'newPasswordConfirm') }\r\n    );\r\n  }\r\n}\r\n\r\nexport interface ChangePasswordData {\r\n  password: string;\r\n  newPassword: string;\r\n}\r\n","<form class=\"max-size-form\" [formGroup]=\"form\" (submit)=\"onSubmit()\">\r\n  <span class=\"modal__close ico-close\" (click)=\"hide.emit()\"></span>\r\n  <h2 class=\"modal__title\">{{ 'profile_change_password_title' | translate }}</h2>\r\n\r\n  <div class=\"group-input\">\r\n    <label for=\"password\">{{ 'profile_change_password_current' | translate }}</label>\r\n    <input\r\n      type=\"password\"\r\n      id=\"password\"\r\n      formControlName=\"password\"\r\n      maxlength=\"8\"\r\n      [ngClass]=\"{ error: hasError(form.get('password')) }\"\r\n    />\r\n  </div>\r\n\r\n  <div class=\"group-input\">\r\n    <label for=\"newPassword\">{{ 'profile_change_password_new' | translate }}</label>\r\n    <input\r\n      type=\"password\"\r\n      id=\"newPassword\"\r\n      formControlName=\"newPassword\"\r\n      minlength=\"8\"\r\n      maxlength=\"8\"\r\n      [ngClass]=\"{ error: hasError(form.get('newPassword')) }\"\r\n    />\r\n    <p class=\"modal__text-info\">{{ 'activate_user_password_format' | translate }}</p>\r\n  </div>\r\n\r\n  <div class=\"group-input\">\r\n    <label for=\"newPasswordConfirm\">{{ 'profile_change_password_confirm' | translate }}</label>\r\n    <input\r\n      type=\"password\"\r\n      id=\"newPasswordConfirm\"\r\n      formControlName=\"newPasswordConfirm\"\r\n      minlength=\"8\"\r\n      maxlength=\"8\"\r\n      [ngClass]=\"{\r\n        error: hasError(form.get('newPasswordConfirm')) || hasMismatchError()\r\n      }\"\r\n    />\r\n  </div>\r\n\r\n  <button class=\"modal__btn btn--primary\" type=\"submit\">\r\n    {{ 'profile_change_password_submit' | translate }}\r\n  </button>\r\n</form>\r\n","<div class=\"max-size personal-data\" *ngIf=\"customer$ | async as customer\">\r\n  <div class=\"main\">\r\n    <div class=\"main-col\">\r\n      <div class=\"main__header\">\r\n        <div class=\"main__header__desktop\">\r\n          <div class=\"main__header__title\">\r\n            <div class=\"main__header__title__col\">\r\n              <h1>{{ 'profile_title' | translate }}</h1>\r\n              <p>{{ getUsername(customer) }}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"main__body\">\r\n        <div class=\"tabs-block-size\">\r\n          <div class=\"tabs-block--desktop\">\r\n            <tabset #staticTabs>\r\n              <tab [heading]=\"'profile_tab_personal_data' | translate\">\r\n                <app-info-personal-data\r\n                  [customer]=\"customer\"\r\n                  (changePassword)=\"onClickChangePassword()\"\r\n                ></app-info-personal-data>\r\n              </tab>\r\n              <tab [heading]=\"'profile_tab_data_protection' | translate\">\r\n                <app-data-protection [customer]=\"customer\"></app-data-protection>\r\n              </tab>\r\n            </tabset>\r\n            <!-- <div class=\"group-button\" *ngIf=\"false\">\r\n              <button type=\"button\" class=\"btn--primary-small not-disabled-class mt-3\">\r\n                {{ 'profile_save_change_btn' | translate }}\r\n              </button>\r\n            </div> -->\r\n            <p class=\"mt-5\">{{ 'profile_modification_info' | translate }}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <!-- <div class=\"main__button\" *ngIf=\"false\">\r\n    <button type=\"button\" class=\"btn--primary\">\r\n      {{ 'profile_save_change_btn' | translate }}\r\n    </button>\r\n  </div> -->\r\n</div>\r\n\r\n<ng-template #changePasswordModal>\r\n  <app-change-password-form\r\n    (changePassword)=\"onChangePassword($event)\"\r\n    (hide)=\"closeModal()\"\r\n  ></app-change-password-form>\r\n</ng-template>\r\n\r\n<ng-template #otpModal>\r\n  <app-otp-form\r\n    [invalidCode]=\"invalidOtp\"\r\n    (send)=\"onSendOtp($event)\"\r\n    (repeat)=\"generateOtp()\"\r\n    (hide)=\"closeModal()\"\r\n  ></app-otp-form>\r\n</ng-template>\r\n\r\n<ng-template #successChangePasswordModal>\r\n  <app-info-modal\r\n    head=\"change_password_success_title\"\r\n    description=\"change_password_success_desc\"\r\n    type=\"success\"\r\n    (hide)=\"closeModal()\"\r\n  ></app-info-modal>\r\n</ng-template>\r\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { PersonalDataComponent } from './personal-data.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: PersonalDataComponent,\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class PersonalDataRoutingModule {}\r\n","import { Customer } from '@core/models/customer.model';\r\nimport { AccountService, createCustomerMap } from '@core/services/account/account.service';\r\nimport { Component, OnInit, TemplateRef, ViewChild } from '@angular/core';\r\nimport { HeaderService } from '@core/services/header/header.service';\r\nimport { filter } from 'rxjs/operators';\r\nimport { BsModalService, BsModalRef } from 'ngx-bootstrap/modal';\r\nimport { ChangePasswordData } from './components/change-password-form/change-password-form.component';\r\nimport { PasswordService } from '@core/services/password/password.service';\r\nimport { Subscription } from 'rxjs';\r\nimport { encrypt, PUBLIC_KEY, ALGORITHM, isInvalidOtp } from '@core/utils';\r\nimport { ErrorHandlerService } from '@core/services/errors/error-handler.service';\r\nimport { ReGenerationPswData } from '@api/models/reGenerationPswData';\r\n\r\n@Component({\r\n  selector: 'app-personal-data',\r\n  templateUrl: './personal-data.component.html',\r\n  styles: [],\r\n})\r\nexport class PersonalDataComponent implements OnInit {\r\n  @ViewChild('changePasswordModal') changePasswordModal: TemplateRef<any>;\r\n  @ViewChild('otpModal') otpModal: TemplateRef<any>;\r\n  @ViewChild('successChangePasswordModal') successChangePasswordModal: TemplateRef<any>;\r\n\r\n  readonly customer$ = this.getCustomer();\r\n  invalidOtp = false;\r\n\r\n  private changePasswordOtpId: string;\r\n  private changePasswordData: ReGenerationPswData;\r\n\r\n  private modalRef: BsModalRef;\r\n  private subs = new Subscription();\r\n\r\n  constructor(\r\n    private headerService: HeaderService,\r\n    private accountService: AccountService,\r\n    private modalService: BsModalService,\r\n    private passwordService: PasswordService,\r\n    private errorHandler: ErrorHandlerService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.headerService.updateTitle('menu_profile');\r\n  }\r\n\r\n  openModal(template: TemplateRef<any>) {\r\n    this.modalRef = this.modalService.show(template);\r\n  }\r\n\r\n  closeModal() {\r\n    if (this.modalRef) {\r\n      this.modalRef.hide();\r\n    }\r\n  }\r\n\r\n  getUsername(customer: Customer) {\r\n    return `${customer.name} ${customer?.firstSurname} ${customer.secondarySurname}`;\r\n  }\r\n\r\n  onClickChangePassword() {\r\n    this.openModal(this.changePasswordModal);\r\n  }\r\n\r\n  async onChangePassword(passwordData?: ChangePasswordData) {\r\n    const password = await encrypt(passwordData?.password, PUBLIC_KEY, ALGORITHM);\r\n    const newPassword = await encrypt(passwordData?.newPassword, PUBLIC_KEY, ALGORITHM);\r\n\r\n    this.changePasswordData = {\r\n      password,\r\n      newPpassword: newPassword,\r\n      confirmNewPassword: newPassword,\r\n    };\r\n\r\n    this.closeModal();\r\n    this.generateOtp();\r\n  }\r\n\r\n  generateOtp() {\r\n    this.invalidOtp = false;\r\n    this.subs.add(\r\n      this.passwordService.changePassword(this.changePasswordData).subscribe(\r\n        ({ otpId }) => {\r\n          this.changePasswordOtpId = otpId;\r\n          this.openModal(this.otpModal);\r\n        },\r\n        (error) => {\r\n          this.closeModal();\r\n          this.errorHandler.showError(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  onSendOtp(secretKey: string) {\r\n    this.invalidOtp = false;\r\n    this.subs.add(\r\n      this.passwordService\r\n        .confirmChangePassword({\r\n          ...this.changePasswordData,\r\n          otp: { secretKey, reference: this.changePasswordOtpId },\r\n        })\r\n        .subscribe(\r\n          () => {\r\n            this.closeModal();\r\n            this.openModal(this.successChangePasswordModal);\r\n          },\r\n          (error) => {\r\n            if (isInvalidOtp(error)) {\r\n              this.invalidOtp = true;\r\n              return;\r\n            }\r\n\r\n            this.closeModal();\r\n            this.errorHandler.showError(error);\r\n          }\r\n        )\r\n    );\r\n  }\r\n\r\n  private getCustomer() {\r\n    return this.accountService.currentCustomer$.pipe(\r\n      filter((customer) => !!customer),\r\n      createCustomerMap()\r\n    );\r\n  }\r\n}\r\n","import { SharedModule } from './../shared/shared.module';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { PersonalDataRoutingModule } from './personal-data-routing.module';\r\nimport { PersonalDataComponent } from './personal-data.component';\r\nimport { InfoPersonalDataComponent } from './components/info-personal-data/info-personal-data.component';\r\nimport { DataProtectionComponent } from './components/data-protection/data-protection.component';\r\nimport { ChangePasswordFormComponent } from './components/change-password-form/change-password-form.component';\r\n\r\n@NgModule({\r\n  declarations: [PersonalDataComponent, InfoPersonalDataComponent, DataProtectionComponent, ChangePasswordFormComponent],\r\n  imports: [CommonModule, PersonalDataRoutingModule, SharedModule],\r\n})\r\nexport class PersonalDataModule {}\r\n"]}